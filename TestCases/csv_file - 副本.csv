序号,执行时间,SQL
1,7110,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210821000000
		AND t.iRegTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210821000000
		AND t.iBookingTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210821000000
			AND s.iCreateTime <= 20210821235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
2,7110,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210821000000
		AND t.iRegTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210821000000
		AND t.iBookingTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210821000000
			AND s.iCreateTime <= 20210821235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
3,7110,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210821000000
		AND t.iRegTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210821000000
		AND t.iBookingTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210821000000
			AND s.iCreateTime <= 20210821235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
4,4747,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_case c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON b.patientId = r.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId 
	where 
	r.programming = 0
	AND r.currNode = 400
	AND r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.counselorId = '804da9ae7ab04016a80db48a3911ad42'
	AND c.STATUS <> 852"
5,4747,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_case c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON b.patientId = r.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId 
	where 
	r.programming = 0
	AND r.currNode = 400
	AND r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.counselorId = '804da9ae7ab04016a80db48a3911ad42'
	AND c.STATUS <> 852"
6,4747,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_case c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON b.patientId = r.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId 
	where 
	r.programming = 0
	AND r.currNode = 400
	AND r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.counselorId = '804da9ae7ab04016a80db48a3911ad42'
	AND c.STATUS <> 852"
7,4747,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_case c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON b.patientId = r.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId 
	where 
	r.programming = 0
	AND r.currNode = 400
	AND r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.counselorId = '804da9ae7ab04016a80db48a3911ad42'
	AND c.STATUS <> 852"
8,4747,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_case c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON b.patientId = r.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId 
	where 
	r.programming = 0
	AND r.currNode = 400
	AND r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.counselorId = '804da9ae7ab04016a80db48a3911ad42'
	AND c.STATUS <> 852"
9,4747,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_case c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON b.patientId = r.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId 
	where 
	r.programming = 0
	AND r.currNode = 400
	AND r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.counselorId = '804da9ae7ab04016a80db48a3911ad42'
	AND c.STATUS <> 852"
10,4747,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_case c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON b.patientId = r.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId 
	where 
	r.programming = 0
	AND r.currNode = 400
	AND r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.counselorId = '804da9ae7ab04016a80db48a3911ad42'
	AND c.STATUS <> 852"
11,4747,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_case c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON b.patientId = r.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId 
	where 
	r.programming = 0
	AND r.currNode = 400
	AND r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.counselorId = '804da9ae7ab04016a80db48a3911ad42'
	AND c.STATUS <> 852"
12,4747,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_case c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON b.patientId = r.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId 
	where 
	r.programming = 0
	AND r.currNode = 400
	AND r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.counselorId = '804da9ae7ab04016a80db48a3911ad42'
	AND c.STATUS <> 852"
13,4747,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_case c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON b.patientId = r.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId 
	where 
	r.programming = 0
	AND r.currNode = 400
	AND r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.counselorId = '804da9ae7ab04016a80db48a3911ad42'
	AND c.STATUS <> 852"
14,5446,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210821000000
		AND t.iRegTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210821000000
		AND t.iBookingTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210821000000
			AND s.iCreateTime <= 20210821235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
15,5447,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210821000000
		AND t.iRegTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210821000000
		AND t.iBookingTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210821000000
			AND s.iCreateTime <= 20210821235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
16,6596,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),s.createTime)>=0 and DATEDIFF(date('2021-08-21'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210808000000 and s.iCreateTime<=20210821235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),s.createTime)>=0 and DATEDIFF(date('2021-08-21'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-21'),b.createTime)>=0 and DATEDIFF(date('2021-08-21'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210808000000 and b.ICreateTime<=20210821235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-21'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-21'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
17,6596,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),s.createTime)>=0 and DATEDIFF(date('2021-08-21'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210808000000 and s.iCreateTime<=20210821235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),s.createTime)>=0 and DATEDIFF(date('2021-08-21'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-21'),b.createTime)>=0 and DATEDIFF(date('2021-08-21'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210808000000 and b.ICreateTime<=20210821235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-21'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-21'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
18,6596,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),s.createTime)>=0 and DATEDIFF(date('2021-08-21'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210808000000 and s.iCreateTime<=20210821235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),s.createTime)>=0 and DATEDIFF(date('2021-08-21'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-21'),b.createTime)>=0 and DATEDIFF(date('2021-08-21'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210808000000 and b.ICreateTime<=20210821235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-21'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-21'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
19,6596,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),s.createTime)>=0 and DATEDIFF(date('2021-08-21'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210808000000 and s.iCreateTime<=20210821235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),s.createTime)>=0 and DATEDIFF(date('2021-08-21'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-21'),b.createTime)>=0 and DATEDIFF(date('2021-08-21'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210808000000 and b.ICreateTime<=20210821235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-21'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-21'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = 'db6ed0b6b043496da39e4ff845acfaab'    AND a.isDelete = 0    AND a.iCreateTime >= 20210808000000 AND a.iCreateTime <= 20210821235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-21' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-21' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210808000000 and t.ICreateTime<=20210821235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-21'),t.createTime)>=0 and DATEDIFF(date('2021-08-21'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
20,5643,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210821000000
		AND t.iRegTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210821000000
		AND t.iBookingTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210821000000
			AND s.iCreateTime <= 20210821235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
21,4771,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='85c94b66653b4495bf60fac3f770f7ea'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210821000000 and b.iBookingTime <=20210821235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
22,4771,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='85c94b66653b4495bf60fac3f770f7ea'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210821000000 and b.iBookingTime <=20210821235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
23,4383,"select * from sys_file where  find_in_set(fid,'3a5eada1535d4dfe8564e3829f62e6ff,b21f741767f04278b6711221c32b8ce7,405434a1284747c6b87a5663cc746749,b9720c900bc94a8fbd43a4f902d7682e,7de5cb8b8e61407c8e1a96336e98ea84,8dc0f90bb333435bb123b8fbdc15a665,ab494d69336b4b8db4a5c18c0b27002b,69a91fd9fe1e45c8a60717600c1e4b86,9559845883b74296b44a9fbdbdc7fe48,5d6598d83ea9455b9f66eb346a351ee2,7927ddebdbee487daef278cb79827f86,7f6f4401afc5436bbd60d47d38993cc6,326d411597e6494e973c29db8d71164d,ed2339ddecc74d72a8a8b15273e318bf')"
24,4383,"select * from sys_file where  find_in_set(fid,'3a5eada1535d4dfe8564e3829f62e6ff,b21f741767f04278b6711221c32b8ce7,405434a1284747c6b87a5663cc746749,b9720c900bc94a8fbd43a4f902d7682e,7de5cb8b8e61407c8e1a96336e98ea84,8dc0f90bb333435bb123b8fbdc15a665,ab494d69336b4b8db4a5c18c0b27002b,69a91fd9fe1e45c8a60717600c1e4b86,9559845883b74296b44a9fbdbdc7fe48,5d6598d83ea9455b9f66eb346a351ee2,7927ddebdbee487daef278cb79827f86,7f6f4401afc5436bbd60d47d38993cc6,326d411597e6494e973c29db8d71164d,ed2339ddecc74d72a8a8b15273e318bf')"
25,4383,"select * from sys_file where  find_in_set(fid,'3a5eada1535d4dfe8564e3829f62e6ff,b21f741767f04278b6711221c32b8ce7,405434a1284747c6b87a5663cc746749,b9720c900bc94a8fbd43a4f902d7682e,7de5cb8b8e61407c8e1a96336e98ea84,8dc0f90bb333435bb123b8fbdc15a665,ab494d69336b4b8db4a5c18c0b27002b,69a91fd9fe1e45c8a60717600c1e4b86,9559845883b74296b44a9fbdbdc7fe48,5d6598d83ea9455b9f66eb346a351ee2,7927ddebdbee487daef278cb79827f86,7f6f4401afc5436bbd60d47d38993cc6,326d411597e6494e973c29db8d71164d,ed2339ddecc74d72a8a8b15273e318bf')"
26,4383,"select * from sys_file where  find_in_set(fid,'3a5eada1535d4dfe8564e3829f62e6ff,b21f741767f04278b6711221c32b8ce7,405434a1284747c6b87a5663cc746749,b9720c900bc94a8fbd43a4f902d7682e,7de5cb8b8e61407c8e1a96336e98ea84,8dc0f90bb333435bb123b8fbdc15a665,ab494d69336b4b8db4a5c18c0b27002b,69a91fd9fe1e45c8a60717600c1e4b86,9559845883b74296b44a9fbdbdc7fe48,5d6598d83ea9455b9f66eb346a351ee2,7927ddebdbee487daef278cb79827f86,7f6f4401afc5436bbd60d47d38993cc6,326d411597e6494e973c29db8d71164d,ed2339ddecc74d72a8a8b15273e318bf')"
27,4132,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210821000000
		AND t.iRegTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210821000000
		AND t.iBookingTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210821000000
			AND s.iCreateTime <= 20210821235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
28,6595,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' and r.ifConsult = 0 
29,6552,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' and r.ifConsult = 0 
30,6441,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' and r.ifConsult = 0 
31,6405,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' and r.ifConsult = 0 
32,6352,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '0183928fa6ce49b5899aebb5797fcc0a' and r.ifConsult = 0 
33,6253,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '450bf69813f546dc8e86e159459845c5' and r.ifConsult = 0 
34,5735,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '34243d6286624e17b71c036483996eed' and r.ifConsult = 0 
35,5406,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '315a99bc26704386a7cfba60df3ea646' and r.ifConsult = 0 
36,5303,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' and r.ifConsult = 0 
37,4939,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '9e1460ecb934421dbbf2fe90f91e9d29' and r.ifConsult = 0 
38,7941,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_consult c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN sys_treedictcat tr1 ON c.caseCat = tr1.catId
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN com_sys_employee e ON r.counselorId = e.employeeId
	LEFT JOIN com_sys_employee e1 ON b.developerId = e1.employeeId 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.isDelete = 0
	AND r.ifConsult = 1
	AND ifNull(c.consultId, '') = ''
	AND r.treatStatus = 1068
	AND r.finishType = 361
	AND r.counselorId = '590416ff909a458ab7b4c853473be36b'"
39,14441,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' and r.ifConsult = 0 
40,13098,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' and r.ifConsult = 0 
41,14198,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' and r.ifConsult = 0 
42,14095,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' and r.ifConsult = 0 
43,19172,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'c98923a69dc645d59e248cd03089772e' and r.ifConsult = 0 
44,13958,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '0183928fa6ce49b5899aebb5797fcc0a' and r.ifConsult = 0 
45,14545,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' and r.ifConsult = 0 
46,7546,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' and r.ifConsult = 0 
47,13794,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '450bf69813f546dc8e86e159459845c5' and r.ifConsult = 0 
48,12934,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '315a99bc26704386a7cfba60df3ea646' and r.ifConsult = 0 
49,14059,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' and r.ifConsult = 0 
50,20138,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '34243d6286624e17b71c036483996eed' and r.ifConsult = 0 
51,12432,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '9e1460ecb934421dbbf2fe90f91e9d29' and r.ifConsult = 0 
52,7305,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND b.ifSettle = 0 AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '590416ff909a458ab7b4c853473be36b' and r.ifConsult = 1 
53,7305,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '66a59860437a4d1a8231bc90c5cf5a67' and r.ifConsult = 0 
54,14145,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' and r.ifConsult = 0 
55,6597,"select count(*)  
	from 
	com_his_charge_bill b
	LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId
	LEFT JOIN com_his_patient_base ba ON b.patientId = ba.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = ba.patientId
	LEFT JOIN com_sys_employee e ON b.currPricingEmployeeId = e.employeeId 
	where 
	b.status = 220
	AND (b.ifSettle = 0
		OR b.ifSettle = 1
		AND b.currPay <> 0)
	AND r.isDelete = 0
	AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND b.billType != 202
	AND b.currPricingEmployeeId = '590416ff909a458ab7b4c853473be36b'
	AND r.ifConsult = 1"
56,12934,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '5cda243c1d154f2a945edc968bc24f36' and r.ifConsult = 0 
57,4347,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
58,15804,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_case c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON b.patientId = r.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId 
	where 
	r.programming = 0
	AND r.currNode = 400
	AND r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.counselorId = '590416ff909a458ab7b4c853473be36b'
	AND c.STATUS <> 852"
59,13933,select   count(*) as num from(  SELECT r.patientId  FROM com_his_treat_register r   WHERE r.shopId = '02c8257d6164485eb52b20b1b078696e' AND r.isDelete = 0 AND r.treatDoctorId = '11b8df0e227c4d439a48a5d6700b0d5b'  UNION  SELECT  r.patientId  FROM com_his_treat_register r   WHERE r.shopId = '02c8257d6164485eb52b20b1b078696e' AND r.isDelete = 0 AND r.upperDoctorId = '11b8df0e227c4d439a48a5d6700b0d5b' UNION  SELECT r.patientId   FROM com_his_treat_register r  INNER JOIN com_his_charge_bill_items it ON r.regId = it.regId   WHERE executeEmployeeId = '11b8df0e227c4d439a48a5d6700b0d5b' AND r.shopId = '02c8257d6164485eb52b20b1b078696e' AND it.isDelete = 0 UNION  SELECT b.patientId   FROM com_his_treat_consultation_doctor a  INNER JOIN com_his_treat_register b ON a.regId = b.regId   WHERE b.shopId = '02c8257d6164485eb52b20b1b078696e' and  a.doctorId = '11b8df0e227c4d439a48a5d6700b0d5b' UNION  SELECT patientId   FROM com_his_patient_base e   WHERE e.comId = '239e97340aa84454b4c4bb36bd7879ee' AND e.isDelete = 0 AND ( e.firstDiagDoctorId = '11b8df0e227c4d439a48a5d6700b0d5b'  OR e.lastDiagDoctorId = '11b8df0e227c4d439a48a5d6700b0d5b'   OR e.dutyDoctorId = '11b8df0e227c4d439a48a5d6700b0d5b' OR e.introducerId = '11b8df0e227c4d439a48a5d6700b0d5b' ) union  SELECT patientId  FROM com_his_charge_bill  WHERE createEmployeeId = '11b8df0e227c4d439a48a5d6700b0d5b' AND shopId = '02c8257d6164485eb52b20b1b078696e'   AND isDelete = 0 union  select patientId  from com_his_treat_register r left join com_his_treat_assistant ast on r.regId = ast.regId  where  r.comId = '239e97340aa84454b4c4bb36bd7879ee' AND r.shopId='02c8257d6164485eb52b20b1b078696e'   and (ast.assistantType=381 or ast.assistantType=380) and assistantId='11b8df0e227c4d439a48a5d6700b0d5b'  ) a
60,16373,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
61,15086,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '450bf69813f546dc8e86e159459845c5' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '450bf69813f546dc8e86e159459845c5' )) 
62,16071,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
63,12553,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
64,23775,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '34243d6286624e17b71c036483996eed' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '34243d6286624e17b71c036483996eed' )) 
65,16215,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
66,15466,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '0183928fa6ce49b5899aebb5797fcc0a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '0183928fa6ce49b5899aebb5797fcc0a' )) 
67,15686,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3fa93ee8295041b7bc2c5341930d00af' )) 
68,7941,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_consult c ON r.regId = c.regId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN sys_treedictcat tr1 ON c.caseCat = tr1.catId
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN com_sys_employee e ON r.counselorId = e.employeeId
	LEFT JOIN com_sys_employee e1 ON b.developerId = e1.employeeId 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.isDelete = 0
	AND r.ifConsult = 1
	AND ifNull(c.consultId, '') = ''
	AND r.treatStatus = 1068
	AND r.finishType = 361
	AND r.counselorId = '590416ff909a458ab7b4c853473be36b'"
69,15375,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
70,14545,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' and r.ifConsult = 0 
71,7576,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c13bbf031cc3491ba0051737ae4dcb00' )) 
72,15095,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' )) 
73,7546,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' and r.ifConsult = 0 
74,14622,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '5cda243c1d154f2a945edc968bc24f36' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '5cda243c1d154f2a945edc968bc24f36' )) 
75,7305,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND b.ifSettle = 0 AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '590416ff909a458ab7b4c853473be36b' and r.ifConsult = 1 
76,7305,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '66a59860437a4d1a8231bc90c5cf5a67' and r.ifConsult = 0 
77,14145,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' and r.ifConsult = 0 
78,6960,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '66a59860437a4d1a8231bc90c5cf5a67' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '66a59860437a4d1a8231bc90c5cf5a67' )) 
79,6698,"SELECT c.status,ot.black,r.regId,r.treatDoctorId,r.patientId,r.currNode,r.comId,r.shopId,r.regTime,r.treatBeginTime,r.iRegTime,b.patientName,b.searchCode,b.sex,b.phone1,b.phone2,b.fileNo, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.birthYear,if(ifnull(c.selectedScheme,'')='',0,1) as isSelectedScheme,if((select count(1) from  com_his_patient_agreement pa where pa.regId=r.regId and  pa.isDelete=0 and ifnull(patientSign,'')<>'' )>0,1,0) as isAgree    FROM com_his_treat_register r LEFT JOIN com_his_case c on r.regId=c.regId   LEFT JOIN com_his_patient_base b ON b.patientId=r.patientId  LEFT JOIN com_his_patient_other ot on ot.patientId = b.patientId    where r.programming=0 and r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='02c8257d6164485eb52b20b1b078696e' and r.treatDoctorId='418c9f21dc5f4b539421904875ffeac5'  and r.currNode=500 and (c.status=850 or c.status is null )  and (c.caseType=825 or c.caseType=824)  order by r.iRegTime asc  limit 0, 15"
80,6597,"select count(*)  
	from 
	com_his_charge_bill b
	LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId
	LEFT JOIN com_his_patient_base ba ON b.patientId = ba.patientId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = ba.patientId
	LEFT JOIN com_sys_employee e ON b.currPricingEmployeeId = e.employeeId 
	where 
	b.status = 220
	AND (b.ifSettle = 0
		OR b.ifSettle = 1
		AND b.currPay <> 0)
	AND r.isDelete = 0
	AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND b.billType != 202
	AND b.currPricingEmployeeId = '590416ff909a458ab7b4c853473be36b'
	AND r.ifConsult = 1"
81,12934,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '5cda243c1d154f2a945edc968bc24f36' and r.ifConsult = 0 
82,6162,"select count(r.regId) from com_his_treat_register r left join com_his_consult c on r.regId = c.regId where r.comId = '239e97340aa84454b4c4bb36bd7879ee' and r.shopId = '85c94b66653b4495bf60fac3f770f7ea' and r.isDelete = 0 and r.ifConsult = 1 and ifNull(c.consultId, '') = '' and r.treatStatus = 1068 and r.finishType = 361 and r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' "
83,16373,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
84,15086,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '450bf69813f546dc8e86e159459845c5' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '450bf69813f546dc8e86e159459845c5' )) 
85,16071,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
86,23775,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '34243d6286624e17b71c036483996eed' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '34243d6286624e17b71c036483996eed' )) 
87,16215,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
88,15466,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '0183928fa6ce49b5899aebb5797fcc0a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '0183928fa6ce49b5899aebb5797fcc0a' )) 
89,15686,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3fa93ee8295041b7bc2c5341930d00af' )) 
90,15375,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
91,7576,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c13bbf031cc3491ba0051737ae4dcb00' )) 
92,15095,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' )) 
93,14622,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '5cda243c1d154f2a945edc968bc24f36' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '5cda243c1d154f2a945edc968bc24f36' )) 
94,6960,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '66a59860437a4d1a8231bc90c5cf5a67' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '66a59860437a4d1a8231bc90c5cf5a67' )) 
95,6698,"SELECT c.status,ot.black,r.regId,r.treatDoctorId,r.patientId,r.currNode,r.comId,r.shopId,r.regTime,r.treatBeginTime,r.iRegTime,b.patientName,b.searchCode,b.sex,b.phone1,b.phone2,b.fileNo, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.birthYear,if(ifnull(c.selectedScheme,'')='',0,1) as isSelectedScheme,if((select count(1) from  com_his_patient_agreement pa where pa.regId=r.regId and  pa.isDelete=0 and ifnull(patientSign,'')<>'' )>0,1,0) as isAgree    FROM com_his_treat_register r LEFT JOIN com_his_case c on r.regId=c.regId   LEFT JOIN com_his_patient_base b ON b.patientId=r.patientId  LEFT JOIN com_his_patient_other ot on ot.patientId = b.patientId    where r.programming=0 and r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='02c8257d6164485eb52b20b1b078696e' and r.treatDoctorId='418c9f21dc5f4b539421904875ffeac5'  and r.currNode=500 and (c.status=850 or c.status is null )  and (c.caseType=825 or c.caseType=824)  order by r.iRegTime asc  limit 0, 15"
96,6162,"select count(r.regId) from com_his_treat_register r left join com_his_consult c on r.regId = c.regId where r.comId = '239e97340aa84454b4c4bb36bd7879ee' and r.shopId = '85c94b66653b4495bf60fac3f770f7ea' and r.isDelete = 0 and r.ifConsult = 1 and ifNull(c.consultId, '') = '' and r.treatStatus = 1068 and r.finishType = 361 and r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' "
97,11246," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='85c94b66653b4495bf60fac3f770f7ea' and isDelete=0   and iBookingTime>=20210821000000 and  iBookingTime <=20210821235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
98,7576,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c13bbf031cc3491ba0051737ae4dcb00' )) 
99,15095,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' )) 
100,7482,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
101,14622,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '5cda243c1d154f2a945edc968bc24f36' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '5cda243c1d154f2a945edc968bc24f36' )) 
102,6960,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '66a59860437a4d1a8231bc90c5cf5a67' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '66a59860437a4d1a8231bc90c5cf5a67' )) 
103,6698,"SELECT c.status,ot.black,r.regId,r.treatDoctorId,r.patientId,r.currNode,r.comId,r.shopId,r.regTime,r.treatBeginTime,r.iRegTime,b.patientName,b.searchCode,b.sex,b.phone1,b.phone2,b.fileNo, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.birthYear,if(ifnull(c.selectedScheme,'')='',0,1) as isSelectedScheme,if((select count(1) from  com_his_patient_agreement pa where pa.regId=r.regId and  pa.isDelete=0 and ifnull(patientSign,'')<>'' )>0,1,0) as isAgree    FROM com_his_treat_register r LEFT JOIN com_his_case c on r.regId=c.regId   LEFT JOIN com_his_patient_base b ON b.patientId=r.patientId  LEFT JOIN com_his_patient_other ot on ot.patientId = b.patientId    where r.programming=0 and r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='02c8257d6164485eb52b20b1b078696e' and r.treatDoctorId='418c9f21dc5f4b539421904875ffeac5'  and r.currNode=500 and (c.status=850 or c.status is null )  and (c.caseType=825 or c.caseType=824)  order by r.iRegTime asc  limit 0, 15"
104,6162,"select count(r.regId) from com_his_treat_register r left join com_his_consult c on r.regId = c.regId where r.comId = '239e97340aa84454b4c4bb36bd7879ee' and r.shopId = '85c94b66653b4495bf60fac3f770f7ea' and r.isDelete = 0 and r.ifConsult = 1 and ifNull(c.consultId, '') = '' and r.treatStatus = 1068 and r.finishType = 361 and r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' "
105,11246," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='85c94b66653b4495bf60fac3f770f7ea' and isDelete=0   and iBookingTime>=20210821000000 and  iBookingTime <=20210821235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
106,4383,"select count(*)  
	from 
	(SELECT a.*, dt2.dict AS followUpResultDict, ot.black, CASE WHEN EXISTS (SELECT 1
			FROM com_his_charge_bill_items sh
			WHERE sh.id = a.correlativeId)
		OR (
			SELECT 1
			FROM com_his_workload_detail sh
			WHERE sh.detailId = a.correlativeId
			) = 1 THEN '1' ELSE '0' END AS ifManual, dt3.dict AS statisfactionName
		, dt4.dict AS followUpOutComeName, dt.dict AS itemCatName, ifnull(dt1.dict, a.cancelReason) AS cancelReason1, c1.employeeName AS createEmployee, c2.employeeName AS treatDoctor
		, bg.bookingTime, bgNext.bookingTime AS bookingTimeNext, DATEDIFF(a.nextSchemeTime, a.createTime) AS intervalTime, (
			SELECT h.feedback
			FROM com_his_follow_up_history h
			WHERE h.isDelete = 0
				AND h.followUpId = a.followUpId
			ORDER BY iCreateTime DESC
			LIMIT 1
			) AS feedback, CASE WHEN ifnull(b.birthday, '') = '' THEN year(a.createTime) - b.birthYear ELSE floor(DATEDIFF(a.createTime, b.birthday) / 365) END AS age
		, ifnull(mem.memberstar, 0) AS memberStar, IFNULL(b.sex, pt.sex) AS sex, d.fileNo, pt.transed, IFNULL(b.patientName, pt.patientName) AS patientName
		, c.employeeName AS dutyEmployeeName, e.employeeName AS lastFollowUpEmployeeName, IFNULL(concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END), concat(pt.phone1, CASE WHEN ifnull(pt.phone2, '') = '' THEN '' ELSE concat('/', pt.phone2) END)) AS phone3
	FROM com_his_follow_up a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_temporary_patient pt ON pt.patientId = a.patientId
			AND pt.transed = 0
		LEFT JOIN com_his_booking bg ON bg.bookingId = a.bookingId
		LEFT JOIN com_his_booking bgNext ON bgNext.bookingId = a.bookingIdNext
		LEFT JOIN com_his_patient_shop d ON a.patientId = d.patientId
			AND d.shopId = a.shopId
		LEFT JOIN com_his_patient_member mem ON a.patientId = mem.patientId
		LEFT JOIN com_sys_employee c ON a.dutyEmployeeId = c.employeeId
		LEFT JOIN com_sys_employee c1 ON a.createEmployeeId = c1.employeeId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_follow_up_item it ON it.followUpItemId = a.followUpItemId
		LEFT JOIN sys_dict dt ON it.itemCat = dt.did
		LEFT JOIN sys_dict dt1 ON dt1.did = a.cancelReason
		LEFT JOIN sys_dict dt2 ON dt2.did = a.followUpResult
		LEFT JOIN sys_dict dt3 ON dt3.did = a.statisfaction
		LEFT JOIN sys_dict dt4 ON dt4.did = a.followUpOutCome
		LEFT JOIN com_sys_employee e ON a.lastFollowUpEmployeeId = e.employeeId
		LEFT JOIN com_his_treat_register r ON r.regId = if(IFNULL(a.regId, '') = '', IFNULL(bg.registerId, ''), IFNULL(a.regId, ''))
		LEFT JOIN com_his_charge_item_shop sh ON sh.itemFollowUpId = a.followUpItemId
		LEFT JOIN com_sys_employee c2 ON c2.employeeId = r.treatDoctorId
	WHERE a.isDelete = 0
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND (a.dutyEmployeeId = '0d0ea7430eec40259ad774cf6a2221ee'
			OR a.createEmployeeId = '0d0ea7430eec40259ad774cf6a2221ee')
		AND a.iNextSchemeTime <= 20210821235959
	GROUP BY a.followUpId
	ORDER BY a.status, a.iNextSchemeTime DESC
	) a 
	where 
	1 = 1"
107,7482,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
108,6185,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
109,11246," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='85c94b66653b4495bf60fac3f770f7ea' and isDelete=0   and iBookingTime>=20210821000000 and  iBookingTime <=20210821235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
110,7482,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
111,6185,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
112,6185,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
113,12247,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
114,4005,"select * from sys_file where  find_in_set(fid,'b5e395469b3e4db1bb6a320249f8602d,12d84245cf914345bb2a7790bc9ada21,b91728678320424e97366cf4d37c0f69,7a36c7a5e882410f9a0e8e6197bab8ab,2f61e5ae096a462bb7334ee8f9ff285c,0fecff878cc545dab4c5dc72ad277e8a,f4cdcdecdd984151adbc04239ed65de4,818f590311bc4fa8b1230d47a2011ca4,2b087e91eb4748488edf0de1643553c1,5486fe5df4da4918be3bd5c93d6f8dec,8c0f1accb2bc46da8b34f568d71ee578,216ab6c95401473fbc5519b69679c82f')"
115,4005,"select * from sys_file where  find_in_set(fid,'b5e395469b3e4db1bb6a320249f8602d,12d84245cf914345bb2a7790bc9ada21,b91728678320424e97366cf4d37c0f69,7a36c7a5e882410f9a0e8e6197bab8ab,2f61e5ae096a462bb7334ee8f9ff285c,0fecff878cc545dab4c5dc72ad277e8a,f4cdcdecdd984151adbc04239ed65de4,818f590311bc4fa8b1230d47a2011ca4,2b087e91eb4748488edf0de1643553c1,5486fe5df4da4918be3bd5c93d6f8dec,8c0f1accb2bc46da8b34f568d71ee578,216ab6c95401473fbc5519b69679c82f')"
116,13379,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='85c94b66653b4495bf60fac3f770f7ea'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210801000000 and b.iBookingTime <=20210821235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
117,4918,"select sum(if(r.treatType=340 or r.treatType=341 or r.treatType=342 ,bi.amount-bi.derate,0)) as amountTotal,sum(if((r.treatType=340 or r.treatType=341 or r.treatType=342) and pb.sex=1,bi.amount-bi.derate,0)) as manAmountTotal,sum(if((r.treatType=340 or r.treatType=341 or r.treatType=342) and pb.sex=0,bi.amount-bi.derate,0)) as girlAmountTotal,sum(if((r.treatType=340 or r.treatType=341 or r.treatType=342) and pb.introducerType=31,bi.amount-bi.derate,0)) as patientAmountTotal,sum(if((r.treatType=340 or r.treatType=341 or r.treatType=342) and pb.introducerType=32,bi.amount-bi.derate,0)) as empAmountTotal,sum(if((r.treatType=340 or r.treatType=341 or r.treatType=342) and pb.introducerType=33,bi.amount-bi.derate,0)) as externalAmountTotal,sum(bi.amount-bi.derate) as allAmountTotal,sum(if(pb.sex=1,bi.amount-bi.derate,0)) as manAllAmountTotal,sum(if(pb.sex=0,bi.amount-bi.derate,0)) as girlAllAmountTotal,sum(if(pb.introducerType=31,bi.amount-bi.derate,0)) as patientAllAmountTotal,sum(if(pb.introducerType=32,bi.amount-bi.derate,0)) as empAllAmountTotal,sum(if(pb.introducerType=33,bi.amount-bi.derate,0)) as externalAllAmountTotal,count(DISTINCT if(r.treatType=340 or r.treatType=341, r.regId,null)) as regTimes, count(DISTINCT if((r.treatType=340 or r.treatType=341) and pb.sex=1, r.regId,null)) as manRegTimes,count(DISTINCT if((r.treatType=340 or r.treatType=341) and pb.sex=0, r.regId,null)) as girlRegTimes, count(DISTINCT if((r.treatType=340 or r.treatType=341) and pb.introducerType=31, r.regId,null)) as patientRegTimes, count(DISTINCT if((r.treatType=340 or r.treatType=341) and pb.introducerType=32, r.regId,null)) as empRegTimes, count(DISTINCT if((r.treatType=340 or r.treatType=341) and pb.introducerType=33, r.regId,null)) as externalRegTimes from com_his_patient_shop ps 
left join com_his_patient_base pb on pb.patientId=ps.patientId inner JOIN com_his_treat_register r on r.patientId=ps.patientId and r.isDelete=0 and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and (r.ifTreat=1 or r.ifConsult=1) inner join com_his_charge_bill b on b.currRegId=r.regId and b.isDelete=0 and b.status<>239 and b.ifSettle=1 inner join com_his_charge_bill_items bi on bi.billId=b.billId and bi.isDelete=0 and ifnull(bi.planCorrelativeId,'')='' and if(bi.isPlanItem=1,bi.planCharge=1,1=1) and bi.billItemType=260 where ps.shopId='85c94b66653b4495bf60fac3f770f7ea' and ps.comId='239e97340aa84454b4c4bb36bd7879ee' and ps.isDelete=0 and ps.iCreateTime>=20210801000000 and ps.iCreateTime<=20210831235959
  and pb.isExport=0  and IFNULL(pb.channel,'')<>'' and IFNULL(pb.source,'')<>'' "
118,5042,"select * from sys_file where  find_in_set(fid,'9c6a0f82231e41699ceb5401e589dcf5,4f8b3d28cd554293b6ace0a4535a470a,e628890062da49b8b0b27b2273934a75,86a4e14dd1fe498e9692d53fe8f6ba0f,6bb1cef6f913461ba3cf497007287e6f,03ed2e825bf048c7a2b4940048f84d96,3f1154ae13b54926a37501b0a6121dda,0627e20ccb504d9ca688b970edafe0ca,272149dab2884eb19eb45e0a771fcbcf,6bfedfa942f44ae381c057bba9b90abf,d44b42bab0234a5caa0a2647c3ff6beb,4955192de5044a06a4e8d78de5e21261,848691d1a2154268b9701c7b848adf95,87b64b1294e4439a8f9c5489ffb23eaf,ca74a22775094dbe8bea9a2cc83848b0,eea2a07bca8240c9836b16dce4675058,0769c600d5c440638b95a037b87bb07a')"
119,5042,"select * from sys_file where  find_in_set(fid,'9c6a0f82231e41699ceb5401e589dcf5,4f8b3d28cd554293b6ace0a4535a470a,e628890062da49b8b0b27b2273934a75,86a4e14dd1fe498e9692d53fe8f6ba0f,6bb1cef6f913461ba3cf497007287e6f,03ed2e825bf048c7a2b4940048f84d96,3f1154ae13b54926a37501b0a6121dda,0627e20ccb504d9ca688b970edafe0ca,272149dab2884eb19eb45e0a771fcbcf,6bfedfa942f44ae381c057bba9b90abf,d44b42bab0234a5caa0a2647c3ff6beb,4955192de5044a06a4e8d78de5e21261,848691d1a2154268b9701c7b848adf95,87b64b1294e4439a8f9c5489ffb23eaf,ca74a22775094dbe8bea9a2cc83848b0,eea2a07bca8240c9836b16dce4675058,0769c600d5c440638b95a037b87bb07a')"
120,6762,"select * from sys_file where  find_in_set(fid,'9c6a0f82231e41699ceb5401e589dcf5,4f8b3d28cd554293b6ace0a4535a470a,e628890062da49b8b0b27b2273934a75,86a4e14dd1fe498e9692d53fe8f6ba0f,6bb1cef6f913461ba3cf497007287e6f,03ed2e825bf048c7a2b4940048f84d96,3f1154ae13b54926a37501b0a6121dda,0627e20ccb504d9ca688b970edafe0ca,272149dab2884eb19eb45e0a771fcbcf,6bfedfa942f44ae381c057bba9b90abf,d44b42bab0234a5caa0a2647c3ff6beb,4955192de5044a06a4e8d78de5e21261,848691d1a2154268b9701c7b848adf95,87b64b1294e4439a8f9c5489ffb23eaf,ca74a22775094dbe8bea9a2cc83848b0,eea2a07bca8240c9836b16dce4675058,0769c600d5c440638b95a037b87bb07a')"
121,5947,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
122,5947,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
123,5947,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
124,5210,"select * from sys_file where  find_in_set(fid,'9c6a0f82231e41699ceb5401e589dcf5,4f8b3d28cd554293b6ace0a4535a470a,e628890062da49b8b0b27b2273934a75,86a4e14dd1fe498e9692d53fe8f6ba0f,6bb1cef6f913461ba3cf497007287e6f,03ed2e825bf048c7a2b4940048f84d96,3f1154ae13b54926a37501b0a6121dda,0627e20ccb504d9ca688b970edafe0ca,272149dab2884eb19eb45e0a771fcbcf,6bfedfa942f44ae381c057bba9b90abf,d44b42bab0234a5caa0a2647c3ff6beb,4955192de5044a06a4e8d78de5e21261,848691d1a2154268b9701c7b848adf95,87b64b1294e4439a8f9c5489ffb23eaf,ca74a22775094dbe8bea9a2cc83848b0,eea2a07bca8240c9836b16dce4675058,0769c600d5c440638b95a037b87bb07a')"
125,5947,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
126,5947,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
127,5947,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
128,6309,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
129,6199,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
130,6199,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
131,4501,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
132,4874,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
133,4840,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
134,5097,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
135,5113,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '9e1460ecb934421dbbf2fe90f91e9d29' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '9e1460ecb934421dbbf2fe90f91e9d29' )) 
136,4792,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3fa93ee8295041b7bc2c5341930d00af' )) 
137,4366,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c98923a69dc645d59e248cd03089772e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c98923a69dc645d59e248cd03089772e' )) 
138,4902,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
		AND r.ifConsult = 1
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN com_sys_employee e5 ON e5.employeeId = r.upperDoctorId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN com_his_treat_transfer tf ON tf.isDelete = 0
		AND tf.regId = r.regId
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN (SELECT t.currRegId, SUM(t.currPay) AS pay, SUM(t.currWorkload) AS workload
		FROM com_his_charge_settle_bill t
			LEFT JOIN com_his_charge_bill b ON t.billId = b.billId
		WHERE b.billType = 200
		GROUP BY t.currRegId
		) bl ON r.regId = bl.currRegId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName, GROUP_CONCAT(b.employeeId) AS assistId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 380
		GROUP BY a.regId
		) j ON j.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName, GROUP_CONCAT(b.employeeId) AS nurseId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 381
		GROUP BY a.regId
		) k ON k.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName, GROUP_CONCAT(b.employeeId) AS consultaId
		FROM com_his_treat_consultation_doctor a
			LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
		GROUP BY a.regId
		) m ON m.regId = r.regId 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.developerId = 'fa459035e742407fa18295eeceb9e97a'
		OR b.marketingPromotorId = 'fa459035e742407fa18295eeceb9e97a')
	AND (1 = 1
		AND r.regTime >= 20210821000000
		AND r.regTime <= 20210821235959)"
139,4107,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.treatDoctorId='11b8df0e227c4d439a48a5d6700b0d5b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 100"
140,4107,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.treatDoctorId='11b8df0e227c4d439a48a5d6700b0d5b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 100"
141,4107,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.treatDoctorId='11b8df0e227c4d439a48a5d6700b0d5b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 100"
142,4107,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.treatDoctorId='11b8df0e227c4d439a48a5d6700b0d5b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 100"
143,6974,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
144,6105,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
145,4455,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.treatDoctorId='11b8df0e227c4d439a48a5d6700b0d5b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 100"
146,4455,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.treatDoctorId='11b8df0e227c4d439a48a5d6700b0d5b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 100"
147,4455,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.treatDoctorId='11b8df0e227c4d439a48a5d6700b0d5b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 100"
148,4455,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.treatDoctorId='11b8df0e227c4d439a48a5d6700b0d5b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 100"
149,4242,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210821000000
		AND t.iRegTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210821000000
		AND t.iBookingTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210821000000
			AND s.iCreateTime <= 20210821235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
150,7624,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210821000000
		AND t.iRegTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210821000000
		AND t.iBookingTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210821000000
			AND s.iCreateTime <= 20210821235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
151,7217,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '7ab3a0b24ebd41b781c768a62a4b725e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '7ab3a0b24ebd41b781c768a62a4b725e' )) 
152,7183,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'd6ca8b4a25074a1a9ea19bfd9c820e5c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'd6ca8b4a25074a1a9ea19bfd9c820e5c' )) 
153,6733,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '9e1460ecb934421dbbf2fe90f91e9d29' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '9e1460ecb934421dbbf2fe90f91e9d29' )) 
154,5599,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3a201a547af240ee8f30555af64b4a84' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3a201a547af240ee8f30555af64b4a84' )) 
155,7217,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '7ab3a0b24ebd41b781c768a62a4b725e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '7ab3a0b24ebd41b781c768a62a4b725e' )) 
156,7183,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'd6ca8b4a25074a1a9ea19bfd9c820e5c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'd6ca8b4a25074a1a9ea19bfd9c820e5c' )) 
157,6733,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '9e1460ecb934421dbbf2fe90f91e9d29' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '9e1460ecb934421dbbf2fe90f91e9d29' )) 
158,5599,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3a201a547af240ee8f30555af64b4a84' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3a201a547af240ee8f30555af64b4a84' )) 
159,6131,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
160,6037,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
161,6037,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
162,5952,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
163,6037,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
164,5952,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
165,6037,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
166,5952,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
167,5952,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
168,5952,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
169,7144,"select r.*,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '1bec2b8488c14f33ad90cf25e39520d9' limit 1) as followUp,IF(IFNULL(r.cancelType,'')='',0,1) as cantype,case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,r.treatStatus as treatStatus2,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=500 and t.regId=r.regId and t.ifCurr=1 limit 1),999) as nodeStatus,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,e6.employeeName as dutyDoctorName,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1 ) as batch,b.fileNo, concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName, tr1.catName as appealName1, (SELECT foll.ifAbnormal  FROM com_his_follow_up foll where foll.patientId=r.patientId and foll.regId = (SELECT regId FROM com_his_treat_register rc  WHERE rc.patientId = r.patientId AND rc.iRegTime <r.iRegTime ORDER BY rc.iRegTime DESC  LIMIT 1 ) ORDER BY foll.iLastFollowUpTime desc LIMIT 1 ) AS ifAbnormal,  (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, ( SELECT GROUP_CONCAT(b1.employeeName SEPARATOR '/') AS assistName FROM com_his_treat_assistant a1  LEFT JOIN com_sys_employee b1 ON a1.assistantId = b1.employeeId WHERE a1.regId=r.regId  AND a1.isDelete = 0  AND a1.assistantType = 380 )  as helperDoctor, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName FROM  com_his_treat_assistant a LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 AND a.assistantType = 381 )  as helperNurse, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName FROM  com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 ) as staffName, di1.dict as memberLevelName, (select count(*) from com_his_patient_storage_detail sde where b.patientId= sde.patientId and sde.`status` <>7002 and sde.isDelete=0 )as goods,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,(select count(*) from com_his_charge_bill_settle_items x left join com_his_charge_bill_items y on x.billItemId=y.id  left join com_his_charge_bill z on x.billId=z.billId where   x.currRegId=r.regId and z.billType=200 and y.billItemType=260) as dealSettle,b.remark,case when tf.transferId is null then 0 else 1 end transfer,case when tto.transferId is null then 0 else 1 end transferTo,(SELECT sum(t.currPay) AS pay FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as pay,(SELECT SUM(t.currWorkload) workload  FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE  t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as workload,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.sex,ot.black, (select  ifnull(GROUP_CONCAT(booking.remark),'') from com_his_booking booking  where booking.isDelete=0 and booking.`status`=91  and DATE_FORMAT(booking.bookingTime,'%Y-%m-%d')=DATE_FORMAT(r.regTime,'%Y-%m-%d') and booking.patientId=r.patientId) as bookingRemark,(select ifnull(bk.extraBooking,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as  extraBooking,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,di.dict AS ificatione,di2.dict AS ificationt, (SELECT if(IFNULL(s.bypassId,'')<>'',1,0) from  com_his_treat_bypass s where s.regId=r.regId GROUP BY s.regId ) as isbypass    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId  left join com_his_booking book on r.regId=book.registerId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  LEFT JOIN sys_dict di ON di.did = ot.category1  LEFT JOIN sys_dict di2 ON di2.did = ot.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left outer join sys_dict a on b.source = a.did  left join sys_dict di1 on di1.did = mem.memberLevel  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=r.regId  left outer join (select * from com_his_treat_transfer_to_other GROUP BY regId) tto on tto.isDelete = 0 and tto.regId = r.regId left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and r.treatDoctorId='1bec2b8488c14f33ad90cf25e39520d9'  and ((1=1  and r.iRegTime>=20200928000000 and r.iRegTime <=20210821235959) or r.treatStatus=1064 or r.treatStatus=1065 or r.treatStatus=1061 or r.treatStatus=1062)  order by IF(IFNULL(r.cancelType,'')='',0,1) asc,r.currNode desc,r.treatStatus asc,r.iRegTime asc  limit 0, 100"
170,4715,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
171,4715,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
172,4715,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
173,8422,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON book.registerId = r.regId
	INNER JOIN (SELECT DISTINCT regId
		FROM (SELECT DISTINCT regId
			FROM com_his_treat_assistant
			WHERE assistantId = 'd569c75c5c844718a694cc16c1cd81fa'
				AND isDelete = 0
			UNION ALL
			SELECT DISTINCT t.currRegId AS regId
			FROM com_his_charge_bill_settle_items t
			WHERE t.executeEmployeeId = 'd569c75c5c844718a694cc16c1cd81fa'
				AND isDelete = 0
			UNION ALL
			SELECT DISTINCT r.regId
			FROM com_his_treat_register r
				LEFT JOIN com_sys_employee e ON e.employeeId = r.treatDoctorId
			WHERE e.deptIdList = 'ff034dddcb374504aa99a508c4c335d3'
			) t
		) ass ON r.regId = ass.regId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
		AND r.ifConsult = 1
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN com_sys_employee e5 ON e5.employeeId = r.upperDoctorId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN com_his_treat_transfer tf ON tf.isDelete = 0
		AND tf.regId = r.regId
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN (SELECT t.currRegId, SUM(t.currPay) AS pay, SUM(t.currWorkload) AS workload
		FROM com_his_charge_settle_bill t
			LEFT JOIN com_his_charge_bill b ON t.billId = b.billId
		WHERE b.billType = 200
		GROUP BY t.currRegId
		) bl ON r.regId = bl.currRegId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName, GROUP_CONCAT(b.employeeId) AS assistId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 380
		GROUP BY a.regId
		) j ON j.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName, GROUP_CONCAT(b.employeeId) AS nurseId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 381
		GROUP BY a.regId
		) k ON k.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName, GROUP_CONCAT(b.employeeId) AS consultaId
		FROM com_his_treat_consultation_doctor a
			LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
		GROUP BY a.regId
		) m ON m.regId = r.regId 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (EXISTS (SELECT 1
			FROM com_his_treat_assistant ast
			WHERE r.regId = ast.regId
				AND ast.isDelete = 0
				AND ast.assistantType = 380
				AND assistantId = 'd569c75c5c844718a694cc16c1cd81fa')
		OR EXISTS (SELECT 1
			FROM com_his_treat_assistant ast
			WHERE r.regId = ast.regId
				AND ast.isDelete = 0
				AND ast.assistantType = 381
				AND assistantId = 'd569c75c5c844718a694cc16c1cd81fa'))
	AND r.regTime >= 20210821000000
	AND r.regTime <= 20210821235959"
174,6061,"select r.*,e2.employeeName counselorName,b.patientName,(select f.formId from com_his_treat_form f where f.regId = r.regId and f.formCod = 2648) as formId,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo, tr1.catName as appealName1,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, j.assistName as helperDoctor, k.nurseName as helperNurse, m.consultaName as staffName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,ot.black,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,case when tf.transferId is null then 0 else 1 end transfer,case when r.treatStatus=1060 or r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else r.consultWaitDuration end as consultWaitMin,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,ifnull(bl.pay,0) as pay,ifnull(bl.workload,0) as workload,di1.dict as memberLevelName,b.sex    from com_his_treat_register r  left join com_his_booking book on book.registerId = r.regId  inner join ( select distinct regId from ( select distinct regId from com_his_treat_assistant where assistantId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select distinct t.currRegId as regId from com_his_charge_bill_settle_items t where t.executeEmployeeId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select DISTINCT r.regId from com_his_treat_register r left join com_sys_employee e on e.employeeId = r.treatDoctorId where e.deptIdList ='ff034dddcb374504aa99a508c4c335d3' ) t ) ass on r.regId=ass.regId  left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di1 on di1.did = mem.memberLevel  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left outer join sys_dict a on b.source = a.did  left outer join com_his_treat_transfer tf on tf.isDelete=0 and tf.regId=r.regId  left outer join sys_treedictcat tr on b.channel=tr.catId  left outer join (select t.currRegId,sum(t.currPay) as pay,sum(t.currWorkload) workload from com_his_charge_settle_bill t left outer join com_his_charge_bill b on t.billId=b.billId where b.billType=200 group by t.currRegId) bl on r.regId=bl.currRegId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as assistName,GROUP_CONCAT(b.employeeId) as assistId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId   WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=380 group by a.regId)  j on j.regId=r.regId   LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as nurseName,GROUP_CONCAT(b.employeeId) as nurseId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=381 group by a.regId)  k on k.regId=r.regId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as consultaName,GROUP_CONCAT(b.employeeId)  as consultaId FROM com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId=b.employeeId  WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 group by a.regId)  m on m.regId=r.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and  (Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=380 and assistantId='d569c75c5c844718a694cc16c1cd81fa') OR Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=381 and assistantId='d569c75c5c844718a694cc16c1cd81fa')) and r.regTime>=20210821000000 and r.regTime <=20210821235959 order by  r.regTime desc  limit 0, 15"
175,6154,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
176,6154,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
177,6154,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
178,5832,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
179,7392,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c09af088ac38410a833a2592485d3062' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c09af088ac38410a833a2592485d3062' )) 
180,8019,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e253af2f0fbe4566b47e7924def493b7' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e253af2f0fbe4566b47e7924def493b7' )) 
181,7696,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '6e13b4e770d044f1bc26d06a37d8408b' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '6e13b4e770d044f1bc26d06a37d8408b' )) 
182,7720,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8ffbded14eb4482cab5a0ec99bb1b62c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8ffbded14eb4482cab5a0ec99bb1b62c' )) 
183,7392,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c09af088ac38410a833a2592485d3062' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c09af088ac38410a833a2592485d3062' )) 
184,6609,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c13bbf031cc3491ba0051737ae4dcb00' )) 
185,6416,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
186,5861,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '5cda243c1d154f2a945edc968bc24f36' and r.ifConsult = 0 
187,5982,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
188,6634,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3fa93ee8295041b7bc2c5341930d00af' )) 
189,6498,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' and r.ifConsult = 0 
190,6649,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' and r.ifConsult = 0 
191,6357,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' and r.ifConsult = 0 
192,5841,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
193,5841,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
194,5804,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
195,7120,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
196,6218,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
197,4897,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
198,5786,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
199,5781,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
200,4729,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '5cda243c1d154f2a945edc968bc24f36' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '5cda243c1d154f2a945edc968bc24f36' )) 
201,5053,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
202,5421,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
203,4662,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' )) 
204,4904,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c13bbf031cc3491ba0051737ae4dcb00' )) 
205,6854,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
206,6854,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
207,5935,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
208,6034,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
209,4108," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='85c94b66653b4495bf60fac3f770f7ea' and isDelete=0   and iBookingTime>=20210821000000 and  iBookingTime <=20210821235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
210,4108," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='85c94b66653b4495bf60fac3f770f7ea' and isDelete=0   and iBookingTime>=20210821000000 and  iBookingTime <=20210821235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
211,5709,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
212,4888,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '66a59860437a4d1a8231bc90c5cf5a67' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '66a59860437a4d1a8231bc90c5cf5a67' )) 
213,5073,"select * from sys_file where  find_in_set(fid,'ce070564345e40c398c7e16ba572454f,9d55121d003c472989dd5ff37b8c9374,ed6a231e34b54eb19efd6d5e1b5e3c0a,f7cfe24ccb87485d9c1a648aa3c3c046,9ccf06ba6bb94e4eba4de175cab2bf69,42b64478aa1841a2bc093b8733abdbe4,f2ea0604c81b4a93b51fb90cabd08966')"
214,4888,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '66a59860437a4d1a8231bc90c5cf5a67' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '66a59860437a4d1a8231bc90c5cf5a67' )) 
215,6269,"select count(*)  
	from 
	com_his_treat_register t
	LEFT JOIN com_his_patient_base a ON t.patientId = a.patientId
	LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON t.patientId = s.patientId
		AND s.shopId = t.shopId
	LEFT JOIN com_sys_employee b ON t.treatDoctorId = b.employeeId
	LEFT JOIN com_sys_employee e ON e.employeeId = t.upperDoctorId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = t.counselorId
	LEFT JOIN sys_dict d1 ON d1.did = a.source
	LEFT JOIN sys_dict d2 ON d2.did = t.observeRemark
	LEFT JOIN sys_treedictcat t1 ON t1.catId = a.channel
	LEFT JOIN com_his_patient_other ot ON ot.patientId = t.patientId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN (SELECT currRegId AS regId, SUM(currPay - currPayed) AS amount
		FROM com_his_charge_settle_bill
		WHERE isDelete = 0
		GROUP BY currRegId
		) bi ON bi.regId = t.regId
	LEFT JOIN (SELECT c.regId, GROUP_CONCAT(CASE c.assistantType WHEN 380 THEN x.employeeName END) AS assistant
		FROM com_his_treat_assistant c
			LEFT JOIN com_sys_employee x ON c.assistantId = x.employeeId
				AND c.isDelete = 0
		GROUP BY c.regId
		) x ON x.regId = t.regId
	LEFT JOIN (SELECT c.regId, GROUP_CONCAT(CASE c.assistantType WHEN 381 THEN x.employeeName END) AS assistant
		FROM com_his_treat_assistant c
			LEFT JOIN com_sys_employee x ON c.assistantId = x.employeeId
				AND c.isDelete = 0
		GROUP BY c.regId
		) y ON y.regId = t.regId
	LEFT JOIN (SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2, a.patientId
		FROM com_his_patient_extend a
			LEFT JOIN sys_dict b ON b.did = a.dictId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = '0'
			AND a.InfoType = 9
		GROUP BY a.patientId
		) d ON d.patientId = t.patientId 
	where 
	t.finishType = 361
	AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND t.iRegTime >= 20210821000000
	AND t.iRegTime <= 20210821235959"
216,5096,"select t.*,a.patientName,case when ifnull(a.birthday,'')='' then year(CURDATE()) -a.birthYear else floor(DATEDIFF(CURDATE(),a.birthday)/365) end as age,a.fileNo,d1.dict as sourceName,if(d2.did=t.observeRemark,d2.dict,observeRemark) as observeRemark,t1.catNameFull as channelName,b.employeeName as treatDoctorName,e.employeeName as upperDoctorName,e1.employeeName as counselorName,x.assistant as helperDoctor,y.assistant as helperNurse,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=a.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,bi.amount,a.sex,ot.black,ifnull(mem.memberStar,0) as memberStar, di2.dict as category1,di3.dict as category2, d.PATIENT_TAG2    from com_his_treat_register t left join com_his_patient_base a on t.patientId=a.patientId left join com_his_patient_member mem on t.patientId=mem.patientId left join com_his_patient_shop s on t.patientId=s.patientId and s.shopId=t.shopId  left join com_sys_employee b on t.treatDoctorId=b.employeeId left join com_sys_employee e on e.employeeId=t.upperDoctorId left join com_sys_employee e1 on e1.employeeId=t.counselorId left join sys_dict d1 on d1.did=a.source left join sys_dict d2 on d2.did=t.observeRemark left join sys_treedictcat t1 on t1.catId=a.channel left join com_his_patient_other ot on ot.patientId = t.patientId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join (select currRegId as regId,                    sum(currPay-currPayed) as amount              from com_his_charge_settle_bill              where isDelete=0 group by currRegId)  bi on bi.regId=t.regId left join ( select c.regId,group_concat(case c.assistantType when 380 then x.employeeName end) as assistant from com_his_treat_assistant c left join com_sys_employee x on c.assistantId=x.employeeId and c.isDelete=0 group by c.regId) x on x.regId=t.regId left join (select c.regId,group_concat(case c.assistantType when 381 then x.employeeName end)  as assistant from com_his_treat_assistant c left join com_sys_employee x on c.assistantId=x.employeeId and c.isDelete=0 group by c.regId) y on y.regId=t.regId  LEFT JOIN (select GROUP_CONCAT(b.dict) as PATIENT_TAG2,a.patientId from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and 
 a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete='0' and a.InfoType=9 group by a.patientId)d on d.patientId=t.patientId
  where t.finishType=361 and t.comId='239e97340aa84454b4c4bb36bd7879ee' and t.shopId='85c94b66653b4495bf60fac3f770f7ea' and t.iRegTime>=20210821000000 and t.iRegTime <=20210821235959 order by t.iregTime desc  limit 0, 50"
217,6269,"select count(*)  
	from 
	com_his_treat_register t
	LEFT JOIN com_his_patient_base a ON t.patientId = a.patientId
	LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON t.patientId = s.patientId
		AND s.shopId = t.shopId
	LEFT JOIN com_sys_employee b ON t.treatDoctorId = b.employeeId
	LEFT JOIN com_sys_employee e ON e.employeeId = t.upperDoctorId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = t.counselorId
	LEFT JOIN sys_dict d1 ON d1.did = a.source
	LEFT JOIN sys_dict d2 ON d2.did = t.observeRemark
	LEFT JOIN sys_treedictcat t1 ON t1.catId = a.channel
	LEFT JOIN com_his_patient_other ot ON ot.patientId = t.patientId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN (SELECT currRegId AS regId, SUM(currPay - currPayed) AS amount
		FROM com_his_charge_settle_bill
		WHERE isDelete = 0
		GROUP BY currRegId
		) bi ON bi.regId = t.regId
	LEFT JOIN (SELECT c.regId, GROUP_CONCAT(CASE c.assistantType WHEN 380 THEN x.employeeName END) AS assistant
		FROM com_his_treat_assistant c
			LEFT JOIN com_sys_employee x ON c.assistantId = x.employeeId
				AND c.isDelete = 0
		GROUP BY c.regId
		) x ON x.regId = t.regId
	LEFT JOIN (SELECT c.regId, GROUP_CONCAT(CASE c.assistantType WHEN 381 THEN x.employeeName END) AS assistant
		FROM com_his_treat_assistant c
			LEFT JOIN com_sys_employee x ON c.assistantId = x.employeeId
				AND c.isDelete = 0
		GROUP BY c.regId
		) y ON y.regId = t.regId
	LEFT JOIN (SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2, a.patientId
		FROM com_his_patient_extend a
			LEFT JOIN sys_dict b ON b.did = a.dictId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = '0'
			AND a.InfoType = 9
		GROUP BY a.patientId
		) d ON d.patientId = t.patientId 
	where 
	t.finishType = 361
	AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND t.iRegTime >= 20210821000000
	AND t.iRegTime <= 20210821235959"
218,5096,"select t.*,a.patientName,case when ifnull(a.birthday,'')='' then year(CURDATE()) -a.birthYear else floor(DATEDIFF(CURDATE(),a.birthday)/365) end as age,a.fileNo,d1.dict as sourceName,if(d2.did=t.observeRemark,d2.dict,observeRemark) as observeRemark,t1.catNameFull as channelName,b.employeeName as treatDoctorName,e.employeeName as upperDoctorName,e1.employeeName as counselorName,x.assistant as helperDoctor,y.assistant as helperNurse,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=a.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,bi.amount,a.sex,ot.black,ifnull(mem.memberStar,0) as memberStar, di2.dict as category1,di3.dict as category2, d.PATIENT_TAG2    from com_his_treat_register t left join com_his_patient_base a on t.patientId=a.patientId left join com_his_patient_member mem on t.patientId=mem.patientId left join com_his_patient_shop s on t.patientId=s.patientId and s.shopId=t.shopId  left join com_sys_employee b on t.treatDoctorId=b.employeeId left join com_sys_employee e on e.employeeId=t.upperDoctorId left join com_sys_employee e1 on e1.employeeId=t.counselorId left join sys_dict d1 on d1.did=a.source left join sys_dict d2 on d2.did=t.observeRemark left join sys_treedictcat t1 on t1.catId=a.channel left join com_his_patient_other ot on ot.patientId = t.patientId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join (select currRegId as regId,                    sum(currPay-currPayed) as amount              from com_his_charge_settle_bill              where isDelete=0 group by currRegId)  bi on bi.regId=t.regId left join ( select c.regId,group_concat(case c.assistantType when 380 then x.employeeName end) as assistant from com_his_treat_assistant c left join com_sys_employee x on c.assistantId=x.employeeId and c.isDelete=0 group by c.regId) x on x.regId=t.regId left join (select c.regId,group_concat(case c.assistantType when 381 then x.employeeName end)  as assistant from com_his_treat_assistant c left join com_sys_employee x on c.assistantId=x.employeeId and c.isDelete=0 group by c.regId) y on y.regId=t.regId  LEFT JOIN (select GROUP_CONCAT(b.dict) as PATIENT_TAG2,a.patientId from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and 
 a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete='0' and a.InfoType=9 group by a.patientId)d on d.patientId=t.patientId
  where t.finishType=361 and t.comId='239e97340aa84454b4c4bb36bd7879ee' and t.shopId='85c94b66653b4495bf60fac3f770f7ea' and t.iRegTime>=20210821000000 and t.iRegTime <=20210821235959 order by t.iregTime desc  limit 0, 50"
219,6269,"select count(*)  
	from 
	com_his_treat_register t
	LEFT JOIN com_his_patient_base a ON t.patientId = a.patientId
	LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON t.patientId = s.patientId
		AND s.shopId = t.shopId
	LEFT JOIN com_sys_employee b ON t.treatDoctorId = b.employeeId
	LEFT JOIN com_sys_employee e ON e.employeeId = t.upperDoctorId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = t.counselorId
	LEFT JOIN sys_dict d1 ON d1.did = a.source
	LEFT JOIN sys_dict d2 ON d2.did = t.observeRemark
	LEFT JOIN sys_treedictcat t1 ON t1.catId = a.channel
	LEFT JOIN com_his_patient_other ot ON ot.patientId = t.patientId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN (SELECT currRegId AS regId, SUM(currPay - currPayed) AS amount
		FROM com_his_charge_settle_bill
		WHERE isDelete = 0
		GROUP BY currRegId
		) bi ON bi.regId = t.regId
	LEFT JOIN (SELECT c.regId, GROUP_CONCAT(CASE c.assistantType WHEN 380 THEN x.employeeName END) AS assistant
		FROM com_his_treat_assistant c
			LEFT JOIN com_sys_employee x ON c.assistantId = x.employeeId
				AND c.isDelete = 0
		GROUP BY c.regId
		) x ON x.regId = t.regId
	LEFT JOIN (SELECT c.regId, GROUP_CONCAT(CASE c.assistantType WHEN 381 THEN x.employeeName END) AS assistant
		FROM com_his_treat_assistant c
			LEFT JOIN com_sys_employee x ON c.assistantId = x.employeeId
				AND c.isDelete = 0
		GROUP BY c.regId
		) y ON y.regId = t.regId
	LEFT JOIN (SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2, a.patientId
		FROM com_his_patient_extend a
			LEFT JOIN sys_dict b ON b.did = a.dictId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = '0'
			AND a.InfoType = 9
		GROUP BY a.patientId
		) d ON d.patientId = t.patientId 
	where 
	t.finishType = 361
	AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND t.iRegTime >= 20210821000000
	AND t.iRegTime <= 20210821235959"
220,5096,"select t.*,a.patientName,case when ifnull(a.birthday,'')='' then year(CURDATE()) -a.birthYear else floor(DATEDIFF(CURDATE(),a.birthday)/365) end as age,a.fileNo,d1.dict as sourceName,if(d2.did=t.observeRemark,d2.dict,observeRemark) as observeRemark,t1.catNameFull as channelName,b.employeeName as treatDoctorName,e.employeeName as upperDoctorName,e1.employeeName as counselorName,x.assistant as helperDoctor,y.assistant as helperNurse,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=a.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,bi.amount,a.sex,ot.black,ifnull(mem.memberStar,0) as memberStar, di2.dict as category1,di3.dict as category2, d.PATIENT_TAG2    from com_his_treat_register t left join com_his_patient_base a on t.patientId=a.patientId left join com_his_patient_member mem on t.patientId=mem.patientId left join com_his_patient_shop s on t.patientId=s.patientId and s.shopId=t.shopId  left join com_sys_employee b on t.treatDoctorId=b.employeeId left join com_sys_employee e on e.employeeId=t.upperDoctorId left join com_sys_employee e1 on e1.employeeId=t.counselorId left join sys_dict d1 on d1.did=a.source left join sys_dict d2 on d2.did=t.observeRemark left join sys_treedictcat t1 on t1.catId=a.channel left join com_his_patient_other ot on ot.patientId = t.patientId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join (select currRegId as regId,                    sum(currPay-currPayed) as amount              from com_his_charge_settle_bill              where isDelete=0 group by currRegId)  bi on bi.regId=t.regId left join ( select c.regId,group_concat(case c.assistantType when 380 then x.employeeName end) as assistant from com_his_treat_assistant c left join com_sys_employee x on c.assistantId=x.employeeId and c.isDelete=0 group by c.regId) x on x.regId=t.regId left join (select c.regId,group_concat(case c.assistantType when 381 then x.employeeName end)  as assistant from com_his_treat_assistant c left join com_sys_employee x on c.assistantId=x.employeeId and c.isDelete=0 group by c.regId) y on y.regId=t.regId  LEFT JOIN (select GROUP_CONCAT(b.dict) as PATIENT_TAG2,a.patientId from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and 
 a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete='0' and a.InfoType=9 group by a.patientId)d on d.patientId=t.patientId
  where t.finishType=361 and t.comId='239e97340aa84454b4c4bb36bd7879ee' and t.shopId='85c94b66653b4495bf60fac3f770f7ea' and t.iRegTime>=20210821000000 and t.iRegTime <=20210821235959 order by t.iregTime desc  limit 0, 50"
221,4434,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4be0c4275da24ddca19beda8445ecd68' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4be0c4275da24ddca19beda8445ecd68' )) 
222,6928,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210821000000
		AND t.iRegTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210821000000
		AND t.iBookingTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210821000000
			AND s.iCreateTime <= 20210821235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
223,4434,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4be0c4275da24ddca19beda8445ecd68' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4be0c4275da24ddca19beda8445ecd68' )) 
224,6347,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8ffbded14eb4482cab5a0ec99bb1b62c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8ffbded14eb4482cab5a0ec99bb1b62c' )) 
225,6928,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210821000000
				AND b.iCreateTime <= 20210821235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210821000000
		AND t.iRegTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210821000000
		AND t.iBookingTime <= 20210821235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210821000000
			AND s.iCreateTime <= 20210821235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210821000000
				AND b.iRegTime <= 20210821235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
226,4434,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4be0c4275da24ddca19beda8445ecd68' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4be0c4275da24ddca19beda8445ecd68' )) 
227,6347,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8ffbded14eb4482cab5a0ec99bb1b62c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8ffbded14eb4482cab5a0ec99bb1b62c' )) 
228,8679,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
229,6135,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'bcded4f7f5fe42bd944527b549a327ef' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'bcded4f7f5fe42bd944527b549a327ef' )) 
230,6045,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '0183928fa6ce49b5899aebb5797fcc0a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '0183928fa6ce49b5899aebb5797fcc0a' )) 
231,6170,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
232,6166,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '66a59860437a4d1a8231bc90c5cf5a67' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '66a59860437a4d1a8231bc90c5cf5a67' )) 
233,5933,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
234,8679,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
235,6135,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'bcded4f7f5fe42bd944527b549a327ef' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'bcded4f7f5fe42bd944527b549a327ef' )) 
236,6045,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '0183928fa6ce49b5899aebb5797fcc0a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '0183928fa6ce49b5899aebb5797fcc0a' )) 
237,6170,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
238,6166,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '66a59860437a4d1a8231bc90c5cf5a67' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '66a59860437a4d1a8231bc90c5cf5a67' )) 
239,5933,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
240,4019,"select * from sys_file where  find_in_set(fid,'2392e96012b948cd8bf8efcba91893dc,9528b153734c4a7da1fd2c14fb15d281,d2042315d43643cab774931e3a09d3c1,7a7fdce48e1b4952be9a85c2c09b0a47,9702e25c41fd489daa02e8348b4869d3,e570a61ae7de402ba56f4ffea2d8424d,a305b9baeac94985b579a3ab36399da8,654190770e80474482ef5f5ea76ad538')"
241,5691,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
242,5691,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
243,5688,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
244,5688,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
245,8323,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '0183928fa6ce49b5899aebb5797fcc0a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '0183928fa6ce49b5899aebb5797fcc0a' )) 
246,7344,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '450bf69813f546dc8e86e159459845c5' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '450bf69813f546dc8e86e159459845c5' )) 
247,7630,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
248,7451,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
249,4445,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4be0c4275da24ddca19beda8445ecd68' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4be0c4275da24ddca19beda8445ecd68' )) 
250,4361,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'ab5a3568485146ca8a9a2d43e2c8b6c7' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'ab5a3568485146ca8a9a2d43e2c8b6c7' )) 
251,4012,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e253af2f0fbe4566b47e7924def493b7' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e253af2f0fbe4566b47e7924def493b7' )) 
252,4287,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c09af088ac38410a833a2592485d3062' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c09af088ac38410a833a2592485d3062' )) 
253,4031,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '035157432e81418f9f11367324f574f9' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '035157432e81418f9f11367324f574f9' )) 
254,4445,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4be0c4275da24ddca19beda8445ecd68' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4be0c4275da24ddca19beda8445ecd68' )) 
255,4361,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'ab5a3568485146ca8a9a2d43e2c8b6c7' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'ab5a3568485146ca8a9a2d43e2c8b6c7' )) 
256,4012,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e253af2f0fbe4566b47e7924def493b7' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e253af2f0fbe4566b47e7924def493b7' )) 
257,4287,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c09af088ac38410a833a2592485d3062' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c09af088ac38410a833a2592485d3062' )) 
258,4031,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '035157432e81418f9f11367324f574f9' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '035157432e81418f9f11367324f574f9' )) 
259,7951,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
260,14452,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
261,12518,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
262,12518,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
