序号,执行时间,SQL
1,4239,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
2,4239,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
3,4239,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
4,4239,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
5,4239,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
6,4239,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
7,4239,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
8,7221,"select pb.*,b.bookingItem,b.bookingTime,b.bookingId,di.dict as source,case b.treatType when 340 then '首诊' when 341 then '再诊' else '复诊' end treatTypeName,e.employeeName as doctor,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(CURDATE()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end,case when ifnull(pb.birthday,'')='' then year(CURDATE()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age  from com_his_booking b LEFT JOIN com_sys_employee e on b.bookingDoctorId=e.employeeId left join com_his_patient_base pb on pb.patientId=b.patientId left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join sys_dict di on di.did=pb.source left join (select f.patientId,f.regId,f.bookingId as bookingId1 from com_his_treat_form f where f.formCod = 2638 and f.isDelete = 0 and f.shopId = '02c8257d6164485eb52b20b1b078696e'  and f.comId = '239e97340aa84454b4c4bb36bd7879ee' and f.iCreateTime >=20210817000000 and f.iCreateTime <=20210817235959)bb  on  b.patientId = bb.patientId and  (bb.regId=b.registerId or IFNULL(bb.regId,'')='')  where b.treatType<>340 and bb.bookingId1 is null and b.isDelete = 0 and b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and  b.status=90 and b.iBookingTime>=20210817000000 and b.iBookingTime<=20210817235959  order by b.bookingTime asc "
9,4379,select * from com_his_booking where isDelete=0 and comId=? and shopId=? and  (status=?) and iBookingTime>? and iBookingTime<=?
10,4380,select * from com_his_booking where isDelete=0 and  interimAffairs=0 and comId=? and shopId=? and (status=?) and iBookingTime<=?
11,6343,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
12,6381,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
13,6343,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
14,6381,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
15,4216,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
16,4070,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' and r.ifConsult = 0 
17,4216,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
18,4070,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' and r.ifConsult = 0 
19,6098,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
20,6098,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
21,5841,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
22,5841,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
23,5916,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
24,5916,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
25,5807,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
26,5916,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
27,5807,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
28,5939,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
29,5939,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
30,5831,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
31,5939,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
32,5831,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
33,5400,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
34,5400,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
35,5400,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
36,5400,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
37,5400,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
38,5400,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
39,5544,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
40,4141,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
41,4081,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
42,4141,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
43,4081,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
44,4141,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
45,4081,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
46,4081,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
47,5343,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
48,5343,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
49,5824,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_his_booking bo ON bo.registerId = r.regId
	INNER JOIN com_his_case c ON r.regId = c.regId
		AND c.courseStatus = 0
		AND c.isDelete = 0
	LEFT JOIN (SELECT COUNT(1) AS revisit, mainCaseId
		FROM com_his_case
		WHERE caseType <> 852
			AND ifMainCase = 0
			AND mainCaseId IS NOT NULL
			AND comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
		GROUP BY mainCaseId
		) c2 ON c2.mainCaseId = c.caseId
	LEFT JOIN com_his_case_casecat cc ON cc.caseId = c.caseId
	LEFT JOIN sys_treedictcat tr1 ON tr1.catId = cc.caseCat 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.treatDoctorId = '5cda243c1d154f2a945edc968bc24f36'
	AND c.ifMainCase = 1
	AND r.currNode = '500'
	AND (ifnull(c.status, 850) <> 852
		OR r.fillInCase = 1)"
50,5343,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='170c78524e0d495493f1f093e4f4e85b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 15"
51,5824,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_his_booking bo ON bo.registerId = r.regId
	INNER JOIN com_his_case c ON r.regId = c.regId
		AND c.courseStatus = 0
		AND c.isDelete = 0
	LEFT JOIN (SELECT COUNT(1) AS revisit, mainCaseId
		FROM com_his_case
		WHERE caseType <> 852
			AND ifMainCase = 0
			AND mainCaseId IS NOT NULL
			AND comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
		GROUP BY mainCaseId
		) c2 ON c2.mainCaseId = c.caseId
	LEFT JOIN com_his_case_casecat cc ON cc.caseId = c.caseId
	LEFT JOIN sys_treedictcat tr1 ON tr1.catId = cc.caseCat 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.treatDoctorId = '5cda243c1d154f2a945edc968bc24f36'
	AND c.ifMainCase = 1
	AND r.currNode = '500'
	AND (ifnull(c.status, 850) <> 852
		OR r.fillInCase = 1)"
52,4538,select * from com_his_treat_diagnose_teeth where regId='62cbaff894c646d298e6f95de3a5848c'
53,4538,select * from com_his_treat_diagnose_teeth where regId='62cbaff894c646d298e6f95de3a5848c'
54,4538,select * from com_his_treat_diagnose_teeth where regId='62cbaff894c646d298e6f95de3a5848c'
55,4677,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '9ba6db4a362a40b78c37864402e724e4' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='9ba6db4a362a40b78c37864402e724e4' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817103151 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817103151 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817103151 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959  AND ((r.counselorId = '9ba6db4a362a40b78c37864402e724e4'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959 )))  or (b.dutyConsultId='9ba6db4a362a40b78c37864402e724e4' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='9ba6db4a362a40b78c37864402e724e4' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 100"
56,4677,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '9ba6db4a362a40b78c37864402e724e4' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='9ba6db4a362a40b78c37864402e724e4' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817103151 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817103151 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817103151 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959  AND ((r.counselorId = '9ba6db4a362a40b78c37864402e724e4'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959 )))  or (b.dutyConsultId='9ba6db4a362a40b78c37864402e724e4' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='9ba6db4a362a40b78c37864402e724e4' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 100"
57,4677,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '9ba6db4a362a40b78c37864402e724e4' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='9ba6db4a362a40b78c37864402e724e4' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817103151 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817103151 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817103151 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959  AND ((r.counselorId = '9ba6db4a362a40b78c37864402e724e4'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959 )))  or (b.dutyConsultId='9ba6db4a362a40b78c37864402e724e4' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='9ba6db4a362a40b78c37864402e724e4' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 100"
58,4677,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '9ba6db4a362a40b78c37864402e724e4' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='9ba6db4a362a40b78c37864402e724e4' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817103151 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817103151 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817103151 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959  AND ((r.counselorId = '9ba6db4a362a40b78c37864402e724e4'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959 )))  or (b.dutyConsultId='9ba6db4a362a40b78c37864402e724e4' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='9ba6db4a362a40b78c37864402e724e4' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 100"
59,4677,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '9ba6db4a362a40b78c37864402e724e4' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='9ba6db4a362a40b78c37864402e724e4' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817103151 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817103151 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817103151 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959  AND ((r.counselorId = '9ba6db4a362a40b78c37864402e724e4'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959 )))  or (b.dutyConsultId='9ba6db4a362a40b78c37864402e724e4' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210809000000 and r.iRegTime <=20210815235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='9ba6db4a362a40b78c37864402e724e4' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 100"
60,6355,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
61,6035,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
62,6355,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
63,6035,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
64,6089,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
65,6089,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
66,6001,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
67,13322,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
68,19810,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
69,18317,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
70,18317,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
71,6403,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
72,5844,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
73,4272,"select t.* from com_his_icd_items t left outer join sys_treedictcat b on t.diagnoseCat=b.catId left join com_his_case_item_group_templete_frequency f on f.templeteId=t.itemId and f.createEmployeeId='34243d6286624e17b71c036483996eed'  where t.comId='239e97340aa84454b4c4bb36bd7879ee' and t.isDelete=0 and b.isDelete=0   order by ifnull(f.frequency,0) desc "
74,6517,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
75,5960,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
76,5960,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
77,6308,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
78,6308,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
79,5895,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
80,5895,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
81,4665,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = 'db6ed0b6b043496da39e4ff845acfaab' AND b.billType <>202 AND b.currPricingEmployeeId = '8ffbded14eb4482cab5a0ec99bb1b62c' and r.ifConsult = 0 
82,4562,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = 'db6ed0b6b043496da39e4ff845acfaab' AND b.billType <>202 AND b.currPricingEmployeeId = 'c09af088ac38410a833a2592485d3062' and r.ifConsult = 0 
83,4605,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = 'db6ed0b6b043496da39e4ff845acfaab' AND b.billType <>202 AND b.currPricingEmployeeId = 'ab5a3568485146ca8a9a2d43e2c8b6c7' and r.ifConsult = 0 
84,4418,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = 'db6ed0b6b043496da39e4ff845acfaab' AND b.billType <>202 AND b.currPricingEmployeeId = '89ceabc8fb594cb783598ac6c18d9dda' and r.ifConsult = 0 
85,4143,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210817000000
				AND b.iCreateTime <= 20210817235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210817000000
				AND b.iCreateTime <= 20210817235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210817000000
				AND b.iRegTime <= 20210817235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210817000000
		AND t.iRegTime <= 20210817235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210817000000
		AND t.iBookingTime <= 20210817235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210817000000
			AND s.iCreateTime <= 20210817235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210817000000
				AND b.iRegTime <= 20210817235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
86,6709,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
87,5970,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
88,5970,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
89,5970,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
90,5817,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210701000000
		AND a.iRegTime <= 20210731235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1
	AND treatTypeFirst = '1'"
91,4451,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
92,4451,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
93,4451,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
94,4451,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
95,4451,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
96,4451,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
97,6288,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
98,6288,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
99,6288,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
100,6392,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='db6ed0b6b043496da39e4ff845acfaab'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210801000000 and b.iBookingTime <=20210831235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
101,6392,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='db6ed0b6b043496da39e4ff845acfaab'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210801000000 and b.iBookingTime <=20210831235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
102,7416,"select pb.*,b.bookingItem,b.bookingTime,b.bookingId,di.dict as source,case b.treatType when 340 then '首诊' when 341 then '再诊' else '复诊' end treatTypeName,e.employeeName as doctor,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(CURDATE()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end,case when ifnull(pb.birthday,'')='' then year(CURDATE()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age  from com_his_booking b LEFT JOIN com_sys_employee e on b.bookingDoctorId=e.employeeId left join com_his_patient_base pb on pb.patientId=b.patientId left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join sys_dict di on di.did=pb.source left join (select f.patientId,f.regId,f.bookingId as bookingId1 from com_his_treat_form f where f.formCod = 2638 and f.isDelete = 0 and f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'  and f.comId = '239e97340aa84454b4c4bb36bd7879ee' and f.iCreateTime >=20210817000000 and f.iCreateTime <=20210817235959)bb  on  b.patientId = bb.patientId and  (bb.regId=b.registerId or IFNULL(bb.regId,'')='')  where b.treatType<>340 and bb.bookingId1 is null and b.isDelete = 0 and b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='db6ed0b6b043496da39e4ff845acfaab' and  b.status=90 and b.iBookingTime>=20210817000000 and b.iBookingTime<=20210817235959  order by b.bookingTime asc "
103,7416,"select pb.*,b.bookingItem,b.bookingTime,b.bookingId,di.dict as source,case b.treatType when 340 then '首诊' when 341 then '再诊' else '复诊' end treatTypeName,e.employeeName as doctor,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(CURDATE()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end,case when ifnull(pb.birthday,'')='' then year(CURDATE()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age  from com_his_booking b LEFT JOIN com_sys_employee e on b.bookingDoctorId=e.employeeId left join com_his_patient_base pb on pb.patientId=b.patientId left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join sys_dict di on di.did=pb.source left join (select f.patientId,f.regId,f.bookingId as bookingId1 from com_his_treat_form f where f.formCod = 2638 and f.isDelete = 0 and f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'  and f.comId = '239e97340aa84454b4c4bb36bd7879ee' and f.iCreateTime >=20210817000000 and f.iCreateTime <=20210817235959)bb  on  b.patientId = bb.patientId and  (bb.regId=b.registerId or IFNULL(bb.regId,'')='')  where b.treatType<>340 and bb.bookingId1 is null and b.isDelete = 0 and b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='db6ed0b6b043496da39e4ff845acfaab' and  b.status=90 and b.iBookingTime>=20210817000000 and b.iBookingTime<=20210817235959  order by b.bookingTime asc "
104,10631,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_his_booking bo ON bo.registerId = r.regId
	INNER JOIN com_his_case c ON r.regId = c.regId
		AND c.courseStatus = 0
		AND c.isDelete = 0
	LEFT JOIN (SELECT COUNT(1) AS revisit, mainCaseId
		FROM com_his_case
		WHERE caseType <> 852
			AND ifMainCase = 0
			AND mainCaseId IS NOT NULL
			AND comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
		GROUP BY mainCaseId
		) c2 ON c2.mainCaseId = c.caseId
	LEFT JOIN com_his_case_casecat cc ON cc.caseId = c.caseId
	LEFT JOIN sys_treedictcat tr1 ON tr1.catId = cc.caseCat 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.treatDoctorId = '1075a6ab72a24895b820f143df6894c3'
	AND c.ifMainCase = 1
	AND r.currNode = '500'
	AND (ifnull(c.status, 850) <> 852
		OR r.fillInCase = 1)"
105,10631,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_his_booking bo ON bo.registerId = r.regId
	INNER JOIN com_his_case c ON r.regId = c.regId
		AND c.courseStatus = 0
		AND c.isDelete = 0
	LEFT JOIN (SELECT COUNT(1) AS revisit, mainCaseId
		FROM com_his_case
		WHERE caseType <> 852
			AND ifMainCase = 0
			AND mainCaseId IS NOT NULL
			AND comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
		GROUP BY mainCaseId
		) c2 ON c2.mainCaseId = c.caseId
	LEFT JOIN com_his_case_casecat cc ON cc.caseId = c.caseId
	LEFT JOIN sys_treedictcat tr1 ON tr1.catId = cc.caseCat 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.treatDoctorId = '1075a6ab72a24895b820f143df6894c3'
	AND c.ifMainCase = 1
	AND r.currNode = '500'
	AND (ifnull(c.status, 850) <> 852
		OR r.fillInCase = 1)"
106,6560,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
107,4456,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
108,4456,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
109,4456,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
110,4456,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
111,4065,"select * from sys_file where  find_in_set(fid,'f8c3c95e47b34157b9f6c7d1427adc07,28a18f9ae6634ff985e9412596962094,c174985c7c3d470d96b2ef5a6890512b,002419fede8741869602f0723be735f5,98205a32faa940ccaaaa1472b696baf6,7ae694d9e0404268bb761249491fbe21,dd3b96a1d0904b7ab486fb26be661bcd,d731b0db0b4542769bd1d57384f84fe7,5cd1eb1776a945a1933778a295f36162,5de851723820428996732f00fca5d7dd,362244a301394c459784ebc4e3e13cce,12e5b46e48d34918b444cab8bc9bb12e,e89663f5ec8649ebaa897d9c13a55a0f,0251e7b9bf814abf960217a8af18992e')"
112,4065,"select * from sys_file where  find_in_set(fid,'f8c3c95e47b34157b9f6c7d1427adc07,28a18f9ae6634ff985e9412596962094,c174985c7c3d470d96b2ef5a6890512b,002419fede8741869602f0723be735f5,98205a32faa940ccaaaa1472b696baf6,7ae694d9e0404268bb761249491fbe21,dd3b96a1d0904b7ab486fb26be661bcd,d731b0db0b4542769bd1d57384f84fe7,5cd1eb1776a945a1933778a295f36162,5de851723820428996732f00fca5d7dd,362244a301394c459784ebc4e3e13cce,12e5b46e48d34918b444cab8bc9bb12e,e89663f5ec8649ebaa897d9c13a55a0f,0251e7b9bf814abf960217a8af18992e')"
113,4065,"select * from sys_file where  find_in_set(fid,'f8c3c95e47b34157b9f6c7d1427adc07,28a18f9ae6634ff985e9412596962094,c174985c7c3d470d96b2ef5a6890512b,002419fede8741869602f0723be735f5,98205a32faa940ccaaaa1472b696baf6,7ae694d9e0404268bb761249491fbe21,dd3b96a1d0904b7ab486fb26be661bcd,d731b0db0b4542769bd1d57384f84fe7,5cd1eb1776a945a1933778a295f36162,5de851723820428996732f00fca5d7dd,362244a301394c459784ebc4e3e13cce,12e5b46e48d34918b444cab8bc9bb12e,e89663f5ec8649ebaa897d9c13a55a0f,0251e7b9bf814abf960217a8af18992e')"
114,4065,"select * from sys_file where  find_in_set(fid,'f8c3c95e47b34157b9f6c7d1427adc07,28a18f9ae6634ff985e9412596962094,c174985c7c3d470d96b2ef5a6890512b,002419fede8741869602f0723be735f5,98205a32faa940ccaaaa1472b696baf6,7ae694d9e0404268bb761249491fbe21,dd3b96a1d0904b7ab486fb26be661bcd,d731b0db0b4542769bd1d57384f84fe7,5cd1eb1776a945a1933778a295f36162,5de851723820428996732f00fca5d7dd,362244a301394c459784ebc4e3e13cce,12e5b46e48d34918b444cab8bc9bb12e,e89663f5ec8649ebaa897d9c13a55a0f,0251e7b9bf814abf960217a8af18992e')"
115,4065,"select * from sys_file where  find_in_set(fid,'f8c3c95e47b34157b9f6c7d1427adc07,28a18f9ae6634ff985e9412596962094,c174985c7c3d470d96b2ef5a6890512b,002419fede8741869602f0723be735f5,98205a32faa940ccaaaa1472b696baf6,7ae694d9e0404268bb761249491fbe21,dd3b96a1d0904b7ab486fb26be661bcd,d731b0db0b4542769bd1d57384f84fe7,5cd1eb1776a945a1933778a295f36162,5de851723820428996732f00fca5d7dd,362244a301394c459784ebc4e3e13cce,12e5b46e48d34918b444cab8bc9bb12e,e89663f5ec8649ebaa897d9c13a55a0f,0251e7b9bf814abf960217a8af18992e')"
116,5943,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
117,5943,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
118,5911,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
119,5943,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
120,5911,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
121,5943,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
122,5911,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
123,4848,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
124,4848,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
125,6328,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
126,6328,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
127,5827,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
128,6328,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
129,5827,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
130,6328,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
131,5827,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
132,6328,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
133,5827,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
134,6003,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
135,7710,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_his_booking bo ON bo.registerId = r.regId
	INNER JOIN com_his_case c ON r.regId = c.regId
		AND c.courseStatus = 0
		AND c.isDelete = 0
	LEFT JOIN (SELECT COUNT(1) AS revisit, mainCaseId
		FROM com_his_case
		WHERE caseType <> 852
			AND ifMainCase = 0
			AND mainCaseId IS NOT NULL
			AND comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
		GROUP BY mainCaseId
		) c2 ON c2.mainCaseId = c.caseId
	LEFT JOIN com_his_case_casecat cc ON cc.caseId = c.caseId
	LEFT JOIN sys_treedictcat tr1 ON tr1.catId = cc.caseCat 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.treatDoctorId = 'e4255bec80b74fcca52b4e7e90e5ce3c'
	AND c.ifMainCase = 1
	AND r.currNode = '500'
	AND (ifnull(c.status, 850) <> 852
		OR r.fillInCase = 1)"
136,7710,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_his_booking bo ON bo.registerId = r.regId
	INNER JOIN com_his_case c ON r.regId = c.regId
		AND c.courseStatus = 0
		AND c.isDelete = 0
	LEFT JOIN (SELECT COUNT(1) AS revisit, mainCaseId
		FROM com_his_case
		WHERE caseType <> 852
			AND ifMainCase = 0
			AND mainCaseId IS NOT NULL
			AND comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
		GROUP BY mainCaseId
		) c2 ON c2.mainCaseId = c.caseId
	LEFT JOIN com_his_case_casecat cc ON cc.caseId = c.caseId
	LEFT JOIN sys_treedictcat tr1 ON tr1.catId = cc.caseCat 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.treatDoctorId = 'e4255bec80b74fcca52b4e7e90e5ce3c'
	AND c.ifMainCase = 1
	AND r.currNode = '500'
	AND (ifnull(c.status, 850) <> 852
		OR r.fillInCase = 1)"
137,4855,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
138,4855,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
139,4855,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
140,4855,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
141,4855,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
142,4855,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
143,4855,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
144,14649,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817121749 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817121749 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817121749 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
145,14649,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817121749 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817121749 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817121749 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
146,14649,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817121749 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817121749 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817121749 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
147,12174,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817121807 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817121807 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817121807 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
148,14649,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817121749 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817121749 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817121749 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
149,12174,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817121807 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817121807 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817121807 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
150,14649,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817121749 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817121749 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817121749 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
151,12174,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817121807 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817121807 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817121807 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
152,12174,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817121807 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817121807 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817121807 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
153,4306,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' and r.ifConsult = 0 
154,4306,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' and r.ifConsult = 0 
155,5435,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' and r.ifConsult = 0 
156,5276,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
157,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
158,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
159,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
160,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
161,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
162,6564,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
163,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
164,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
165,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
166,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
167,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
168,7808,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
169,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
170,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
171,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
172,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
173,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
174,7808,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
175,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
176,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
177,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
178,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
179,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
180,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
181,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
182,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
183,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
184,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
185,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
186,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
187,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
188,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
189,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
190,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
191,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
192,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
193,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
194,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
195,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
196,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
197,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
198,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
199,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
200,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
201,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
202,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
203,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
204,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
205,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
206,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
207,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
208,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
209,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
210,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
211,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
212,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
213,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
214,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
215,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
216,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
217,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
218,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
219,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
220,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
221,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
222,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
223,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
224,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
225,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
226,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
227,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
228,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
229,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
230,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
231,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
232,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
233,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
234,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
235,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
236,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
237,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
238,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
239,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
240,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
241,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
242,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
243,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
244,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
245,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
246,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
247,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
248,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
249,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
250,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
251,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
252,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
253,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
254,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
255,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
256,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
257,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
258,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
259,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
260,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
261,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
262,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
263,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
264,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
265,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
266,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
267,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
268,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
269,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
270,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
271,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
272,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
273,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
274,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
275,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
276,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
277,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
278,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
279,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
280,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
281,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
282,10384,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%李筱%' or b.searchCode like '%李筱%' or b.phone1 like '%李筱%' or e1.employeeName like '%李筱%' or e2.employeeName like '%李筱%' or e3.employeeName like '%李筱%' or d2.dept like '%李筱%' or d3.dept like '%李筱%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
283,7116,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
284,7259,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
285,13475,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
286,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
287,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
288,6717,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
289,6614,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '1075a6ab72a24895b820f143df6894c3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '1075a6ab72a24895b820f143df6894c3' )) 
290,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
291,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
292,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
293,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
294,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
295,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
296,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
297,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
298,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
299,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
300,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
301,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
302,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
303,9488,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
304,8151,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%代金%' or b.searchCode like '%代金%' or b.phone1 like '%代金%' or e1.employeeName like '%代金%' or e2.employeeName like '%代金%' or e3.employeeName like '%代金%' or d2.dept like '%代金%' or d3.dept like '%代金%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
305,7838,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
306,7804,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
307,7838,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
308,6743,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%代金%' or b.searchCode like '%代金%' or b.phone1 like '%代金%' or e1.employeeName like '%代金%' or e2.employeeName like '%代金%' or e3.employeeName like '%代金%' or d2.dept like '%代金%' or d3.dept like '%代金%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
309,7804,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
310,5865,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
311,7838,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
312,6743,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%代金%' or b.searchCode like '%代金%' or b.phone1 like '%代金%' or e1.employeeName like '%代金%' or e2.employeeName like '%代金%' or e3.employeeName like '%代金%' or d2.dept like '%代金%' or d3.dept like '%代金%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
313,7804,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
314,5865,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
315,7838,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
316,6743,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%代金%' or b.searchCode like '%代金%' or b.phone1 like '%代金%' or e1.employeeName like '%代金%' or e2.employeeName like '%代金%' or e3.employeeName like '%代金%' or d2.dept like '%代金%' or d3.dept like '%代金%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
317,7804,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
318,6286,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210701000000
		AND a.iRegTime <= 20210731235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1"
319,5865,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
320,7838,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
321,6743,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%代金%' or b.searchCode like '%代金%' or b.phone1 like '%代金%' or e1.employeeName like '%代金%' or e2.employeeName like '%代金%' or e3.employeeName like '%代金%' or d2.dept like '%代金%' or d3.dept like '%代金%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
322,7804,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
323,6286,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210701000000
		AND a.iRegTime <= 20210731235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1"
324,5865,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
325,7804,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
326,6286,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210701000000
		AND a.iRegTime <= 20210731235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1"
327,5865,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
328,7804,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
329,6286,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210701000000
		AND a.iRegTime <= 20210731235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1"
330,5865,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
331,7804,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
332,6286,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210701000000
		AND a.iRegTime <= 20210731235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1"
333,5865,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
334,6286,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210701000000
		AND a.iRegTime <= 20210731235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1"
335,5865,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
336,6483," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='85c94b66653b4495bf60fac3f770f7ea' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
337,6483," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='85c94b66653b4495bf60fac3f770f7ea' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
338,7420," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='85c94b66653b4495bf60fac3f770f7ea' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
339,7420," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='85c94b66653b4495bf60fac3f770f7ea' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
340,7420," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='85c94b66653b4495bf60fac3f770f7ea' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
341,6942,select * from com_his_booking where isDelete=0 and  interimAffairs=0 and comId=? and shopId=? and (status=?) and iBookingTime<=?
342,6942,select * from com_his_booking where isDelete=0 and  interimAffairs=0 and comId=? and shopId=? and (status=?) and iBookingTime<=?
343,7580,select * from com_his_booking where isDelete=0 and  interimAffairs=0 and comId=? and shopId=? and (status=?) and iBookingTime<=?
344,8890,select * from com_his_booking where isDelete=0 and  interimAffairs=0 and comId=? and shopId=? and (status=?) and iBookingTime<=?
345,7466,select * from com_his_booking where isDelete=0 and comId=? and shopId=? and  (status=?) and iBookingTime>? and iBookingTime<=?
346,7466,select * from com_his_booking where isDelete=0 and comId=? and shopId=? and  (status=?) and iBookingTime>? and iBookingTime<=?
347,7466,select * from com_his_booking where isDelete=0 and comId=? and shopId=? and  (status=?) and iBookingTime>? and iBookingTime<=?
348,4170,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
349,4170,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
350,4170,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
351,5605,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
352,4687,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%代金%' or b.searchCode like '%代金%' or b.phone1 like '%代金%' or e1.employeeName like '%代金%' or e2.employeeName like '%代金%' or e3.employeeName like '%代金%' or d2.dept like '%代金%' or d3.dept like '%代金%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
353,8013,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
354,6053,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%代金%' or b.searchCode like '%代金%' or b.phone1 like '%代金%' or e1.employeeName like '%代金%' or e2.employeeName like '%代金%' or e3.employeeName like '%代金%' or d2.dept like '%代金%' or d3.dept like '%代金%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
355,6435,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
356,6435,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
357,5022,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%代金%' or b.searchCode like '%代金%' or b.phone1 like '%代金%' or e1.employeeName like '%代金%' or e2.employeeName like '%代金%' or e3.employeeName like '%代金%' or d2.dept like '%代金%' or d3.dept like '%代金%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
358,8317,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
359,6265,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%代金%' or b.searchCode like '%代金%' or b.phone1 like '%代金%' or e1.employeeName like '%代金%' or e2.employeeName like '%代金%' or e3.employeeName like '%代金%' or d2.dept like '%代金%' or d3.dept like '%代金%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
360,9884,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
361,7507,"select r.*,di8.dict as noDealReason, tr1.catName as appealName1, (SELECT b.billId from com_his_charge_bill b LEFT JOIN com_his_charge_bill_items i on b.billId = i.billId 
where b.regId=r.regId and  i.itemType in (17,18) and b.ifSettle=1 GROUP BY b.billId LIMIT 1 ) as billId,  case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,e1.employeeName regEmployeeName,e2.employeeName counselorName,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId LIMIT 1) as batch,(select GROUP_CONCAT(b.catName) as PATIENT_TAG1 from com_his_patient_extend a1 LEFT JOIN sys_treedictcat b on b.catId=a1.dictId where a1.patientId=r.patientId 
  and a1.isDelete='0' and a1.InfoType=8) as PATIENT_TAG1, case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end as age,e6.employeeName as dutyDoctorName,b.fileNo,di6.dict as sourceName,tree.catNameFull as channelName,d2.dept consultDept,e3.employeeName treatDoctorName,e3.employeeId as doctorId,d3.dept treatDeptName,ifnull(mem.memberStar,0) as memberStar,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,case when r.currNode=500 and r.treatStatus=1064 and r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.createTime,now())  else 0 end as regWaitMin, CASE WHEN r.currNode = 600 AND r.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, r.regTime, now()) ELSE 0 END AS recWaitMin,b.sex,ot.black,sf.toDoctorId,sf.toRegId, case when LOCATE('正畸', di.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', di.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', di.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1, di.dict as appealName , di2.dict as category1, di3.dict as category2, di5.dict as memberLevelName,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10350 and q.isDelete=0 GROUP BY q.patientId ) as questatus,(select q.status from com_his_questionnaire q where q.regId=r.regId and q.patientId=r.patientId and q.status = 10353 and q.isDelete=0 GROUP BY q.patientId ) as questatus1, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,d7.dict as AttendRelation  
   from com_his_treat_register r left join com_his_booking book on r.regId=book.registerId left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join com_sys_employee e1 on e1.employeeId=r.regEmployeeId left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left join sys_dict di on di.did=r.appeal  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di2 on di2.did = ot.category1  left join sys_dict di3 on di3.did = ot.category2  left join sys_dict di5 on di5.did = mem.memberLevel  left outer join sys_dict di6 on b.source = di6.did left join sys_dict d7 on d7.did=r.AttendRelationship  left outer join sys_treedictcat tree on b.channel=tree.catId  left join sys_dict di8 on di8.did = r.noDealReason  left join com_his_treat_transfer sf on r.regId=sf.regId and sf.status=1001   where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'  and ( b.patientName like '%代金%' or b.searchCode like '%代金%' or b.phone1 like '%代金%' or e1.employeeName like '%代金%' or e2.employeeName like '%代金%' or e3.employeeName like '%代金%' or d2.dept like '%代金%' or d3.dept like '%代金%' ) and r.iRegTime>=20210101000000 and r.iRegTime <=20211231235959 order by r.iRegTime desc  limit 0, 50"
362,4760,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
363,4760,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
364,4760,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
365,4760,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
366,4760,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%代金%'
		OR b.searchCode LIKE '%代金%'
		OR b.phone1 LIKE '%代金%'
		OR e1.employeeName LIKE '%代金%'
		OR e2.employeeName LIKE '%代金%'
		OR e3.employeeName LIKE '%代金%'
		OR d2.dept LIKE '%代金%'
		OR d3.dept LIKE '%代金%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
367,4829,select * from com_his_treat_diagnose_teeth where regId='b488a30da83a475894ab84d321ba9859'
368,4829,select * from com_his_treat_diagnose_teeth where regId='b488a30da83a475894ab84d321ba9859'
369,5495,select * from com_his_treat_diagnose_teeth where regId='b488a30da83a475894ab84d321ba9859'
370,5495,select * from com_his_treat_diagnose_teeth where regId='b488a30da83a475894ab84d321ba9859'
371,5495,select * from com_his_treat_diagnose_teeth where regId='b488a30da83a475894ab84d321ba9859'
372,6675,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
373,6675,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
374,5969,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
375,6675,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
376,5969,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
377,6054,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
378,6054,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
379,6054,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
380,13567,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817125300 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817125300 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817125300 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
381,13567,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817125300 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817125300 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817125300 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
382,13567,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817125300 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817125300 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817125300 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
383,4782,select * from com_his_treat_diagnose_teeth where regId='a7a4e5f160db49b2b5b5e9b3a290c03c'
384,4782,select * from com_his_treat_diagnose_teeth where regId='a7a4e5f160db49b2b5b5e9b3a290c03c'
385,6631,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
386,6631,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
387,5915,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
388,4858,"select * from sys_file where  find_in_set(fid,'7d9d5d0acbff49199915092ac76fc9b0,99497538d7814266bb76b0904c87f1dd,747ee6c3d1a6462eba7cfa6e02a0a521,2aac3b676cc04ae2b4b30db74bdeec81,ba5ae74b9c9d42df92923f08ecfbc9a0,c0af0eb838bd4edd9419f1201a52d063,5c966e6bea7d4887be1c3e2ebec827b1,ba396fdc327d439e831de1095995f051')"
389,5988,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
390,6076,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
391,5988,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
392,6076,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
393,5988,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
394,6076,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
395,6047,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
396,6073,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
397,6047,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
398,6073,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
399,6047,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
400,6073,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
401,6047,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
402,6073,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
403,4023,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210801000000
		AND a.iRegTime <= 20210831235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1"
404,4023,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210801000000
		AND a.iRegTime <= 20210831235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1"
405,4023,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210801000000
		AND a.iRegTime <= 20210831235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1"
406,4023,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210801000000
		AND a.iRegTime <= 20210831235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1"
407,4023,"select count(*)  
	from 
	(SELECT a.*, ot.black, bo.bookingTime, IFNULL(bo.extraBooking, 0) AS extraBooking, (
			SELECT SUM(ifnull(f.waitDuration, 0))
			FROM com_his_treat_flow f
			WHERE f.isDelete = 0
				AND f.currNode = 500
				AND f.regId = a.regId
			GROUP BY f.regId
			) AS treatWaitDuration1
		, CASE WHEN a.treatStatus = 1068
		AND a.finishType = 379 THEN 1069 WHEN a.treatStatus = 1068
		AND a.finishType = 362 THEN 1070 ELSE a.treatStatus END AS treatStatus1, CASE WHEN ifnull(tr1.catName, '') != '' THEN tr1.catName WHEN ifnull(i.dict, '') != '' THEN i.dict END AS newAppeal, tr1.catName AS appealName1, sd.deptFull AS treatDeptName, sd.deptIdFull
		, ifNull(di1.dict, a.noDealReason) AS noDealReason1, e2.employeeName AS dutyConsultName, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_patient_agreement
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isAgreement, CASE WHEN EXISTS (SELECT patientSign
			FROM com_his_charge_bill
			WHERE patientId = a.patientId
				AND regId = a.regId
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND isDelete = 0) = '' THEN 0 ELSE 1 END AS isCharge, g.employeeName AS treatDoctorName
		, h.employeeName AS regEmployeeName, i.dict AS appealName, CASE WHEN a.treatType = 340 THEN 1 ELSE 0 END AS treatTypeFirst, CASE WHEN a.treatType = 341 THEN 1 ELSE 0 END AS treatTypeAgain, CASE WHEN a.treatType = 342 THEN 1 ELSE 0 END AS treatTypeSecond
		, CASE WHEN a.finishType = 379 THEN 1 ELSE 0 END AS finishTypeCancel, CASE WHEN ifnull(b.birthday, '') = '' THEN year(CURDATE()) - b.birthYear ELSE floor(DATEDIFF(CURDATE(), b.birthday) / 365) END AS age, b.sex, b.searchCode, b.patientName
		, d.catNameFull AS channelName, d.catIdFull, tr1.catIdFull AS catIdFull1, e.dict AS sourceName, b.source
		, b.fileNo, if(a.finishType IN (360, 361), 1, 0) AS treatTimes, CONVERT(PERIOD_DIFF(DATE_FORMAT(c.lastDiagTime, '%Y%m'), DATE_FORMAT(c.firstDiagTime, '%Y%m')) / 12, DECIMAL(18, 2)) AS treatAge, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.amount)) AS amount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS amount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount)) AS actualAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS actualAmount
		, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.actualAmount - IFNULL(b.derate, 0) - IFNULL(b.balance, 0))) AS settleAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS settleAmount, (
			SELECT SUM(IF(b.planCharge = 1
				AND b.isCorrelativePlan = 1, 0, b.balance)) AS balanceAmount
			FROM com_his_charge_bill_items b
				LEFT JOIN com_his_charge_bill bl ON bl.billId = b.billId
			WHERE FIND_IN_SET(bl.billType, '200,201,203')
				AND bl.hidden = 0
				AND bl.status <> 239
				AND b.isGroup = 0
				AND b.isDelete = 0
				AND b.regId = a.regId
			) AS balanceAmount, (
			SELECT COUNT(se.introducerId) AS recommNum
			FROM com_his_patient_base se
			WHERE se.introducerType = 31
				AND se.introducerId = b.patientId
			) AS recommNum, l.employeeName AS counselorName, (
			SELECT SUM(CASE WHEN c.applyId IS NULL THEN fe.regFee ELSE c.regFee END) AS regFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldRegFee
		, (
			SELECT SUM(c.fileCreateFee) AS fileCreateFee
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS oldFileCreateFee, (
			SELECT GROUP_CONCAT(DISTINCT b.payway) AS payway
			FROM com_his_treat_register_fee fe
				INNER JOIN com_his_payway b ON fe.payWay = b.payWayId
				LEFT JOIN com_his_treat_register_fee_apply c ON fe.regFeeId = c.settleId
			WHERE fe.isDelete = 0
				AND fe.regId = a.regId
			) AS regPayway, e1.employeeName AS upperDoctorName, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName
			FROM com_his_treat_assistant ata
				LEFT JOIN com_sys_employee b ON ata.assistantId = b.employeeId
			WHERE ata.regId = a.regId
				AND ata.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND ata.isDelete = 0
				AND ata.assistantType = 380
			) AS helperDoctor, b.introducer
		, (
			SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName
			FROM com_his_treat_assistant ass
				LEFT JOIN com_sys_employee b ON ass.assistantId = b.employeeId
			WHERE ass.regId = a.regId
				AND ass.isDelete = 0
				AND ass.assistantType = 381
			) AS helperNurse, sh.shopName, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = a.regId
			LIMIT 1
			) AS consult, b.introducerType, (
			SELECT s.employeeName
			FROM com_sys_employee s
			WHERE s.employeeId = a.dutyDoctorId
			) AS dutyDoctorName
		, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.treatDeptId
			) AS treatDept, (
			SELECT dept
			FROM com_sys_dept
			WHERE deptId = a.consultDeptId
			) AS consultDept, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, CASE WHEN o.transferId IS NULL THEN 0 ELSE 1 END AS ifTransferOther, IF(a.ifAppoint = 0, a.ifConsultAppoint, a.ifAppoint) AS appoint
		, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3
	FROM com_his_treat_register a
		LEFT JOIN com_his_patient_base b ON a.patientId = b.patientId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN com_his_treat_transfer_to_other o ON o.patientId = b.patientId
		LEFT JOIN com_his_patient_shop c ON b.patientId = c.patientId
			AND c.shopId = a.shopId
		LEFT JOIN sys_treedictcat d ON d.catId = b.channel
		LEFT JOIN sys_dict e ON e.did = b.source
		LEFT JOIN sys_treedictcat tr1 ON a.appeal = tr1.catId
		LEFT JOIN com_sys_employee g ON g.employeeId = a.treatDoctorId
		LEFT JOIN com_sys_employee h ON h.employeeId = a.regEmployeeId
		LEFT JOIN com_sys_employee l ON a.counselorId = l.employeeId
			AND a.ifConsult = 1
		LEFT JOIN com_sys_employee e1 ON a.upperDoctorId = e1.employeeId
		LEFT JOIN com_sys_employee e2 ON a.dutyConsultId = e2.employeeId
		LEFT JOIN com_sys_shop sh ON sh.shopId = a.shopId
		LEFT JOIN com_sys_dept sd ON sd.deptId = a.treatDeptId
		LEFT JOIN (SELECT bookingTime, registerId, IFNULL(extraBooking, 0) AS extraBooking
			FROM com_his_booking
			WHERE NOT registerId IS NULL
			) bo ON bo.registerId = a.regId
		LEFT JOIN sys_dict di1 ON a.noDealReason = di1.did
		LEFT JOIN sys_dict i ON i.did = a.appeal
	WHERE a.isDelete = 0
		AND a.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND a.iRegTime >= 20210801000000
		AND a.iRegTime <= 20210831235959
	GROUP BY a.regId
	) a 
	where 
	1 = 1"
408,10048,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '6ed5e1e627c54951bf55f89da1beabb6' )) 
409,9759,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
410,5137," select * from ( select distinct e.employeeId as objectId ,e.employeeName as objectName ,e.empNo,cou.bookNumber   ,group_CONCAT(a.startTime0 SEPARATOR '/-') AS startTime0 ,group_CONCAT(a.startTime1 SEPARATOR '/-') AS startTime1 ,group_CONCAT(a.startTime2 SEPARATOR '/-') AS startTime2 ,group_CONCAT(a.startTime3 SEPARATOR '/-') AS startTime3 ,group_CONCAT(a.startTime4 SEPARATOR '/-') AS startTime4 ,group_CONCAT(a.startTime5 SEPARATOR '/-') AS startTime5 ,group_CONCAT(a.startTime6 SEPARATOR '/-') AS startTime6 ,group_CONCAT(a.startTime7 SEPARATOR '/-') AS startTime7 ,group_CONCAT(a.startTime8 SEPARATOR '/-') AS startTime8 ,group_CONCAT(a.startTime9 SEPARATOR '/-') AS startTime9 ,group_CONCAT(a.startTime10 SEPARATOR '/-') AS startTime10 ,group_CONCAT(a.startTime11 SEPARATOR '/-') AS startTime11 ,group_CONCAT(a.startTime12 SEPARATOR '/-') AS startTime12 ,group_CONCAT(a.startTime13 SEPARATOR '/-') AS startTime13 ,group_CONCAT(a.startTime14 SEPARATOR '/-') AS startTime14 ,group_CONCAT(a.startTime15 SEPARATOR '/-') AS startTime15 ,group_CONCAT(a.startTime16 SEPARATOR '/-') AS startTime16 ,group_CONCAT(a.startTime17 SEPARATOR '/-') AS startTime17 ,group_CONCAT(a.startTime18 SEPARATOR '/-') AS startTime18 ,group_CONCAT(a.startTime19 SEPARATOR '/-') AS startTime19 ,group_CONCAT(a.startTime20 SEPARATOR '/-') AS startTime20 ,group_CONCAT(a.startTime21 SEPARATOR '/-') AS startTime21 ,group_CONCAT(a.startTime22 SEPARATOR '/-') AS startTime22 ,group_CONCAT(a.startTime23 SEPARATOR '/-') AS startTime23 ,group_CONCAT(a.startTime24 SEPARATOR '/-') AS startTime24 ,group_CONCAT(a.startTime25 SEPARATOR '/-') AS startTime25 ,group_CONCAT(a.startTime26 SEPARATOR '/-') AS startTime26 ,group_CONCAT(a.startTime27 SEPARATOR '/-') AS startTime27 ,group_CONCAT(a.startTime28 SEPARATOR '/-') AS startTime28 from com_his_doctor_treatment_scheme ec  left join com_his_employee_config c on  c.employeeId =ec.doctorId and c.treatment=1  and c.isDelete=0 and c.shopId='02c8257d6164485eb52b20b1b078696e'  left join ( select  case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.bookingTime,'%H:%i')<'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:30')   or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.endTime,'%H:%i')<='08:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime0, case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.bookingTime,'%H:%i')<'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'09:00')   or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.endTime,'%H:%i')<='09:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime1, case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.bookingTime,'%H:%i')<'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:30')   or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.endTime,'%H:%i')<='09:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime2, case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.bookingTime,'%H:%i')<'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'10:00')   or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.endTime,'%H:%i')<='10:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime3, case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.bookingTime,'%H:%i')<'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:30')   or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.endTime,'%H:%i')<='10:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime4, case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.bookingTime,'%H:%i')<'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'11:00')   or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.endTime,'%H:%i')<='11:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime5, case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.bookingTime,'%H:%i')<'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:30')   or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.endTime,'%H:%i')<='11:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime6, case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.bookingTime,'%H:%i')<'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'12:00')   or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.endTime,'%H:%i')<='12:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime7, case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.bookingTime,'%H:%i')<'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:30')   or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.endTime,'%H:%i')<='12:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime8, case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.bookingTime,'%H:%i')<'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'13:00')   or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.endTime,'%H:%i')<='13:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime9, case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.bookingTime,'%H:%i')<'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:30')   or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.endTime,'%H:%i')<='13:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime10, case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.bookingTime,'%H:%i')<'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'14:00')   or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.endTime,'%H:%i')<='14:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime11, case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.bookingTime,'%H:%i')<'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:30')   or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.endTime,'%H:%i')<='14:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime12, case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.bookingTime,'%H:%i')<'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'15:00')   or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.endTime,'%H:%i')<='15:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime13, case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.bookingTime,'%H:%i')<'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:30')   or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.endTime,'%H:%i')<='15:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime14, case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.bookingTime,'%H:%i')<'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'16:00')   or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.endTime,'%H:%i')<='16:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime15, case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.bookingTime,'%H:%i')<'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:30')   or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.endTime,'%H:%i')<='16:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime16, case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.bookingTime,'%H:%i')<'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'17:00')   or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.endTime,'%H:%i')<='17:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime17, case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.bookingTime,'%H:%i')<'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:30')   or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.endTime,'%H:%i')<='17:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime18, case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.bookingTime,'%H:%i')<'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'18:00')   or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.endTime,'%H:%i')<='18:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime19, case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.bookingTime,'%H:%i')<'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:30')   or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.endTime,'%H:%i')<='18:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime20, case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.bookingTime,'%H:%i')<'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'19:00')   or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.endTime,'%H:%i')<='19:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime21, case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.bookingTime,'%H:%i')<'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:30')   or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.endTime,'%H:%i')<='19:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime22, case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.bookingTime,'%H:%i')<'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'20:00')   or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.endTime,'%H:%i')<='20:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime23, case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.bookingTime,'%H:%i')<'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:30')   or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.endTime,'%H:%i')<='20:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime24, case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.bookingTime,'%H:%i')<'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'21:00')   or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.endTime,'%H:%i')<='21:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime25, case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.bookingTime,'%H:%i')<'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:30')   or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.endTime,'%H:%i')<='21:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime26, case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.bookingTime,'%H:%i')<'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'22:00')   or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.endTime,'%H:%i')<='22:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime27, case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.bookingTime,'%H:%i')<'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:30')   or (date_format(b.bookingTime,'%H:%i')<'22:30' and date_format(b.endTime,'%H:%i')>'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.endTime,'%H:%i')<='22:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime28, b.bookingDoctorId   from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 order by bookingTime ) a on a.bookingDoctorId=ec.doctorId  left join com_sys_employee e on e.employeeId=ec.doctorId  left join (select count(*) as bookNumber,b.bookingDoctorId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93  GROUP BY b.bookingDoctorId ) cou on cou.bookingDoctorId=ec.doctorId   where  ec.comId='239e97340aa84454b4c4bb36bd7879ee' and ec.shopId='02c8257d6164485eb52b20b1b078696e' and ec.isDelete=0  and ec.iStartTime>=20210818000000 and ec.iStartTime<=20210818235959  GROUP BY ec.schemeId  order by c.treatmentSort is null,
	c.treatmentSort ASc ) a  UNION ALL select * from ( select de.deptId as objectId ,de.dept as objectName ,'' as empNo,cou.bookNumber  ,group_CONCAT(a.startTime0 SEPARATOR '/-') AS startTime0 ,group_CONCAT(a.startTime1 SEPARATOR '/-') AS startTime1 ,group_CONCAT(a.startTime2 SEPARATOR '/-') AS startTime2 ,group_CONCAT(a.startTime3 SEPARATOR '/-') AS startTime3 ,group_CONCAT(a.startTime4 SEPARATOR '/-') AS startTime4 ,group_CONCAT(a.startTime5 SEPARATOR '/-') AS startTime5 ,group_CONCAT(a.startTime6 SEPARATOR '/-') AS startTime6 ,group_CONCAT(a.startTime7 SEPARATOR '/-') AS startTime7 ,group_CONCAT(a.startTime8 SEPARATOR '/-') AS startTime8 ,group_CONCAT(a.startTime9 SEPARATOR '/-') AS startTime9 ,group_CONCAT(a.startTime10 SEPARATOR '/-') AS startTime10 ,group_CONCAT(a.startTime11 SEPARATOR '/-') AS startTime11 ,group_CONCAT(a.startTime12 SEPARATOR '/-') AS startTime12 ,group_CONCAT(a.startTime13 SEPARATOR '/-') AS startTime13 ,group_CONCAT(a.startTime14 SEPARATOR '/-') AS startTime14 ,group_CONCAT(a.startTime15 SEPARATOR '/-') AS startTime15 ,group_CONCAT(a.startTime16 SEPARATOR '/-') AS startTime16 ,group_CONCAT(a.startTime17 SEPARATOR '/-') AS startTime17 ,group_CONCAT(a.startTime18 SEPARATOR '/-') AS startTime18 ,group_CONCAT(a.startTime19 SEPARATOR '/-') AS startTime19 ,group_CONCAT(a.startTime20 SEPARATOR '/-') AS startTime20 ,group_CONCAT(a.startTime21 SEPARATOR '/-') AS startTime21 ,group_CONCAT(a.startTime22 SEPARATOR '/-') AS startTime22 ,group_CONCAT(a.startTime23 SEPARATOR '/-') AS startTime23 ,group_CONCAT(a.startTime24 SEPARATOR '/-') AS startTime24 ,group_CONCAT(a.startTime25 SEPARATOR '/-') AS startTime25 ,group_CONCAT(a.startTime26 SEPARATOR '/-') AS startTime26 ,group_CONCAT(a.startTime27 SEPARATOR '/-') AS startTime27 ,group_CONCAT(a.startTime28 SEPARATOR '/-') AS startTime28 from com_his_dept_config dc  left join ( select  case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.bookingTime,'%H:%i')<'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:30')   or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.endTime,'%H:%i')<='08:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime0, case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.bookingTime,'%H:%i')<'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'09:00')   or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.endTime,'%H:%i')<='09:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime1, case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.bookingTime,'%H:%i')<'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:30')   or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.endTime,'%H:%i')<='09:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime2, case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.bookingTime,'%H:%i')<'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'10:00')   or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.endTime,'%H:%i')<='10:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime3, case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.bookingTime,'%H:%i')<'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:30')   or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.endTime,'%H:%i')<='10:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime4, case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.bookingTime,'%H:%i')<'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'11:00')   or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.endTime,'%H:%i')<='11:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime5, case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.bookingTime,'%H:%i')<'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:30')   or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.endTime,'%H:%i')<='11:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime6, case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.bookingTime,'%H:%i')<'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'12:00')   or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.endTime,'%H:%i')<='12:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime7, case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.bookingTime,'%H:%i')<'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:30')   or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.endTime,'%H:%i')<='12:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime8, case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.bookingTime,'%H:%i')<'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'13:00')   or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.endTime,'%H:%i')<='13:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime9, case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.bookingTime,'%H:%i')<'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:30')   or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.endTime,'%H:%i')<='13:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime10, case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.bookingTime,'%H:%i')<'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'14:00')   or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.endTime,'%H:%i')<='14:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime11, case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.bookingTime,'%H:%i')<'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:30')   or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.endTime,'%H:%i')<='14:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime12, case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.bookingTime,'%H:%i')<'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'15:00')   or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.endTime,'%H:%i')<='15:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime13, case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.bookingTime,'%H:%i')<'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:30')   or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.endTime,'%H:%i')<='15:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime14, case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.bookingTime,'%H:%i')<'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'16:00')   or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.endTime,'%H:%i')<='16:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime15, case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.bookingTime,'%H:%i')<'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:30')   or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.endTime,'%H:%i')<='16:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime16, case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.bookingTime,'%H:%i')<'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'17:00')   or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.endTime,'%H:%i')<='17:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime17, case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.bookingTime,'%H:%i')<'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:30')   or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.endTime,'%H:%i')<='17:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime18, case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.bookingTime,'%H:%i')<'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'18:00')   or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.endTime,'%H:%i')<='18:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime19, case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.bookingTime,'%H:%i')<'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:30')   or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.endTime,'%H:%i')<='18:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime20, case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.bookingTime,'%H:%i')<'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'19:00')   or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.endTime,'%H:%i')<='19:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime21, case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.bookingTime,'%H:%i')<'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:30')   or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.endTime,'%H:%i')<='19:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime22, case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.bookingTime,'%H:%i')<'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'20:00')   or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.endTime,'%H:%i')<='20:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime23, case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.bookingTime,'%H:%i')<'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:30')   or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.endTime,'%H:%i')<='20:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime24, case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.bookingTime,'%H:%i')<'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'21:00')   or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.endTime,'%H:%i')<='21:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime25, case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.bookingTime,'%H:%i')<'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:30')   or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.endTime,'%H:%i')<='21:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime26, case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.bookingTime,'%H:%i')<'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'22:00')   or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.endTime,'%H:%i')<='22:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime27, case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.bookingTime,'%H:%i')<'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:30')   or (date_format(b.bookingTime,'%H:%i')<'22:30' and date_format(b.endTime,'%H:%i')>'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.endTime,'%H:%i')<='22:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime28, b.bookingDeptId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 and ifnull(b.bookingDoctorId,'')=''  order by bookingTime ) a on a.bookingDeptId=dc.configDeptId  left join (select count(*) as bookNumber,b.bookingDeptId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 and ifnull(b.bookingDoctorId,'')=''  GROUP BY b.bookingDeptId ) cou on cou.bookingDeptId=dc.configDeptId   left join com_sys_dept de on de.deptId=dc.configDeptId  where  dc.comId='239e97340aa84454b4c4bb36bd7879ee' and dc.shopId='02c8257d6164485eb52b20b1b078696e' and dc.treatment=1 and  dc.isDelete=0  and cou.bookNumber>0  GROUP BY objectId  order by dc.treatmentSort asc) b  limit 0, 100"
411,9436,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
412,8671,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
413,8393,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
414,8537,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3fa93ee8295041b7bc2c5341930d00af' )) 
415,8535,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
416,7747,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
417,4284,"select count(r.regId) from com_his_treat_register r left join com_his_consult c on r.regId = c.regId where r.comId = '239e97340aa84454b4c4bb36bd7879ee' and r.shopId = '85c94b66653b4495bf60fac3f770f7ea' and r.isDelete = 0 and r.ifConsult = 1 and ifNull(c.consultId, '') = '' and r.treatStatus = 1068 and r.finishType = 361 and r.counselorId = 'ec821e85f6dc43c7ac9529e6456cd1ae' "
418,7503,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' )) 
419,7406,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
420,7118,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' and r.ifConsult = 0 
421,7797,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' and r.ifConsult = 0 
422,7289,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '315a99bc26704386a7cfba60df3ea646' and r.ifConsult = 0 
423,7656,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' and r.ifConsult = 0 
424,7343,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' and r.ifConsult = 0 
425,7202,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' and r.ifConsult = 0 
426,7455,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' and r.ifConsult = 0 
427,7182,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' and r.ifConsult = 0 
428,6909,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' and r.ifConsult = 0 
429,7157,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' and r.ifConsult = 0 
430,7192,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' and r.ifConsult = 0 
431,5556,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' )) 
432,10048,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '6ed5e1e627c54951bf55f89da1beabb6' )) 
433,9759,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
434,5137," select * from ( select distinct e.employeeId as objectId ,e.employeeName as objectName ,e.empNo,cou.bookNumber   ,group_CONCAT(a.startTime0 SEPARATOR '/-') AS startTime0 ,group_CONCAT(a.startTime1 SEPARATOR '/-') AS startTime1 ,group_CONCAT(a.startTime2 SEPARATOR '/-') AS startTime2 ,group_CONCAT(a.startTime3 SEPARATOR '/-') AS startTime3 ,group_CONCAT(a.startTime4 SEPARATOR '/-') AS startTime4 ,group_CONCAT(a.startTime5 SEPARATOR '/-') AS startTime5 ,group_CONCAT(a.startTime6 SEPARATOR '/-') AS startTime6 ,group_CONCAT(a.startTime7 SEPARATOR '/-') AS startTime7 ,group_CONCAT(a.startTime8 SEPARATOR '/-') AS startTime8 ,group_CONCAT(a.startTime9 SEPARATOR '/-') AS startTime9 ,group_CONCAT(a.startTime10 SEPARATOR '/-') AS startTime10 ,group_CONCAT(a.startTime11 SEPARATOR '/-') AS startTime11 ,group_CONCAT(a.startTime12 SEPARATOR '/-') AS startTime12 ,group_CONCAT(a.startTime13 SEPARATOR '/-') AS startTime13 ,group_CONCAT(a.startTime14 SEPARATOR '/-') AS startTime14 ,group_CONCAT(a.startTime15 SEPARATOR '/-') AS startTime15 ,group_CONCAT(a.startTime16 SEPARATOR '/-') AS startTime16 ,group_CONCAT(a.startTime17 SEPARATOR '/-') AS startTime17 ,group_CONCAT(a.startTime18 SEPARATOR '/-') AS startTime18 ,group_CONCAT(a.startTime19 SEPARATOR '/-') AS startTime19 ,group_CONCAT(a.startTime20 SEPARATOR '/-') AS startTime20 ,group_CONCAT(a.startTime21 SEPARATOR '/-') AS startTime21 ,group_CONCAT(a.startTime22 SEPARATOR '/-') AS startTime22 ,group_CONCAT(a.startTime23 SEPARATOR '/-') AS startTime23 ,group_CONCAT(a.startTime24 SEPARATOR '/-') AS startTime24 ,group_CONCAT(a.startTime25 SEPARATOR '/-') AS startTime25 ,group_CONCAT(a.startTime26 SEPARATOR '/-') AS startTime26 ,group_CONCAT(a.startTime27 SEPARATOR '/-') AS startTime27 ,group_CONCAT(a.startTime28 SEPARATOR '/-') AS startTime28 from com_his_doctor_treatment_scheme ec  left join com_his_employee_config c on  c.employeeId =ec.doctorId and c.treatment=1  and c.isDelete=0 and c.shopId='02c8257d6164485eb52b20b1b078696e'  left join ( select  case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.bookingTime,'%H:%i')<'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:30')   or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.endTime,'%H:%i')<='08:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime0, case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.bookingTime,'%H:%i')<'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'09:00')   or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.endTime,'%H:%i')<='09:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime1, case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.bookingTime,'%H:%i')<'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:30')   or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.endTime,'%H:%i')<='09:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime2, case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.bookingTime,'%H:%i')<'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'10:00')   or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.endTime,'%H:%i')<='10:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime3, case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.bookingTime,'%H:%i')<'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:30')   or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.endTime,'%H:%i')<='10:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime4, case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.bookingTime,'%H:%i')<'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'11:00')   or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.endTime,'%H:%i')<='11:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime5, case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.bookingTime,'%H:%i')<'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:30')   or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.endTime,'%H:%i')<='11:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime6, case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.bookingTime,'%H:%i')<'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'12:00')   or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.endTime,'%H:%i')<='12:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime7, case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.bookingTime,'%H:%i')<'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:30')   or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.endTime,'%H:%i')<='12:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime8, case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.bookingTime,'%H:%i')<'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'13:00')   or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.endTime,'%H:%i')<='13:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime9, case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.bookingTime,'%H:%i')<'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:30')   or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.endTime,'%H:%i')<='13:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime10, case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.bookingTime,'%H:%i')<'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'14:00')   or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.endTime,'%H:%i')<='14:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime11, case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.bookingTime,'%H:%i')<'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:30')   or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.endTime,'%H:%i')<='14:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime12, case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.bookingTime,'%H:%i')<'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'15:00')   or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.endTime,'%H:%i')<='15:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime13, case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.bookingTime,'%H:%i')<'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:30')   or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.endTime,'%H:%i')<='15:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime14, case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.bookingTime,'%H:%i')<'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'16:00')   or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.endTime,'%H:%i')<='16:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime15, case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.bookingTime,'%H:%i')<'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:30')   or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.endTime,'%H:%i')<='16:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime16, case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.bookingTime,'%H:%i')<'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'17:00')   or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.endTime,'%H:%i')<='17:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime17, case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.bookingTime,'%H:%i')<'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:30')   or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.endTime,'%H:%i')<='17:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime18, case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.bookingTime,'%H:%i')<'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'18:00')   or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.endTime,'%H:%i')<='18:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime19, case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.bookingTime,'%H:%i')<'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:30')   or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.endTime,'%H:%i')<='18:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime20, case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.bookingTime,'%H:%i')<'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'19:00')   or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.endTime,'%H:%i')<='19:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime21, case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.bookingTime,'%H:%i')<'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:30')   or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.endTime,'%H:%i')<='19:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime22, case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.bookingTime,'%H:%i')<'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'20:00')   or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.endTime,'%H:%i')<='20:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime23, case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.bookingTime,'%H:%i')<'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:30')   or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.endTime,'%H:%i')<='20:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime24, case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.bookingTime,'%H:%i')<'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'21:00')   or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.endTime,'%H:%i')<='21:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime25, case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.bookingTime,'%H:%i')<'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:30')   or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.endTime,'%H:%i')<='21:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime26, case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.bookingTime,'%H:%i')<'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'22:00')   or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.endTime,'%H:%i')<='22:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime27, case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.bookingTime,'%H:%i')<'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:30')   or (date_format(b.bookingTime,'%H:%i')<'22:30' and date_format(b.endTime,'%H:%i')>'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.endTime,'%H:%i')<='22:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime28, b.bookingDoctorId   from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 order by bookingTime ) a on a.bookingDoctorId=ec.doctorId  left join com_sys_employee e on e.employeeId=ec.doctorId  left join (select count(*) as bookNumber,b.bookingDoctorId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93  GROUP BY b.bookingDoctorId ) cou on cou.bookingDoctorId=ec.doctorId   where  ec.comId='239e97340aa84454b4c4bb36bd7879ee' and ec.shopId='02c8257d6164485eb52b20b1b078696e' and ec.isDelete=0  and ec.iStartTime>=20210818000000 and ec.iStartTime<=20210818235959  GROUP BY ec.schemeId  order by c.treatmentSort is null,
	c.treatmentSort ASc ) a  UNION ALL select * from ( select de.deptId as objectId ,de.dept as objectName ,'' as empNo,cou.bookNumber  ,group_CONCAT(a.startTime0 SEPARATOR '/-') AS startTime0 ,group_CONCAT(a.startTime1 SEPARATOR '/-') AS startTime1 ,group_CONCAT(a.startTime2 SEPARATOR '/-') AS startTime2 ,group_CONCAT(a.startTime3 SEPARATOR '/-') AS startTime3 ,group_CONCAT(a.startTime4 SEPARATOR '/-') AS startTime4 ,group_CONCAT(a.startTime5 SEPARATOR '/-') AS startTime5 ,group_CONCAT(a.startTime6 SEPARATOR '/-') AS startTime6 ,group_CONCAT(a.startTime7 SEPARATOR '/-') AS startTime7 ,group_CONCAT(a.startTime8 SEPARATOR '/-') AS startTime8 ,group_CONCAT(a.startTime9 SEPARATOR '/-') AS startTime9 ,group_CONCAT(a.startTime10 SEPARATOR '/-') AS startTime10 ,group_CONCAT(a.startTime11 SEPARATOR '/-') AS startTime11 ,group_CONCAT(a.startTime12 SEPARATOR '/-') AS startTime12 ,group_CONCAT(a.startTime13 SEPARATOR '/-') AS startTime13 ,group_CONCAT(a.startTime14 SEPARATOR '/-') AS startTime14 ,group_CONCAT(a.startTime15 SEPARATOR '/-') AS startTime15 ,group_CONCAT(a.startTime16 SEPARATOR '/-') AS startTime16 ,group_CONCAT(a.startTime17 SEPARATOR '/-') AS startTime17 ,group_CONCAT(a.startTime18 SEPARATOR '/-') AS startTime18 ,group_CONCAT(a.startTime19 SEPARATOR '/-') AS startTime19 ,group_CONCAT(a.startTime20 SEPARATOR '/-') AS startTime20 ,group_CONCAT(a.startTime21 SEPARATOR '/-') AS startTime21 ,group_CONCAT(a.startTime22 SEPARATOR '/-') AS startTime22 ,group_CONCAT(a.startTime23 SEPARATOR '/-') AS startTime23 ,group_CONCAT(a.startTime24 SEPARATOR '/-') AS startTime24 ,group_CONCAT(a.startTime25 SEPARATOR '/-') AS startTime25 ,group_CONCAT(a.startTime26 SEPARATOR '/-') AS startTime26 ,group_CONCAT(a.startTime27 SEPARATOR '/-') AS startTime27 ,group_CONCAT(a.startTime28 SEPARATOR '/-') AS startTime28 from com_his_dept_config dc  left join ( select  case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.bookingTime,'%H:%i')<'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:30')   or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.endTime,'%H:%i')<='08:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime0, case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.bookingTime,'%H:%i')<'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'09:00')   or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.endTime,'%H:%i')<='09:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime1, case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.bookingTime,'%H:%i')<'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:30')   or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.endTime,'%H:%i')<='09:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime2, case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.bookingTime,'%H:%i')<'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'10:00')   or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.endTime,'%H:%i')<='10:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime3, case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.bookingTime,'%H:%i')<'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:30')   or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.endTime,'%H:%i')<='10:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime4, case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.bookingTime,'%H:%i')<'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'11:00')   or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.endTime,'%H:%i')<='11:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime5, case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.bookingTime,'%H:%i')<'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:30')   or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.endTime,'%H:%i')<='11:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime6, case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.bookingTime,'%H:%i')<'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'12:00')   or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.endTime,'%H:%i')<='12:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime7, case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.bookingTime,'%H:%i')<'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:30')   or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.endTime,'%H:%i')<='12:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime8, case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.bookingTime,'%H:%i')<'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'13:00')   or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.endTime,'%H:%i')<='13:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime9, case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.bookingTime,'%H:%i')<'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:30')   or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.endTime,'%H:%i')<='13:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime10, case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.bookingTime,'%H:%i')<'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'14:00')   or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.endTime,'%H:%i')<='14:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime11, case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.bookingTime,'%H:%i')<'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:30')   or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.endTime,'%H:%i')<='14:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime12, case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.bookingTime,'%H:%i')<'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'15:00')   or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.endTime,'%H:%i')<='15:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime13, case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.bookingTime,'%H:%i')<'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:30')   or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.endTime,'%H:%i')<='15:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime14, case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.bookingTime,'%H:%i')<'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'16:00')   or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.endTime,'%H:%i')<='16:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime15, case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.bookingTime,'%H:%i')<'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:30')   or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.endTime,'%H:%i')<='16:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime16, case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.bookingTime,'%H:%i')<'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'17:00')   or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.endTime,'%H:%i')<='17:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime17, case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.bookingTime,'%H:%i')<'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:30')   or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.endTime,'%H:%i')<='17:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime18, case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.bookingTime,'%H:%i')<'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'18:00')   or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.endTime,'%H:%i')<='18:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime19, case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.bookingTime,'%H:%i')<'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:30')   or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.endTime,'%H:%i')<='18:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime20, case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.bookingTime,'%H:%i')<'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'19:00')   or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.endTime,'%H:%i')<='19:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime21, case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.bookingTime,'%H:%i')<'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:30')   or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.endTime,'%H:%i')<='19:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime22, case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.bookingTime,'%H:%i')<'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'20:00')   or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.endTime,'%H:%i')<='20:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime23, case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.bookingTime,'%H:%i')<'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:30')   or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.endTime,'%H:%i')<='20:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime24, case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.bookingTime,'%H:%i')<'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'21:00')   or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.endTime,'%H:%i')<='21:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime25, case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.bookingTime,'%H:%i')<'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:30')   or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.endTime,'%H:%i')<='21:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime26, case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.bookingTime,'%H:%i')<'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'22:00')   or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.endTime,'%H:%i')<='22:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime27, case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.bookingTime,'%H:%i')<'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:30')   or (date_format(b.bookingTime,'%H:%i')<'22:30' and date_format(b.endTime,'%H:%i')>'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.endTime,'%H:%i')<='22:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime28, b.bookingDeptId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 and ifnull(b.bookingDoctorId,'')=''  order by bookingTime ) a on a.bookingDeptId=dc.configDeptId  left join (select count(*) as bookNumber,b.bookingDeptId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 and ifnull(b.bookingDoctorId,'')=''  GROUP BY b.bookingDeptId ) cou on cou.bookingDeptId=dc.configDeptId   left join com_sys_dept de on de.deptId=dc.configDeptId  where  dc.comId='239e97340aa84454b4c4bb36bd7879ee' and dc.shopId='02c8257d6164485eb52b20b1b078696e' and dc.treatment=1 and  dc.isDelete=0  and cou.bookNumber>0  GROUP BY objectId  order by dc.treatmentSort asc) b  limit 0, 100"
435,9436,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
436,8671,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
437,8393,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
438,8537,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3fa93ee8295041b7bc2c5341930d00af' )) 
439,8535,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
440,7747,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
441,4284,"select count(r.regId) from com_his_treat_register r left join com_his_consult c on r.regId = c.regId where r.comId = '239e97340aa84454b4c4bb36bd7879ee' and r.shopId = '85c94b66653b4495bf60fac3f770f7ea' and r.isDelete = 0 and r.ifConsult = 1 and ifNull(c.consultId, '') = '' and r.treatStatus = 1068 and r.finishType = 361 and r.counselorId = 'ec821e85f6dc43c7ac9529e6456cd1ae' "
442,7503,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' )) 
443,7406,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
444,7118,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' and r.ifConsult = 0 
445,7797,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' and r.ifConsult = 0 
446,7289,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '315a99bc26704386a7cfba60df3ea646' and r.ifConsult = 0 
447,7656,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' and r.ifConsult = 0 
448,7343,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' and r.ifConsult = 0 
449,7202,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' and r.ifConsult = 0 
450,7455,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' and r.ifConsult = 0 
451,7182,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' and r.ifConsult = 0 
452,6909,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' and r.ifConsult = 0 
453,7157,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' and r.ifConsult = 0 
454,7192,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' and r.ifConsult = 0 
455,5556,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' )) 
456,10048,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '6ed5e1e627c54951bf55f89da1beabb6' )) 
457,9759,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
458,5137," select * from ( select distinct e.employeeId as objectId ,e.employeeName as objectName ,e.empNo,cou.bookNumber   ,group_CONCAT(a.startTime0 SEPARATOR '/-') AS startTime0 ,group_CONCAT(a.startTime1 SEPARATOR '/-') AS startTime1 ,group_CONCAT(a.startTime2 SEPARATOR '/-') AS startTime2 ,group_CONCAT(a.startTime3 SEPARATOR '/-') AS startTime3 ,group_CONCAT(a.startTime4 SEPARATOR '/-') AS startTime4 ,group_CONCAT(a.startTime5 SEPARATOR '/-') AS startTime5 ,group_CONCAT(a.startTime6 SEPARATOR '/-') AS startTime6 ,group_CONCAT(a.startTime7 SEPARATOR '/-') AS startTime7 ,group_CONCAT(a.startTime8 SEPARATOR '/-') AS startTime8 ,group_CONCAT(a.startTime9 SEPARATOR '/-') AS startTime9 ,group_CONCAT(a.startTime10 SEPARATOR '/-') AS startTime10 ,group_CONCAT(a.startTime11 SEPARATOR '/-') AS startTime11 ,group_CONCAT(a.startTime12 SEPARATOR '/-') AS startTime12 ,group_CONCAT(a.startTime13 SEPARATOR '/-') AS startTime13 ,group_CONCAT(a.startTime14 SEPARATOR '/-') AS startTime14 ,group_CONCAT(a.startTime15 SEPARATOR '/-') AS startTime15 ,group_CONCAT(a.startTime16 SEPARATOR '/-') AS startTime16 ,group_CONCAT(a.startTime17 SEPARATOR '/-') AS startTime17 ,group_CONCAT(a.startTime18 SEPARATOR '/-') AS startTime18 ,group_CONCAT(a.startTime19 SEPARATOR '/-') AS startTime19 ,group_CONCAT(a.startTime20 SEPARATOR '/-') AS startTime20 ,group_CONCAT(a.startTime21 SEPARATOR '/-') AS startTime21 ,group_CONCAT(a.startTime22 SEPARATOR '/-') AS startTime22 ,group_CONCAT(a.startTime23 SEPARATOR '/-') AS startTime23 ,group_CONCAT(a.startTime24 SEPARATOR '/-') AS startTime24 ,group_CONCAT(a.startTime25 SEPARATOR '/-') AS startTime25 ,group_CONCAT(a.startTime26 SEPARATOR '/-') AS startTime26 ,group_CONCAT(a.startTime27 SEPARATOR '/-') AS startTime27 ,group_CONCAT(a.startTime28 SEPARATOR '/-') AS startTime28 from com_his_doctor_treatment_scheme ec  left join com_his_employee_config c on  c.employeeId =ec.doctorId and c.treatment=1  and c.isDelete=0 and c.shopId='02c8257d6164485eb52b20b1b078696e'  left join ( select  case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.bookingTime,'%H:%i')<'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:30')   or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.endTime,'%H:%i')<='08:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime0, case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.bookingTime,'%H:%i')<'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'09:00')   or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.endTime,'%H:%i')<='09:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime1, case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.bookingTime,'%H:%i')<'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:30')   or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.endTime,'%H:%i')<='09:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime2, case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.bookingTime,'%H:%i')<'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'10:00')   or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.endTime,'%H:%i')<='10:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime3, case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.bookingTime,'%H:%i')<'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:30')   or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.endTime,'%H:%i')<='10:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime4, case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.bookingTime,'%H:%i')<'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'11:00')   or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.endTime,'%H:%i')<='11:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime5, case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.bookingTime,'%H:%i')<'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:30')   or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.endTime,'%H:%i')<='11:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime6, case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.bookingTime,'%H:%i')<'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'12:00')   or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.endTime,'%H:%i')<='12:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime7, case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.bookingTime,'%H:%i')<'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:30')   or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.endTime,'%H:%i')<='12:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime8, case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.bookingTime,'%H:%i')<'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'13:00')   or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.endTime,'%H:%i')<='13:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime9, case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.bookingTime,'%H:%i')<'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:30')   or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.endTime,'%H:%i')<='13:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime10, case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.bookingTime,'%H:%i')<'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'14:00')   or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.endTime,'%H:%i')<='14:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime11, case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.bookingTime,'%H:%i')<'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:30')   or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.endTime,'%H:%i')<='14:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime12, case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.bookingTime,'%H:%i')<'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'15:00')   or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.endTime,'%H:%i')<='15:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime13, case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.bookingTime,'%H:%i')<'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:30')   or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.endTime,'%H:%i')<='15:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime14, case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.bookingTime,'%H:%i')<'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'16:00')   or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.endTime,'%H:%i')<='16:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime15, case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.bookingTime,'%H:%i')<'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:30')   or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.endTime,'%H:%i')<='16:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime16, case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.bookingTime,'%H:%i')<'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'17:00')   or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.endTime,'%H:%i')<='17:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime17, case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.bookingTime,'%H:%i')<'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:30')   or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.endTime,'%H:%i')<='17:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime18, case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.bookingTime,'%H:%i')<'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'18:00')   or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.endTime,'%H:%i')<='18:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime19, case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.bookingTime,'%H:%i')<'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:30')   or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.endTime,'%H:%i')<='18:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime20, case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.bookingTime,'%H:%i')<'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'19:00')   or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.endTime,'%H:%i')<='19:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime21, case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.bookingTime,'%H:%i')<'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:30')   or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.endTime,'%H:%i')<='19:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime22, case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.bookingTime,'%H:%i')<'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'20:00')   or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.endTime,'%H:%i')<='20:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime23, case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.bookingTime,'%H:%i')<'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:30')   or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.endTime,'%H:%i')<='20:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime24, case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.bookingTime,'%H:%i')<'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'21:00')   or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.endTime,'%H:%i')<='21:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime25, case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.bookingTime,'%H:%i')<'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:30')   or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.endTime,'%H:%i')<='21:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime26, case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.bookingTime,'%H:%i')<'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'22:00')   or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.endTime,'%H:%i')<='22:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime27, case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.bookingTime,'%H:%i')<'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:30')   or (date_format(b.bookingTime,'%H:%i')<'22:30' and date_format(b.endTime,'%H:%i')>'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.endTime,'%H:%i')<='22:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime28, b.bookingDoctorId   from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 order by bookingTime ) a on a.bookingDoctorId=ec.doctorId  left join com_sys_employee e on e.employeeId=ec.doctorId  left join (select count(*) as bookNumber,b.bookingDoctorId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93  GROUP BY b.bookingDoctorId ) cou on cou.bookingDoctorId=ec.doctorId   where  ec.comId='239e97340aa84454b4c4bb36bd7879ee' and ec.shopId='02c8257d6164485eb52b20b1b078696e' and ec.isDelete=0  and ec.iStartTime>=20210818000000 and ec.iStartTime<=20210818235959  GROUP BY ec.schemeId  order by c.treatmentSort is null,
	c.treatmentSort ASc ) a  UNION ALL select * from ( select de.deptId as objectId ,de.dept as objectName ,'' as empNo,cou.bookNumber  ,group_CONCAT(a.startTime0 SEPARATOR '/-') AS startTime0 ,group_CONCAT(a.startTime1 SEPARATOR '/-') AS startTime1 ,group_CONCAT(a.startTime2 SEPARATOR '/-') AS startTime2 ,group_CONCAT(a.startTime3 SEPARATOR '/-') AS startTime3 ,group_CONCAT(a.startTime4 SEPARATOR '/-') AS startTime4 ,group_CONCAT(a.startTime5 SEPARATOR '/-') AS startTime5 ,group_CONCAT(a.startTime6 SEPARATOR '/-') AS startTime6 ,group_CONCAT(a.startTime7 SEPARATOR '/-') AS startTime7 ,group_CONCAT(a.startTime8 SEPARATOR '/-') AS startTime8 ,group_CONCAT(a.startTime9 SEPARATOR '/-') AS startTime9 ,group_CONCAT(a.startTime10 SEPARATOR '/-') AS startTime10 ,group_CONCAT(a.startTime11 SEPARATOR '/-') AS startTime11 ,group_CONCAT(a.startTime12 SEPARATOR '/-') AS startTime12 ,group_CONCAT(a.startTime13 SEPARATOR '/-') AS startTime13 ,group_CONCAT(a.startTime14 SEPARATOR '/-') AS startTime14 ,group_CONCAT(a.startTime15 SEPARATOR '/-') AS startTime15 ,group_CONCAT(a.startTime16 SEPARATOR '/-') AS startTime16 ,group_CONCAT(a.startTime17 SEPARATOR '/-') AS startTime17 ,group_CONCAT(a.startTime18 SEPARATOR '/-') AS startTime18 ,group_CONCAT(a.startTime19 SEPARATOR '/-') AS startTime19 ,group_CONCAT(a.startTime20 SEPARATOR '/-') AS startTime20 ,group_CONCAT(a.startTime21 SEPARATOR '/-') AS startTime21 ,group_CONCAT(a.startTime22 SEPARATOR '/-') AS startTime22 ,group_CONCAT(a.startTime23 SEPARATOR '/-') AS startTime23 ,group_CONCAT(a.startTime24 SEPARATOR '/-') AS startTime24 ,group_CONCAT(a.startTime25 SEPARATOR '/-') AS startTime25 ,group_CONCAT(a.startTime26 SEPARATOR '/-') AS startTime26 ,group_CONCAT(a.startTime27 SEPARATOR '/-') AS startTime27 ,group_CONCAT(a.startTime28 SEPARATOR '/-') AS startTime28 from com_his_dept_config dc  left join ( select  case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.bookingTime,'%H:%i')<'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:30')   or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.endTime,'%H:%i')<='08:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime0, case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.bookingTime,'%H:%i')<'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'09:00')   or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.endTime,'%H:%i')<='09:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime1, case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.bookingTime,'%H:%i')<'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:30')   or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.endTime,'%H:%i')<='09:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime2, case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.bookingTime,'%H:%i')<'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'10:00')   or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.endTime,'%H:%i')<='10:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime3, case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.bookingTime,'%H:%i')<'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:30')   or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.endTime,'%H:%i')<='10:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime4, case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.bookingTime,'%H:%i')<'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'11:00')   or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.endTime,'%H:%i')<='11:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime5, case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.bookingTime,'%H:%i')<'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:30')   or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.endTime,'%H:%i')<='11:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime6, case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.bookingTime,'%H:%i')<'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'12:00')   or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.endTime,'%H:%i')<='12:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime7, case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.bookingTime,'%H:%i')<'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:30')   or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.endTime,'%H:%i')<='12:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime8, case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.bookingTime,'%H:%i')<'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'13:00')   or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.endTime,'%H:%i')<='13:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime9, case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.bookingTime,'%H:%i')<'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:30')   or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.endTime,'%H:%i')<='13:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime10, case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.bookingTime,'%H:%i')<'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'14:00')   or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.endTime,'%H:%i')<='14:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime11, case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.bookingTime,'%H:%i')<'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:30')   or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.endTime,'%H:%i')<='14:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime12, case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.bookingTime,'%H:%i')<'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'15:00')   or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.endTime,'%H:%i')<='15:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime13, case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.bookingTime,'%H:%i')<'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:30')   or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.endTime,'%H:%i')<='15:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime14, case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.bookingTime,'%H:%i')<'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'16:00')   or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.endTime,'%H:%i')<='16:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime15, case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.bookingTime,'%H:%i')<'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:30')   or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.endTime,'%H:%i')<='16:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime16, case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.bookingTime,'%H:%i')<'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'17:00')   or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.endTime,'%H:%i')<='17:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime17, case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.bookingTime,'%H:%i')<'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:30')   or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.endTime,'%H:%i')<='17:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime18, case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.bookingTime,'%H:%i')<'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'18:00')   or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.endTime,'%H:%i')<='18:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime19, case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.bookingTime,'%H:%i')<'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:30')   or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.endTime,'%H:%i')<='18:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime20, case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.bookingTime,'%H:%i')<'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'19:00')   or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.endTime,'%H:%i')<='19:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime21, case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.bookingTime,'%H:%i')<'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:30')   or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.endTime,'%H:%i')<='19:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime22, case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.bookingTime,'%H:%i')<'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'20:00')   or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.endTime,'%H:%i')<='20:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime23, case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.bookingTime,'%H:%i')<'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:30')   or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.endTime,'%H:%i')<='20:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime24, case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.bookingTime,'%H:%i')<'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'21:00')   or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.endTime,'%H:%i')<='21:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime25, case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.bookingTime,'%H:%i')<'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:30')   or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.endTime,'%H:%i')<='21:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime26, case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.bookingTime,'%H:%i')<'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'22:00')   or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.endTime,'%H:%i')<='22:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime27, case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.bookingTime,'%H:%i')<'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:30')   or (date_format(b.bookingTime,'%H:%i')<'22:30' and date_format(b.endTime,'%H:%i')>'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.endTime,'%H:%i')<='22:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime28, b.bookingDeptId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 and ifnull(b.bookingDoctorId,'')=''  order by bookingTime ) a on a.bookingDeptId=dc.configDeptId  left join (select count(*) as bookNumber,b.bookingDeptId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 and ifnull(b.bookingDoctorId,'')=''  GROUP BY b.bookingDeptId ) cou on cou.bookingDeptId=dc.configDeptId   left join com_sys_dept de on de.deptId=dc.configDeptId  where  dc.comId='239e97340aa84454b4c4bb36bd7879ee' and dc.shopId='02c8257d6164485eb52b20b1b078696e' and dc.treatment=1 and  dc.isDelete=0  and cou.bookNumber>0  GROUP BY objectId  order by dc.treatmentSort asc) b  limit 0, 100"
459,9436,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
460,8671,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
461,8393,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
462,8537,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3fa93ee8295041b7bc2c5341930d00af' )) 
463,8535,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
464,7747,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
465,4284,"select count(r.regId) from com_his_treat_register r left join com_his_consult c on r.regId = c.regId where r.comId = '239e97340aa84454b4c4bb36bd7879ee' and r.shopId = '85c94b66653b4495bf60fac3f770f7ea' and r.isDelete = 0 and r.ifConsult = 1 and ifNull(c.consultId, '') = '' and r.treatStatus = 1068 and r.finishType = 361 and r.counselorId = 'ec821e85f6dc43c7ac9529e6456cd1ae' "
466,7503,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' )) 
467,7406,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
468,7118,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' and r.ifConsult = 0 
469,7797,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' and r.ifConsult = 0 
470,7289,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '315a99bc26704386a7cfba60df3ea646' and r.ifConsult = 0 
471,7656,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' and r.ifConsult = 0 
472,7343,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' and r.ifConsult = 0 
473,7202,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' and r.ifConsult = 0 
474,7455,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' and r.ifConsult = 0 
475,7182,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' and r.ifConsult = 0 
476,6909,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' and r.ifConsult = 0 
477,7157,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' and r.ifConsult = 0 
478,7192,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' and r.ifConsult = 0 
479,5556,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' )) 
480,10048,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '6ed5e1e627c54951bf55f89da1beabb6' )) 
481,9759,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
482,5137," select * from ( select distinct e.employeeId as objectId ,e.employeeName as objectName ,e.empNo,cou.bookNumber   ,group_CONCAT(a.startTime0 SEPARATOR '/-') AS startTime0 ,group_CONCAT(a.startTime1 SEPARATOR '/-') AS startTime1 ,group_CONCAT(a.startTime2 SEPARATOR '/-') AS startTime2 ,group_CONCAT(a.startTime3 SEPARATOR '/-') AS startTime3 ,group_CONCAT(a.startTime4 SEPARATOR '/-') AS startTime4 ,group_CONCAT(a.startTime5 SEPARATOR '/-') AS startTime5 ,group_CONCAT(a.startTime6 SEPARATOR '/-') AS startTime6 ,group_CONCAT(a.startTime7 SEPARATOR '/-') AS startTime7 ,group_CONCAT(a.startTime8 SEPARATOR '/-') AS startTime8 ,group_CONCAT(a.startTime9 SEPARATOR '/-') AS startTime9 ,group_CONCAT(a.startTime10 SEPARATOR '/-') AS startTime10 ,group_CONCAT(a.startTime11 SEPARATOR '/-') AS startTime11 ,group_CONCAT(a.startTime12 SEPARATOR '/-') AS startTime12 ,group_CONCAT(a.startTime13 SEPARATOR '/-') AS startTime13 ,group_CONCAT(a.startTime14 SEPARATOR '/-') AS startTime14 ,group_CONCAT(a.startTime15 SEPARATOR '/-') AS startTime15 ,group_CONCAT(a.startTime16 SEPARATOR '/-') AS startTime16 ,group_CONCAT(a.startTime17 SEPARATOR '/-') AS startTime17 ,group_CONCAT(a.startTime18 SEPARATOR '/-') AS startTime18 ,group_CONCAT(a.startTime19 SEPARATOR '/-') AS startTime19 ,group_CONCAT(a.startTime20 SEPARATOR '/-') AS startTime20 ,group_CONCAT(a.startTime21 SEPARATOR '/-') AS startTime21 ,group_CONCAT(a.startTime22 SEPARATOR '/-') AS startTime22 ,group_CONCAT(a.startTime23 SEPARATOR '/-') AS startTime23 ,group_CONCAT(a.startTime24 SEPARATOR '/-') AS startTime24 ,group_CONCAT(a.startTime25 SEPARATOR '/-') AS startTime25 ,group_CONCAT(a.startTime26 SEPARATOR '/-') AS startTime26 ,group_CONCAT(a.startTime27 SEPARATOR '/-') AS startTime27 ,group_CONCAT(a.startTime28 SEPARATOR '/-') AS startTime28 from com_his_doctor_treatment_scheme ec  left join com_his_employee_config c on  c.employeeId =ec.doctorId and c.treatment=1  and c.isDelete=0 and c.shopId='02c8257d6164485eb52b20b1b078696e'  left join ( select  case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.bookingTime,'%H:%i')<'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:30')   or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.endTime,'%H:%i')<='08:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime0, case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.bookingTime,'%H:%i')<'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'09:00')   or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.endTime,'%H:%i')<='09:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime1, case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.bookingTime,'%H:%i')<'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:30')   or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.endTime,'%H:%i')<='09:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime2, case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.bookingTime,'%H:%i')<'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'10:00')   or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.endTime,'%H:%i')<='10:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime3, case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.bookingTime,'%H:%i')<'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:30')   or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.endTime,'%H:%i')<='10:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime4, case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.bookingTime,'%H:%i')<'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'11:00')   or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.endTime,'%H:%i')<='11:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime5, case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.bookingTime,'%H:%i')<'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:30')   or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.endTime,'%H:%i')<='11:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime6, case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.bookingTime,'%H:%i')<'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'12:00')   or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.endTime,'%H:%i')<='12:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime7, case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.bookingTime,'%H:%i')<'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:30')   or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.endTime,'%H:%i')<='12:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime8, case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.bookingTime,'%H:%i')<'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'13:00')   or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.endTime,'%H:%i')<='13:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime9, case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.bookingTime,'%H:%i')<'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:30')   or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.endTime,'%H:%i')<='13:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime10, case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.bookingTime,'%H:%i')<'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'14:00')   or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.endTime,'%H:%i')<='14:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime11, case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.bookingTime,'%H:%i')<'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:30')   or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.endTime,'%H:%i')<='14:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime12, case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.bookingTime,'%H:%i')<'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'15:00')   or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.endTime,'%H:%i')<='15:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime13, case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.bookingTime,'%H:%i')<'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:30')   or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.endTime,'%H:%i')<='15:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime14, case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.bookingTime,'%H:%i')<'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'16:00')   or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.endTime,'%H:%i')<='16:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime15, case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.bookingTime,'%H:%i')<'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:30')   or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.endTime,'%H:%i')<='16:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime16, case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.bookingTime,'%H:%i')<'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'17:00')   or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.endTime,'%H:%i')<='17:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime17, case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.bookingTime,'%H:%i')<'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:30')   or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.endTime,'%H:%i')<='17:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime18, case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.bookingTime,'%H:%i')<'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'18:00')   or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.endTime,'%H:%i')<='18:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime19, case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.bookingTime,'%H:%i')<'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:30')   or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.endTime,'%H:%i')<='18:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime20, case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.bookingTime,'%H:%i')<'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'19:00')   or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.endTime,'%H:%i')<='19:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime21, case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.bookingTime,'%H:%i')<'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:30')   or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.endTime,'%H:%i')<='19:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime22, case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.bookingTime,'%H:%i')<'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'20:00')   or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.endTime,'%H:%i')<='20:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime23, case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.bookingTime,'%H:%i')<'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:30')   or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.endTime,'%H:%i')<='20:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime24, case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.bookingTime,'%H:%i')<'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'21:00')   or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.endTime,'%H:%i')<='21:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime25, case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.bookingTime,'%H:%i')<'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:30')   or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.endTime,'%H:%i')<='21:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime26, case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.bookingTime,'%H:%i')<'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'22:00')   or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.endTime,'%H:%i')<='22:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime27, case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.bookingTime,'%H:%i')<'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:30')   or (date_format(b.bookingTime,'%H:%i')<'22:30' and date_format(b.endTime,'%H:%i')>'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.endTime,'%H:%i')<='22:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime28, b.bookingDoctorId   from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 order by bookingTime ) a on a.bookingDoctorId=ec.doctorId  left join com_sys_employee e on e.employeeId=ec.doctorId  left join (select count(*) as bookNumber,b.bookingDoctorId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93  GROUP BY b.bookingDoctorId ) cou on cou.bookingDoctorId=ec.doctorId   where  ec.comId='239e97340aa84454b4c4bb36bd7879ee' and ec.shopId='02c8257d6164485eb52b20b1b078696e' and ec.isDelete=0  and ec.iStartTime>=20210818000000 and ec.iStartTime<=20210818235959  GROUP BY ec.schemeId  order by c.treatmentSort is null,
	c.treatmentSort ASc ) a  UNION ALL select * from ( select de.deptId as objectId ,de.dept as objectName ,'' as empNo,cou.bookNumber  ,group_CONCAT(a.startTime0 SEPARATOR '/-') AS startTime0 ,group_CONCAT(a.startTime1 SEPARATOR '/-') AS startTime1 ,group_CONCAT(a.startTime2 SEPARATOR '/-') AS startTime2 ,group_CONCAT(a.startTime3 SEPARATOR '/-') AS startTime3 ,group_CONCAT(a.startTime4 SEPARATOR '/-') AS startTime4 ,group_CONCAT(a.startTime5 SEPARATOR '/-') AS startTime5 ,group_CONCAT(a.startTime6 SEPARATOR '/-') AS startTime6 ,group_CONCAT(a.startTime7 SEPARATOR '/-') AS startTime7 ,group_CONCAT(a.startTime8 SEPARATOR '/-') AS startTime8 ,group_CONCAT(a.startTime9 SEPARATOR '/-') AS startTime9 ,group_CONCAT(a.startTime10 SEPARATOR '/-') AS startTime10 ,group_CONCAT(a.startTime11 SEPARATOR '/-') AS startTime11 ,group_CONCAT(a.startTime12 SEPARATOR '/-') AS startTime12 ,group_CONCAT(a.startTime13 SEPARATOR '/-') AS startTime13 ,group_CONCAT(a.startTime14 SEPARATOR '/-') AS startTime14 ,group_CONCAT(a.startTime15 SEPARATOR '/-') AS startTime15 ,group_CONCAT(a.startTime16 SEPARATOR '/-') AS startTime16 ,group_CONCAT(a.startTime17 SEPARATOR '/-') AS startTime17 ,group_CONCAT(a.startTime18 SEPARATOR '/-') AS startTime18 ,group_CONCAT(a.startTime19 SEPARATOR '/-') AS startTime19 ,group_CONCAT(a.startTime20 SEPARATOR '/-') AS startTime20 ,group_CONCAT(a.startTime21 SEPARATOR '/-') AS startTime21 ,group_CONCAT(a.startTime22 SEPARATOR '/-') AS startTime22 ,group_CONCAT(a.startTime23 SEPARATOR '/-') AS startTime23 ,group_CONCAT(a.startTime24 SEPARATOR '/-') AS startTime24 ,group_CONCAT(a.startTime25 SEPARATOR '/-') AS startTime25 ,group_CONCAT(a.startTime26 SEPARATOR '/-') AS startTime26 ,group_CONCAT(a.startTime27 SEPARATOR '/-') AS startTime27 ,group_CONCAT(a.startTime28 SEPARATOR '/-') AS startTime28 from com_his_dept_config dc  left join ( select  case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.bookingTime,'%H:%i')<'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:30')   or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.endTime,'%H:%i')<='08:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime0, case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.bookingTime,'%H:%i')<'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'09:00')   or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.endTime,'%H:%i')<='09:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime1, case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.bookingTime,'%H:%i')<'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:30')   or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.endTime,'%H:%i')<='09:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime2, case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.bookingTime,'%H:%i')<'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'10:00')   or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.endTime,'%H:%i')<='10:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime3, case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.bookingTime,'%H:%i')<'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:30')   or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.endTime,'%H:%i')<='10:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime4, case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.bookingTime,'%H:%i')<'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'11:00')   or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.endTime,'%H:%i')<='11:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime5, case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.bookingTime,'%H:%i')<'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:30')   or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.endTime,'%H:%i')<='11:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime6, case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.bookingTime,'%H:%i')<'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'12:00')   or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.endTime,'%H:%i')<='12:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime7, case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.bookingTime,'%H:%i')<'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:30')   or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.endTime,'%H:%i')<='12:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime8, case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.bookingTime,'%H:%i')<'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'13:00')   or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.endTime,'%H:%i')<='13:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime9, case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.bookingTime,'%H:%i')<'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:30')   or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.endTime,'%H:%i')<='13:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime10, case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.bookingTime,'%H:%i')<'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'14:00')   or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.endTime,'%H:%i')<='14:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime11, case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.bookingTime,'%H:%i')<'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:30')   or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.endTime,'%H:%i')<='14:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime12, case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.bookingTime,'%H:%i')<'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'15:00')   or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.endTime,'%H:%i')<='15:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime13, case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.bookingTime,'%H:%i')<'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:30')   or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.endTime,'%H:%i')<='15:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime14, case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.bookingTime,'%H:%i')<'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'16:00')   or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.endTime,'%H:%i')<='16:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime15, case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.bookingTime,'%H:%i')<'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:30')   or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.endTime,'%H:%i')<='16:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime16, case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.bookingTime,'%H:%i')<'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'17:00')   or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.endTime,'%H:%i')<='17:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime17, case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.bookingTime,'%H:%i')<'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:30')   or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.endTime,'%H:%i')<='17:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime18, case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.bookingTime,'%H:%i')<'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'18:00')   or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.endTime,'%H:%i')<='18:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime19, case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.bookingTime,'%H:%i')<'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:30')   or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.endTime,'%H:%i')<='18:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime20, case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.bookingTime,'%H:%i')<'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'19:00')   or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.endTime,'%H:%i')<='19:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime21, case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.bookingTime,'%H:%i')<'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:30')   or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.endTime,'%H:%i')<='19:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime22, case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.bookingTime,'%H:%i')<'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'20:00')   or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.endTime,'%H:%i')<='20:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime23, case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.bookingTime,'%H:%i')<'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:30')   or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.endTime,'%H:%i')<='20:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime24, case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.bookingTime,'%H:%i')<'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'21:00')   or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.endTime,'%H:%i')<='21:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime25, case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.bookingTime,'%H:%i')<'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:30')   or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.endTime,'%H:%i')<='21:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime26, case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.bookingTime,'%H:%i')<'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'22:00')   or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.endTime,'%H:%i')<='22:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime27, case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.bookingTime,'%H:%i')<'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:30')   or (date_format(b.bookingTime,'%H:%i')<'22:30' and date_format(b.endTime,'%H:%i')>'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.endTime,'%H:%i')<='22:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime28, b.bookingDeptId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 and ifnull(b.bookingDoctorId,'')=''  order by bookingTime ) a on a.bookingDeptId=dc.configDeptId  left join (select count(*) as bookNumber,b.bookingDeptId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 and ifnull(b.bookingDoctorId,'')=''  GROUP BY b.bookingDeptId ) cou on cou.bookingDeptId=dc.configDeptId   left join com_sys_dept de on de.deptId=dc.configDeptId  where  dc.comId='239e97340aa84454b4c4bb36bd7879ee' and dc.shopId='02c8257d6164485eb52b20b1b078696e' and dc.treatment=1 and  dc.isDelete=0  and cou.bookNumber>0  GROUP BY objectId  order by dc.treatmentSort asc) b  limit 0, 100"
483,9436,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
484,8671,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
485,8393,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
486,8537,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3fa93ee8295041b7bc2c5341930d00af' )) 
487,8535,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
488,7747,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
489,4284,"select count(r.regId) from com_his_treat_register r left join com_his_consult c on r.regId = c.regId where r.comId = '239e97340aa84454b4c4bb36bd7879ee' and r.shopId = '85c94b66653b4495bf60fac3f770f7ea' and r.isDelete = 0 and r.ifConsult = 1 and ifNull(c.consultId, '') = '' and r.treatStatus = 1068 and r.finishType = 361 and r.counselorId = 'ec821e85f6dc43c7ac9529e6456cd1ae' "
490,7503,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' )) 
491,7406,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
492,7118,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' and r.ifConsult = 0 
493,7797,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' and r.ifConsult = 0 
494,7289,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '315a99bc26704386a7cfba60df3ea646' and r.ifConsult = 0 
495,7656,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' and r.ifConsult = 0 
496,7343,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' and r.ifConsult = 0 
497,7202,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' and r.ifConsult = 0 
498,7455,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' and r.ifConsult = 0 
499,7182,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' and r.ifConsult = 0 
500,6909,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' and r.ifConsult = 0 
501,7157,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' and r.ifConsult = 0 
502,7192,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' and r.ifConsult = 0 
503,5556,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' )) 
504,10048,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '6ed5e1e627c54951bf55f89da1beabb6' )) 
505,9759,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
506,5137," select * from ( select distinct e.employeeId as objectId ,e.employeeName as objectName ,e.empNo,cou.bookNumber   ,group_CONCAT(a.startTime0 SEPARATOR '/-') AS startTime0 ,group_CONCAT(a.startTime1 SEPARATOR '/-') AS startTime1 ,group_CONCAT(a.startTime2 SEPARATOR '/-') AS startTime2 ,group_CONCAT(a.startTime3 SEPARATOR '/-') AS startTime3 ,group_CONCAT(a.startTime4 SEPARATOR '/-') AS startTime4 ,group_CONCAT(a.startTime5 SEPARATOR '/-') AS startTime5 ,group_CONCAT(a.startTime6 SEPARATOR '/-') AS startTime6 ,group_CONCAT(a.startTime7 SEPARATOR '/-') AS startTime7 ,group_CONCAT(a.startTime8 SEPARATOR '/-') AS startTime8 ,group_CONCAT(a.startTime9 SEPARATOR '/-') AS startTime9 ,group_CONCAT(a.startTime10 SEPARATOR '/-') AS startTime10 ,group_CONCAT(a.startTime11 SEPARATOR '/-') AS startTime11 ,group_CONCAT(a.startTime12 SEPARATOR '/-') AS startTime12 ,group_CONCAT(a.startTime13 SEPARATOR '/-') AS startTime13 ,group_CONCAT(a.startTime14 SEPARATOR '/-') AS startTime14 ,group_CONCAT(a.startTime15 SEPARATOR '/-') AS startTime15 ,group_CONCAT(a.startTime16 SEPARATOR '/-') AS startTime16 ,group_CONCAT(a.startTime17 SEPARATOR '/-') AS startTime17 ,group_CONCAT(a.startTime18 SEPARATOR '/-') AS startTime18 ,group_CONCAT(a.startTime19 SEPARATOR '/-') AS startTime19 ,group_CONCAT(a.startTime20 SEPARATOR '/-') AS startTime20 ,group_CONCAT(a.startTime21 SEPARATOR '/-') AS startTime21 ,group_CONCAT(a.startTime22 SEPARATOR '/-') AS startTime22 ,group_CONCAT(a.startTime23 SEPARATOR '/-') AS startTime23 ,group_CONCAT(a.startTime24 SEPARATOR '/-') AS startTime24 ,group_CONCAT(a.startTime25 SEPARATOR '/-') AS startTime25 ,group_CONCAT(a.startTime26 SEPARATOR '/-') AS startTime26 ,group_CONCAT(a.startTime27 SEPARATOR '/-') AS startTime27 ,group_CONCAT(a.startTime28 SEPARATOR '/-') AS startTime28 from com_his_doctor_treatment_scheme ec  left join com_his_employee_config c on  c.employeeId =ec.doctorId and c.treatment=1  and c.isDelete=0 and c.shopId='02c8257d6164485eb52b20b1b078696e'  left join ( select  case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.bookingTime,'%H:%i')<'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:30')   or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.endTime,'%H:%i')<='08:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime0, case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.bookingTime,'%H:%i')<'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'09:00')   or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.endTime,'%H:%i')<='09:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime1, case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.bookingTime,'%H:%i')<'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:30')   or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.endTime,'%H:%i')<='09:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime2, case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.bookingTime,'%H:%i')<'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'10:00')   or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.endTime,'%H:%i')<='10:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime3, case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.bookingTime,'%H:%i')<'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:30')   or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.endTime,'%H:%i')<='10:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime4, case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.bookingTime,'%H:%i')<'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'11:00')   or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.endTime,'%H:%i')<='11:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime5, case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.bookingTime,'%H:%i')<'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:30')   or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.endTime,'%H:%i')<='11:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime6, case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.bookingTime,'%H:%i')<'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'12:00')   or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.endTime,'%H:%i')<='12:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime7, case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.bookingTime,'%H:%i')<'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:30')   or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.endTime,'%H:%i')<='12:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime8, case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.bookingTime,'%H:%i')<'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'13:00')   or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.endTime,'%H:%i')<='13:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime9, case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.bookingTime,'%H:%i')<'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:30')   or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.endTime,'%H:%i')<='13:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime10, case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.bookingTime,'%H:%i')<'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'14:00')   or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.endTime,'%H:%i')<='14:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime11, case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.bookingTime,'%H:%i')<'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:30')   or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.endTime,'%H:%i')<='14:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime12, case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.bookingTime,'%H:%i')<'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'15:00')   or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.endTime,'%H:%i')<='15:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime13, case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.bookingTime,'%H:%i')<'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:30')   or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.endTime,'%H:%i')<='15:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime14, case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.bookingTime,'%H:%i')<'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'16:00')   or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.endTime,'%H:%i')<='16:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime15, case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.bookingTime,'%H:%i')<'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:30')   or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.endTime,'%H:%i')<='16:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime16, case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.bookingTime,'%H:%i')<'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'17:00')   or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.endTime,'%H:%i')<='17:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime17, case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.bookingTime,'%H:%i')<'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:30')   or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.endTime,'%H:%i')<='17:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime18, case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.bookingTime,'%H:%i')<'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'18:00')   or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.endTime,'%H:%i')<='18:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime19, case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.bookingTime,'%H:%i')<'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:30')   or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.endTime,'%H:%i')<='18:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime20, case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.bookingTime,'%H:%i')<'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'19:00')   or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.endTime,'%H:%i')<='19:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime21, case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.bookingTime,'%H:%i')<'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:30')   or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.endTime,'%H:%i')<='19:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime22, case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.bookingTime,'%H:%i')<'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'20:00')   or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.endTime,'%H:%i')<='20:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime23, case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.bookingTime,'%H:%i')<'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:30')   or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.endTime,'%H:%i')<='20:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime24, case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.bookingTime,'%H:%i')<'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'21:00')   or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.endTime,'%H:%i')<='21:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime25, case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.bookingTime,'%H:%i')<'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:30')   or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.endTime,'%H:%i')<='21:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime26, case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.bookingTime,'%H:%i')<'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'22:00')   or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.endTime,'%H:%i')<='22:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime27, case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.bookingTime,'%H:%i')<'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:30')   or (date_format(b.bookingTime,'%H:%i')<'22:30' and date_format(b.endTime,'%H:%i')>'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.endTime,'%H:%i')<='22:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime28, b.bookingDoctorId   from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 order by bookingTime ) a on a.bookingDoctorId=ec.doctorId  left join com_sys_employee e on e.employeeId=ec.doctorId  left join (select count(*) as bookNumber,b.bookingDoctorId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93  GROUP BY b.bookingDoctorId ) cou on cou.bookingDoctorId=ec.doctorId   where  ec.comId='239e97340aa84454b4c4bb36bd7879ee' and ec.shopId='02c8257d6164485eb52b20b1b078696e' and ec.isDelete=0  and ec.iStartTime>=20210818000000 and ec.iStartTime<=20210818235959  GROUP BY ec.schemeId  order by c.treatmentSort is null,
	c.treatmentSort ASc ) a  UNION ALL select * from ( select de.deptId as objectId ,de.dept as objectName ,'' as empNo,cou.bookNumber  ,group_CONCAT(a.startTime0 SEPARATOR '/-') AS startTime0 ,group_CONCAT(a.startTime1 SEPARATOR '/-') AS startTime1 ,group_CONCAT(a.startTime2 SEPARATOR '/-') AS startTime2 ,group_CONCAT(a.startTime3 SEPARATOR '/-') AS startTime3 ,group_CONCAT(a.startTime4 SEPARATOR '/-') AS startTime4 ,group_CONCAT(a.startTime5 SEPARATOR '/-') AS startTime5 ,group_CONCAT(a.startTime6 SEPARATOR '/-') AS startTime6 ,group_CONCAT(a.startTime7 SEPARATOR '/-') AS startTime7 ,group_CONCAT(a.startTime8 SEPARATOR '/-') AS startTime8 ,group_CONCAT(a.startTime9 SEPARATOR '/-') AS startTime9 ,group_CONCAT(a.startTime10 SEPARATOR '/-') AS startTime10 ,group_CONCAT(a.startTime11 SEPARATOR '/-') AS startTime11 ,group_CONCAT(a.startTime12 SEPARATOR '/-') AS startTime12 ,group_CONCAT(a.startTime13 SEPARATOR '/-') AS startTime13 ,group_CONCAT(a.startTime14 SEPARATOR '/-') AS startTime14 ,group_CONCAT(a.startTime15 SEPARATOR '/-') AS startTime15 ,group_CONCAT(a.startTime16 SEPARATOR '/-') AS startTime16 ,group_CONCAT(a.startTime17 SEPARATOR '/-') AS startTime17 ,group_CONCAT(a.startTime18 SEPARATOR '/-') AS startTime18 ,group_CONCAT(a.startTime19 SEPARATOR '/-') AS startTime19 ,group_CONCAT(a.startTime20 SEPARATOR '/-') AS startTime20 ,group_CONCAT(a.startTime21 SEPARATOR '/-') AS startTime21 ,group_CONCAT(a.startTime22 SEPARATOR '/-') AS startTime22 ,group_CONCAT(a.startTime23 SEPARATOR '/-') AS startTime23 ,group_CONCAT(a.startTime24 SEPARATOR '/-') AS startTime24 ,group_CONCAT(a.startTime25 SEPARATOR '/-') AS startTime25 ,group_CONCAT(a.startTime26 SEPARATOR '/-') AS startTime26 ,group_CONCAT(a.startTime27 SEPARATOR '/-') AS startTime27 ,group_CONCAT(a.startTime28 SEPARATOR '/-') AS startTime28 from com_his_dept_config dc  left join ( select  case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.bookingTime,'%H:%i')<'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:30')   or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  or (date_format(b.bookingTime,'%H:%i')<'08:00' and date_format(b.endTime,'%H:%i')>'08:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:00' and date_format(b.endTime,'%H:%i')<='08:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime0, case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.bookingTime,'%H:%i')<'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'09:00')   or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  or (date_format(b.bookingTime,'%H:%i')<'08:30' and date_format(b.endTime,'%H:%i')>'08:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='08:30' and date_format(b.endTime,'%H:%i')<='09:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime1, case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.bookingTime,'%H:%i')<'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:30')   or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  or (date_format(b.bookingTime,'%H:%i')<'09:00' and date_format(b.endTime,'%H:%i')>'09:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:00' and date_format(b.endTime,'%H:%i')<='09:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime2, case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.bookingTime,'%H:%i')<'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'10:00')   or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  or (date_format(b.bookingTime,'%H:%i')<'09:30' and date_format(b.endTime,'%H:%i')>'09:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='09:30' and date_format(b.endTime,'%H:%i')<='10:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime3, case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.bookingTime,'%H:%i')<'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:30')   or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  or (date_format(b.bookingTime,'%H:%i')<'10:00' and date_format(b.endTime,'%H:%i')>'10:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:00' and date_format(b.endTime,'%H:%i')<='10:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime4, case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.bookingTime,'%H:%i')<'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'11:00')   or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  or (date_format(b.bookingTime,'%H:%i')<'10:30' and date_format(b.endTime,'%H:%i')>'10:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='10:30' and date_format(b.endTime,'%H:%i')<='11:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime5, case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.bookingTime,'%H:%i')<'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:30')   or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  or (date_format(b.bookingTime,'%H:%i')<'11:00' and date_format(b.endTime,'%H:%i')>'11:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:00' and date_format(b.endTime,'%H:%i')<='11:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime6, case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.bookingTime,'%H:%i')<'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'12:00')   or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  or (date_format(b.bookingTime,'%H:%i')<'11:30' and date_format(b.endTime,'%H:%i')>'11:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='11:30' and date_format(b.endTime,'%H:%i')<='12:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime7, case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.bookingTime,'%H:%i')<'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:30')   or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  or (date_format(b.bookingTime,'%H:%i')<'12:00' and date_format(b.endTime,'%H:%i')>'12:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:00' and date_format(b.endTime,'%H:%i')<='12:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime8, case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.bookingTime,'%H:%i')<'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'13:00')   or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  or (date_format(b.bookingTime,'%H:%i')<'12:30' and date_format(b.endTime,'%H:%i')>'12:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='12:30' and date_format(b.endTime,'%H:%i')<='13:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime9, case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.bookingTime,'%H:%i')<'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:30')   or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  or (date_format(b.bookingTime,'%H:%i')<'13:00' and date_format(b.endTime,'%H:%i')>'13:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:00' and date_format(b.endTime,'%H:%i')<='13:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime10, case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.bookingTime,'%H:%i')<'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'14:00')   or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  or (date_format(b.bookingTime,'%H:%i')<'13:30' and date_format(b.endTime,'%H:%i')>'13:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='13:30' and date_format(b.endTime,'%H:%i')<='14:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime11, case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.bookingTime,'%H:%i')<'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:30')   or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  or (date_format(b.bookingTime,'%H:%i')<'14:00' and date_format(b.endTime,'%H:%i')>'14:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:00' and date_format(b.endTime,'%H:%i')<='14:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime12, case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.bookingTime,'%H:%i')<'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'15:00')   or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  or (date_format(b.bookingTime,'%H:%i')<'14:30' and date_format(b.endTime,'%H:%i')>'14:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='14:30' and date_format(b.endTime,'%H:%i')<='15:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime13, case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.bookingTime,'%H:%i')<'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:30')   or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  or (date_format(b.bookingTime,'%H:%i')<'15:00' and date_format(b.endTime,'%H:%i')>'15:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:00' and date_format(b.endTime,'%H:%i')<='15:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime14, case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.bookingTime,'%H:%i')<'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'16:00')   or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  or (date_format(b.bookingTime,'%H:%i')<'15:30' and date_format(b.endTime,'%H:%i')>'15:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='15:30' and date_format(b.endTime,'%H:%i')<='16:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime15, case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.bookingTime,'%H:%i')<'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:30')   or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  or (date_format(b.bookingTime,'%H:%i')<'16:00' and date_format(b.endTime,'%H:%i')>'16:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:00' and date_format(b.endTime,'%H:%i')<='16:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime16, case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.bookingTime,'%H:%i')<'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'17:00')   or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  or (date_format(b.bookingTime,'%H:%i')<'16:30' and date_format(b.endTime,'%H:%i')>'16:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='16:30' and date_format(b.endTime,'%H:%i')<='17:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime17, case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.bookingTime,'%H:%i')<'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:30')   or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  or (date_format(b.bookingTime,'%H:%i')<'17:00' and date_format(b.endTime,'%H:%i')>'17:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:00' and date_format(b.endTime,'%H:%i')<='17:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime18, case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.bookingTime,'%H:%i')<'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'18:00')   or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  or (date_format(b.bookingTime,'%H:%i')<'17:30' and date_format(b.endTime,'%H:%i')>'17:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='17:30' and date_format(b.endTime,'%H:%i')<='18:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime19, case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.bookingTime,'%H:%i')<'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:30')   or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  or (date_format(b.bookingTime,'%H:%i')<'18:00' and date_format(b.endTime,'%H:%i')>'18:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:00' and date_format(b.endTime,'%H:%i')<='18:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime20, case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.bookingTime,'%H:%i')<'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'19:00')   or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  or (date_format(b.bookingTime,'%H:%i')<'18:30' and date_format(b.endTime,'%H:%i')>'18:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='18:30' and date_format(b.endTime,'%H:%i')<='19:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime21, case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.bookingTime,'%H:%i')<'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:30')   or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  or (date_format(b.bookingTime,'%H:%i')<'19:00' and date_format(b.endTime,'%H:%i')>'19:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:00' and date_format(b.endTime,'%H:%i')<='19:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime22, case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.bookingTime,'%H:%i')<'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'20:00')   or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  or (date_format(b.bookingTime,'%H:%i')<'19:30' and date_format(b.endTime,'%H:%i')>'19:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='19:30' and date_format(b.endTime,'%H:%i')<='20:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime23, case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.bookingTime,'%H:%i')<'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:30')   or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  or (date_format(b.bookingTime,'%H:%i')<'20:00' and date_format(b.endTime,'%H:%i')>'20:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:00' and date_format(b.endTime,'%H:%i')<='20:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime24, case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.bookingTime,'%H:%i')<'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'21:00')   or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  or (date_format(b.bookingTime,'%H:%i')<'20:30' and date_format(b.endTime,'%H:%i')>'20:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='20:30' and date_format(b.endTime,'%H:%i')<='21:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime25, case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.bookingTime,'%H:%i')<'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:30')   or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  or (date_format(b.bookingTime,'%H:%i')<'21:00' and date_format(b.endTime,'%H:%i')>'21:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:00' and date_format(b.endTime,'%H:%i')<='21:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime26, case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.bookingTime,'%H:%i')<'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'22:00')   or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  or (date_format(b.bookingTime,'%H:%i')<'21:30' and date_format(b.endTime,'%H:%i')>'21:30')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='21:30' and date_format(b.endTime,'%H:%i')<='22:00') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime27, case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.bookingTime,'%H:%i')<'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:30')   or (date_format(b.bookingTime,'%H:%i')<'22:30' and date_format(b.endTime,'%H:%i')>'22:30')  or (date_format(b.bookingTime,'%H:%i')<'22:00' and date_format(b.endTime,'%H:%i')>'22:00')  then    CONCAT(
		'{""patientName"":',
		'""',REPLACE(IFNULL(p.patientName,IFNULL(tp.patientName,IFNULL(b.patientName,''))),'""','\\""'),'""',
    ',""remark"":','""',REPLACE(IFNULL(b.remark,''),'""','\\""'),'""',',',
    '""bookingItem"":','""',REPLACE(IFNULL(b.bookingItem,''),'""','\\""'),'""',',',
    '""patientId"":','""',IFNULL(b.patientId,''),'""',',',
    '""fileNo"":','""',IFNULL(p.fileNo,''),'""',',',
    '""endTime"":','""',IFNULL(b.endTime,''),'""',',',
    '""bookingTime"":','""',IFNULL(b.bookingTime,''),'""',',',
    '""status"":','""',IFNULL(b.status,''),'""',',',     '""eqpId"":','""',IFNULL(b.eqpId,''),'""',',',     '""treatType"":','""',IFNULL(b.treatType,''),'""',',',     '""important"":','""',IFNULL(b.important,''),'""',',',     '""temporary"":','""',IFNULL(b.temporary,''),'""',',',     '""patientId"":','""',IFNULL(b.patientId,''),'""',',',     '""extraBooking"":','""',IFNULL(b.extraBooking,''),'""',',',     '""cross"":',case when (date_format(b.bookingTime,'%H:%i')>='22:00' and date_format(b.endTime,'%H:%i')<='22:30') then '0' else '1' end,',',     '""bookingCheck"":','""',IFNULL(b.bookingCheck,''),'""',',',     '""bookingId"":','""',IFNULL(b.bookingId,''),'""','}') else '' end as startTime28, b.bookingDeptId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 and ifnull(b.bookingDoctorId,'')=''  order by bookingTime ) a on a.bookingDeptId=dc.configDeptId  left join (select count(*) as bookNumber,b.bookingDeptId  from com_his_booking b left join com_his_patient_base p on b.patientId=p.patientId left join com_his_temporary_patient tp on b.patientId=tp.patientId  where b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='02c8257d6164485eb52b20b1b078696e' and b.isDelete=0 and b.status!=92 and  b.status!=96  and b.iBookingTime>=20210818000000 and b.iBookingTime<=20210818235959 and b.status!=93 and ifnull(b.bookingDoctorId,'')=''  GROUP BY b.bookingDeptId ) cou on cou.bookingDeptId=dc.configDeptId   left join com_sys_dept de on de.deptId=dc.configDeptId  where  dc.comId='239e97340aa84454b4c4bb36bd7879ee' and dc.shopId='02c8257d6164485eb52b20b1b078696e' and dc.treatment=1 and  dc.isDelete=0  and cou.bookNumber>0  GROUP BY objectId  order by dc.treatmentSort asc) b  limit 0, 100"
507,9436,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
508,8671,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
509,8393,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
510,8537,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3fa93ee8295041b7bc2c5341930d00af' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3fa93ee8295041b7bc2c5341930d00af' )) 
511,8535,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
512,7747,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
513,7503,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' )) 
514,7406,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
515,5556,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' )) 
516,6132,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
517,4024,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
518,4024,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
519,4024,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
520,4024,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
521,4024,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
522,5391,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210817000000
				AND b.iCreateTime <= 20210817235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210817000000
				AND b.iCreateTime <= 20210817235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210817000000
				AND b.iRegTime <= 20210817235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210817000000
		AND t.iRegTime <= 20210817235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210817000000
		AND t.iBookingTime <= 20210817235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210817000000
			AND s.iCreateTime <= 20210817235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210817000000
				AND b.iRegTime <= 20210817235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
523,10591,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '5cda243c1d154f2a945edc968bc24f36' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '5cda243c1d154f2a945edc968bc24f36' )) 
524,7795,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
525,7616,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
526,4105,"select a.*,sh.shopName  from com_his_audit a  left join com_sys_shop sh on sh.shopId=a.shopId  where a.comId=? and a.isDelete=0 and (a.auditEmployeeId=? or Exists(select 1 from com_his_audit_employees s where s.isDelete=0 and s.auditId=a.auditId and s.employeeId=?)) and a.status=191 order by a.iapplyTime asc "
527,7822,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
528,7757,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
529,6912,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '8dff5faa0f1e4babb409c0c5b9428b4f' )) 
530,6714,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' )) 
531,9444,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex ,c2.revisit    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  inner join com_his_case c on r.regId=c.regId and c.courseStatus=0 and c.isDelete=0  left join( select COUNT(1) as revisit,mainCaseId from com_his_case where caseType<>852 and ifMainCase=0 and mainCaseId is not null and comId='239e97340aa84454b4c4bb36bd7879ee' and shopId='db6ed0b6b043496da39e4ff845acfaab'  GROUP BY mainCaseId) c2 on c2.mainCaseId=c.caseId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='db6ed0b6b043496da39e4ff845acfaab'   and r.treatDoctorId='ab5a3568485146ca8a9a2d43e2c8b6c7' and c.ifMainCase=1 and r.currNode = '500'  and (ifnull(c.status,850)<>852 or r.fillInCase = 1) order by r.iRegTime desc  limit 0, 15"
532,9443,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON book.registerId = r.regId
	INNER JOIN (SELECT DISTINCT regId
		FROM (SELECT DISTINCT regId
			FROM com_his_treat_assistant
			WHERE assistantId = 'd569c75c5c844718a694cc16c1cd81fa'
				AND isDelete = 0
			UNION ALL
			SELECT DISTINCT t.currRegId AS regId
			FROM com_his_charge_bill_settle_items t
			WHERE t.executeEmployeeId = 'd569c75c5c844718a694cc16c1cd81fa'
				AND isDelete = 0
			UNION ALL
			SELECT DISTINCT r.regId
			FROM com_his_treat_register r
				LEFT JOIN com_sys_employee e ON e.employeeId = r.treatDoctorId
			WHERE e.deptIdList = 'ff034dddcb374504aa99a508c4c335d3'
			) t
		) ass ON r.regId = ass.regId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
		AND r.ifConsult = 1
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN com_sys_employee e5 ON e5.employeeId = r.upperDoctorId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN com_his_treat_transfer tf ON tf.isDelete = 0
		AND tf.regId = r.regId
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN (SELECT t.currRegId, SUM(t.currPay) AS pay, SUM(t.currWorkload) AS workload
		FROM com_his_charge_settle_bill t
			LEFT JOIN com_his_charge_bill b ON t.billId = b.billId
		WHERE b.billType = 200
		GROUP BY t.currRegId
		) bl ON r.regId = bl.currRegId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName, GROUP_CONCAT(b.employeeId) AS assistId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 380
		GROUP BY a.regId
		) j ON j.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName, GROUP_CONCAT(b.employeeId) AS nurseId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 381
		GROUP BY a.regId
		) k ON k.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName, GROUP_CONCAT(b.employeeId) AS consultaId
		FROM com_his_treat_consultation_doctor a
			LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
		GROUP BY a.regId
		) m ON m.regId = r.regId 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (EXISTS (SELECT 1
			FROM com_his_treat_assistant ast
			WHERE r.regId = ast.regId
				AND ast.isDelete = 0
				AND ast.assistantType = 380
				AND assistantId = 'd569c75c5c844718a694cc16c1cd81fa')
		OR EXISTS (SELECT 1
			FROM com_his_treat_assistant ast
			WHERE r.regId = ast.regId
				AND ast.isDelete = 0
				AND ast.assistantType = 381
				AND assistantId = 'd569c75c5c844718a694cc16c1cd81fa'))
	AND r.regTime >= 20210817000000
	AND r.regTime <= 20210817235959"
533,5939,"select r.*,e2.employeeName counselorName,b.patientName,(select f.formId from com_his_treat_form f where f.regId = r.regId and f.formCod = 2648) as formId,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo, tr1.catName as appealName1,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, j.assistName as helperDoctor, k.nurseName as helperNurse, m.consultaName as staffName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,ot.black,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,case when tf.transferId is null then 0 else 1 end transfer,case when r.treatStatus=1060 or r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else r.consultWaitDuration end as consultWaitMin,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,ifnull(bl.pay,0) as pay,ifnull(bl.workload,0) as workload,di1.dict as memberLevelName,b.sex    from com_his_treat_register r  left join com_his_booking book on book.registerId = r.regId  inner join ( select distinct regId from ( select distinct regId from com_his_treat_assistant where assistantId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select distinct t.currRegId as regId from com_his_charge_bill_settle_items t where t.executeEmployeeId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select DISTINCT r.regId from com_his_treat_register r left join com_sys_employee e on e.employeeId = r.treatDoctorId where e.deptIdList ='ff034dddcb374504aa99a508c4c335d3' ) t ) ass on r.regId=ass.regId  left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di1 on di1.did = mem.memberLevel  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left outer join sys_dict a on b.source = a.did  left outer join com_his_treat_transfer tf on tf.isDelete=0 and tf.regId=r.regId  left outer join sys_treedictcat tr on b.channel=tr.catId  left outer join (select t.currRegId,sum(t.currPay) as pay,sum(t.currWorkload) workload from com_his_charge_settle_bill t left outer join com_his_charge_bill b on t.billId=b.billId where b.billType=200 group by t.currRegId) bl on r.regId=bl.currRegId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as assistName,GROUP_CONCAT(b.employeeId) as assistId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId   WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=380 group by a.regId)  j on j.regId=r.regId   LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as nurseName,GROUP_CONCAT(b.employeeId) as nurseId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=381 group by a.regId)  k on k.regId=r.regId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as consultaName,GROUP_CONCAT(b.employeeId)  as consultaId FROM com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId=b.employeeId  WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 group by a.regId)  m on m.regId=r.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and  (Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=380 and assistantId='d569c75c5c844718a694cc16c1cd81fa') OR Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=381 and assistantId='d569c75c5c844718a694cc16c1cd81fa')) and r.regTime>=20210817000000 and r.regTime <=20210817235959 order by  r.regTime desc  limit 0, 15"
534,9443,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON book.registerId = r.regId
	INNER JOIN (SELECT DISTINCT regId
		FROM (SELECT DISTINCT regId
			FROM com_his_treat_assistant
			WHERE assistantId = 'd569c75c5c844718a694cc16c1cd81fa'
				AND isDelete = 0
			UNION ALL
			SELECT DISTINCT t.currRegId AS regId
			FROM com_his_charge_bill_settle_items t
			WHERE t.executeEmployeeId = 'd569c75c5c844718a694cc16c1cd81fa'
				AND isDelete = 0
			UNION ALL
			SELECT DISTINCT r.regId
			FROM com_his_treat_register r
				LEFT JOIN com_sys_employee e ON e.employeeId = r.treatDoctorId
			WHERE e.deptIdList = 'ff034dddcb374504aa99a508c4c335d3'
			) t
		) ass ON r.regId = ass.regId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
		AND r.ifConsult = 1
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN com_sys_employee e5 ON e5.employeeId = r.upperDoctorId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN com_his_treat_transfer tf ON tf.isDelete = 0
		AND tf.regId = r.regId
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN (SELECT t.currRegId, SUM(t.currPay) AS pay, SUM(t.currWorkload) AS workload
		FROM com_his_charge_settle_bill t
			LEFT JOIN com_his_charge_bill b ON t.billId = b.billId
		WHERE b.billType = 200
		GROUP BY t.currRegId
		) bl ON r.regId = bl.currRegId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName, GROUP_CONCAT(b.employeeId) AS assistId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 380
		GROUP BY a.regId
		) j ON j.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName, GROUP_CONCAT(b.employeeId) AS nurseId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 381
		GROUP BY a.regId
		) k ON k.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName, GROUP_CONCAT(b.employeeId) AS consultaId
		FROM com_his_treat_consultation_doctor a
			LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
		GROUP BY a.regId
		) m ON m.regId = r.regId 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (EXISTS (SELECT 1
			FROM com_his_treat_assistant ast
			WHERE r.regId = ast.regId
				AND ast.isDelete = 0
				AND ast.assistantType = 380
				AND assistantId = 'd569c75c5c844718a694cc16c1cd81fa')
		OR EXISTS (SELECT 1
			FROM com_his_treat_assistant ast
			WHERE r.regId = ast.regId
				AND ast.isDelete = 0
				AND ast.assistantType = 381
				AND assistantId = 'd569c75c5c844718a694cc16c1cd81fa'))
	AND r.regTime >= 20210817000000
	AND r.regTime <= 20210817235959"
535,5939,"select r.*,e2.employeeName counselorName,b.patientName,(select f.formId from com_his_treat_form f where f.regId = r.regId and f.formCod = 2648) as formId,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo, tr1.catName as appealName1,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, j.assistName as helperDoctor, k.nurseName as helperNurse, m.consultaName as staffName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,ot.black,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,case when tf.transferId is null then 0 else 1 end transfer,case when r.treatStatus=1060 or r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else r.consultWaitDuration end as consultWaitMin,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,ifnull(bl.pay,0) as pay,ifnull(bl.workload,0) as workload,di1.dict as memberLevelName,b.sex    from com_his_treat_register r  left join com_his_booking book on book.registerId = r.regId  inner join ( select distinct regId from ( select distinct regId from com_his_treat_assistant where assistantId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select distinct t.currRegId as regId from com_his_charge_bill_settle_items t where t.executeEmployeeId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select DISTINCT r.regId from com_his_treat_register r left join com_sys_employee e on e.employeeId = r.treatDoctorId where e.deptIdList ='ff034dddcb374504aa99a508c4c335d3' ) t ) ass on r.regId=ass.regId  left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di1 on di1.did = mem.memberLevel  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left outer join sys_dict a on b.source = a.did  left outer join com_his_treat_transfer tf on tf.isDelete=0 and tf.regId=r.regId  left outer join sys_treedictcat tr on b.channel=tr.catId  left outer join (select t.currRegId,sum(t.currPay) as pay,sum(t.currWorkload) workload from com_his_charge_settle_bill t left outer join com_his_charge_bill b on t.billId=b.billId where b.billType=200 group by t.currRegId) bl on r.regId=bl.currRegId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as assistName,GROUP_CONCAT(b.employeeId) as assistId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId   WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=380 group by a.regId)  j on j.regId=r.regId   LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as nurseName,GROUP_CONCAT(b.employeeId) as nurseId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=381 group by a.regId)  k on k.regId=r.regId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as consultaName,GROUP_CONCAT(b.employeeId)  as consultaId FROM com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId=b.employeeId  WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 group by a.regId)  m on m.regId=r.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and  (Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=380 and assistantId='d569c75c5c844718a694cc16c1cd81fa') OR Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=381 and assistantId='d569c75c5c844718a694cc16c1cd81fa')) and r.regTime>=20210817000000 and r.regTime <=20210817235959 order by  r.regTime desc  limit 0, 15"
536,9443,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON book.registerId = r.regId
	INNER JOIN (SELECT DISTINCT regId
		FROM (SELECT DISTINCT regId
			FROM com_his_treat_assistant
			WHERE assistantId = 'd569c75c5c844718a694cc16c1cd81fa'
				AND isDelete = 0
			UNION ALL
			SELECT DISTINCT t.currRegId AS regId
			FROM com_his_charge_bill_settle_items t
			WHERE t.executeEmployeeId = 'd569c75c5c844718a694cc16c1cd81fa'
				AND isDelete = 0
			UNION ALL
			SELECT DISTINCT r.regId
			FROM com_his_treat_register r
				LEFT JOIN com_sys_employee e ON e.employeeId = r.treatDoctorId
			WHERE e.deptIdList = 'ff034dddcb374504aa99a508c4c335d3'
			) t
		) ass ON r.regId = ass.regId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
		AND r.ifConsult = 1
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN com_sys_employee e5 ON e5.employeeId = r.upperDoctorId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN com_his_treat_transfer tf ON tf.isDelete = 0
		AND tf.regId = r.regId
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN (SELECT t.currRegId, SUM(t.currPay) AS pay, SUM(t.currWorkload) AS workload
		FROM com_his_charge_settle_bill t
			LEFT JOIN com_his_charge_bill b ON t.billId = b.billId
		WHERE b.billType = 200
		GROUP BY t.currRegId
		) bl ON r.regId = bl.currRegId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName, GROUP_CONCAT(b.employeeId) AS assistId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 380
		GROUP BY a.regId
		) j ON j.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName, GROUP_CONCAT(b.employeeId) AS nurseId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 381
		GROUP BY a.regId
		) k ON k.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName, GROUP_CONCAT(b.employeeId) AS consultaId
		FROM com_his_treat_consultation_doctor a
			LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
		GROUP BY a.regId
		) m ON m.regId = r.regId 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (EXISTS (SELECT 1
			FROM com_his_treat_assistant ast
			WHERE r.regId = ast.regId
				AND ast.isDelete = 0
				AND ast.assistantType = 380
				AND assistantId = 'd569c75c5c844718a694cc16c1cd81fa')
		OR EXISTS (SELECT 1
			FROM com_his_treat_assistant ast
			WHERE r.regId = ast.regId
				AND ast.isDelete = 0
				AND ast.assistantType = 381
				AND assistantId = 'd569c75c5c844718a694cc16c1cd81fa'))
	AND r.regTime >= 20210817000000
	AND r.regTime <= 20210817235959"
537,5939,"select r.*,e2.employeeName counselorName,b.patientName,(select f.formId from com_his_treat_form f where f.regId = r.regId and f.formCod = 2648) as formId,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo, tr1.catName as appealName1,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, j.assistName as helperDoctor, k.nurseName as helperNurse, m.consultaName as staffName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,ot.black,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,case when tf.transferId is null then 0 else 1 end transfer,case when r.treatStatus=1060 or r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else r.consultWaitDuration end as consultWaitMin,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,ifnull(bl.pay,0) as pay,ifnull(bl.workload,0) as workload,di1.dict as memberLevelName,b.sex    from com_his_treat_register r  left join com_his_booking book on book.registerId = r.regId  inner join ( select distinct regId from ( select distinct regId from com_his_treat_assistant where assistantId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select distinct t.currRegId as regId from com_his_charge_bill_settle_items t where t.executeEmployeeId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select DISTINCT r.regId from com_his_treat_register r left join com_sys_employee e on e.employeeId = r.treatDoctorId where e.deptIdList ='ff034dddcb374504aa99a508c4c335d3' ) t ) ass on r.regId=ass.regId  left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di1 on di1.did = mem.memberLevel  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left outer join sys_dict a on b.source = a.did  left outer join com_his_treat_transfer tf on tf.isDelete=0 and tf.regId=r.regId  left outer join sys_treedictcat tr on b.channel=tr.catId  left outer join (select t.currRegId,sum(t.currPay) as pay,sum(t.currWorkload) workload from com_his_charge_settle_bill t left outer join com_his_charge_bill b on t.billId=b.billId where b.billType=200 group by t.currRegId) bl on r.regId=bl.currRegId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as assistName,GROUP_CONCAT(b.employeeId) as assistId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId   WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=380 group by a.regId)  j on j.regId=r.regId   LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as nurseName,GROUP_CONCAT(b.employeeId) as nurseId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=381 group by a.regId)  k on k.regId=r.regId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as consultaName,GROUP_CONCAT(b.employeeId)  as consultaId FROM com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId=b.employeeId  WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 group by a.regId)  m on m.regId=r.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and  (Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=380 and assistantId='d569c75c5c844718a694cc16c1cd81fa') OR Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=381 and assistantId='d569c75c5c844718a694cc16c1cd81fa')) and r.regTime>=20210817000000 and r.regTime <=20210817235959 order by  r.regTime desc  limit 0, 15"
538,9443,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON book.registerId = r.regId
	INNER JOIN (SELECT DISTINCT regId
		FROM (SELECT DISTINCT regId
			FROM com_his_treat_assistant
			WHERE assistantId = 'd569c75c5c844718a694cc16c1cd81fa'
				AND isDelete = 0
			UNION ALL
			SELECT DISTINCT t.currRegId AS regId
			FROM com_his_charge_bill_settle_items t
			WHERE t.executeEmployeeId = 'd569c75c5c844718a694cc16c1cd81fa'
				AND isDelete = 0
			UNION ALL
			SELECT DISTINCT r.regId
			FROM com_his_treat_register r
				LEFT JOIN com_sys_employee e ON e.employeeId = r.treatDoctorId
			WHERE e.deptIdList = 'ff034dddcb374504aa99a508c4c335d3'
			) t
		) ass ON r.regId = ass.regId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
		AND r.ifConsult = 1
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN com_sys_employee e5 ON e5.employeeId = r.upperDoctorId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN com_his_treat_transfer tf ON tf.isDelete = 0
		AND tf.regId = r.regId
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN (SELECT t.currRegId, SUM(t.currPay) AS pay, SUM(t.currWorkload) AS workload
		FROM com_his_charge_settle_bill t
			LEFT JOIN com_his_charge_bill b ON t.billId = b.billId
		WHERE b.billType = 200
		GROUP BY t.currRegId
		) bl ON r.regId = bl.currRegId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS assistName, GROUP_CONCAT(b.employeeId) AS assistId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 380
		GROUP BY a.regId
		) j ON j.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName, GROUP_CONCAT(b.employeeId) AS nurseId
		FROM com_his_treat_assistant a
			LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
			AND a.assistantType = 381
		GROUP BY a.regId
		) k ON k.regId = r.regId
	LEFT JOIN (SELECT a.regId, GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName, GROUP_CONCAT(b.employeeId) AS consultaId
		FROM com_his_treat_consultation_doctor a
			LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId
		WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND a.isDelete = 0
		GROUP BY a.regId
		) m ON m.regId = r.regId 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (EXISTS (SELECT 1
			FROM com_his_treat_assistant ast
			WHERE r.regId = ast.regId
				AND ast.isDelete = 0
				AND ast.assistantType = 380
				AND assistantId = 'd569c75c5c844718a694cc16c1cd81fa')
		OR EXISTS (SELECT 1
			FROM com_his_treat_assistant ast
			WHERE r.regId = ast.regId
				AND ast.isDelete = 0
				AND ast.assistantType = 381
				AND assistantId = 'd569c75c5c844718a694cc16c1cd81fa'))
	AND r.regTime >= 20210817000000
	AND r.regTime <= 20210817235959"
539,5939,"select r.*,e2.employeeName counselorName,b.patientName,(select f.formId from com_his_treat_form f where f.regId = r.regId and f.formCod = 2648) as formId,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo, tr1.catName as appealName1,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, j.assistName as helperDoctor, k.nurseName as helperNurse, m.consultaName as staffName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,ot.black,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,case when tf.transferId is null then 0 else 1 end transfer,case when r.treatStatus=1060 or r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else r.consultWaitDuration end as consultWaitMin,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,ifnull(bl.pay,0) as pay,ifnull(bl.workload,0) as workload,di1.dict as memberLevelName,b.sex    from com_his_treat_register r  left join com_his_booking book on book.registerId = r.regId  inner join ( select distinct regId from ( select distinct regId from com_his_treat_assistant where assistantId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select distinct t.currRegId as regId from com_his_charge_bill_settle_items t where t.executeEmployeeId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select DISTINCT r.regId from com_his_treat_register r left join com_sys_employee e on e.employeeId = r.treatDoctorId where e.deptIdList ='ff034dddcb374504aa99a508c4c335d3' ) t ) ass on r.regId=ass.regId  left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di1 on di1.did = mem.memberLevel  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left outer join sys_dict a on b.source = a.did  left outer join com_his_treat_transfer tf on tf.isDelete=0 and tf.regId=r.regId  left outer join sys_treedictcat tr on b.channel=tr.catId  left outer join (select t.currRegId,sum(t.currPay) as pay,sum(t.currWorkload) workload from com_his_charge_settle_bill t left outer join com_his_charge_bill b on t.billId=b.billId where b.billType=200 group by t.currRegId) bl on r.regId=bl.currRegId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as assistName,GROUP_CONCAT(b.employeeId) as assistId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId   WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=380 group by a.regId)  j on j.regId=r.regId   LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as nurseName,GROUP_CONCAT(b.employeeId) as nurseId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=381 group by a.regId)  k on k.regId=r.regId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as consultaName,GROUP_CONCAT(b.employeeId)  as consultaId FROM com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId=b.employeeId  WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 group by a.regId)  m on m.regId=r.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and  (Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=380 and assistantId='d569c75c5c844718a694cc16c1cd81fa') OR Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=381 and assistantId='d569c75c5c844718a694cc16c1cd81fa')) and r.regTime>=20210817000000 and r.regTime <=20210817235959 order by  r.regTime desc  limit 0, 15"
540,5939,"select r.*,e2.employeeName counselorName,b.patientName,(select f.formId from com_his_treat_form f where f.regId = r.regId and f.formCod = 2648) as formId,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo, tr1.catName as appealName1,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, j.assistName as helperDoctor, k.nurseName as helperNurse, m.consultaName as staffName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,ot.black,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,case when tf.transferId is null then 0 else 1 end transfer,case when r.treatStatus=1060 or r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else r.consultWaitDuration end as consultWaitMin,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,ifnull(bl.pay,0) as pay,ifnull(bl.workload,0) as workload,di1.dict as memberLevelName,b.sex    from com_his_treat_register r  left join com_his_booking book on book.registerId = r.regId  inner join ( select distinct regId from ( select distinct regId from com_his_treat_assistant where assistantId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select distinct t.currRegId as regId from com_his_charge_bill_settle_items t where t.executeEmployeeId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select DISTINCT r.regId from com_his_treat_register r left join com_sys_employee e on e.employeeId = r.treatDoctorId where e.deptIdList ='ff034dddcb374504aa99a508c4c335d3' ) t ) ass on r.regId=ass.regId  left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di1 on di1.did = mem.memberLevel  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left outer join sys_dict a on b.source = a.did  left outer join com_his_treat_transfer tf on tf.isDelete=0 and tf.regId=r.regId  left outer join sys_treedictcat tr on b.channel=tr.catId  left outer join (select t.currRegId,sum(t.currPay) as pay,sum(t.currWorkload) workload from com_his_charge_settle_bill t left outer join com_his_charge_bill b on t.billId=b.billId where b.billType=200 group by t.currRegId) bl on r.regId=bl.currRegId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as assistName,GROUP_CONCAT(b.employeeId) as assistId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId   WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=380 group by a.regId)  j on j.regId=r.regId   LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as nurseName,GROUP_CONCAT(b.employeeId) as nurseId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=381 group by a.regId)  k on k.regId=r.regId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as consultaName,GROUP_CONCAT(b.employeeId)  as consultaId FROM com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId=b.employeeId  WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 group by a.regId)  m on m.regId=r.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and  (Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=380 and assistantId='d569c75c5c844718a694cc16c1cd81fa') OR Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=381 and assistantId='d569c75c5c844718a694cc16c1cd81fa')) and r.regTime>=20210817000000 and r.regTime <=20210817235959 order by  r.regTime desc  limit 0, 15"
541,5939,"select r.*,e2.employeeName counselorName,b.patientName,(select f.formId from com_his_treat_form f where f.regId = r.regId and f.formCod = 2648) as formId,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo, tr1.catName as appealName1,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, j.assistName as helperDoctor, k.nurseName as helperNurse, m.consultaName as staffName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,ot.black,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,case when tf.transferId is null then 0 else 1 end transfer,case when r.treatStatus=1060 or r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else r.consultWaitDuration end as consultWaitMin,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,ifnull(bl.pay,0) as pay,ifnull(bl.workload,0) as workload,di1.dict as memberLevelName,b.sex    from com_his_treat_register r  left join com_his_booking book on book.registerId = r.regId  inner join ( select distinct regId from ( select distinct regId from com_his_treat_assistant where assistantId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select distinct t.currRegId as regId from com_his_charge_bill_settle_items t where t.executeEmployeeId='d569c75c5c844718a694cc16c1cd81fa' and isDelete=0 union all  select DISTINCT r.regId from com_his_treat_register r left join com_sys_employee e on e.employeeId = r.treatDoctorId where e.deptIdList ='ff034dddcb374504aa99a508c4c335d3' ) t ) ass on r.regId=ass.regId  left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join sys_dict di1 on di1.did = mem.memberLevel  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left outer join sys_dict a on b.source = a.did  left outer join com_his_treat_transfer tf on tf.isDelete=0 and tf.regId=r.regId  left outer join sys_treedictcat tr on b.channel=tr.catId  left outer join (select t.currRegId,sum(t.currPay) as pay,sum(t.currWorkload) workload from com_his_charge_settle_bill t left outer join com_his_charge_bill b on t.billId=b.billId where b.billType=200 group by t.currRegId) bl on r.regId=bl.currRegId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as assistName,GROUP_CONCAT(b.employeeId) as assistId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId   WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=380 group by a.regId)  j on j.regId=r.regId   LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as nurseName,GROUP_CONCAT(b.employeeId) as nurseId FROM com_his_treat_assistant a   LEFT JOIN com_sys_employee b ON a.assistantId=b.employeeId WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 and a.assistantType=381 group by a.regId)  k on k.regId=r.regId  LEFT JOIN (SELECT a.regId,GROUP_CONCAT(b.employeeName SEPARATOR '/') as consultaName,GROUP_CONCAT(b.employeeId)  as consultaId FROM com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId=b.employeeId  WHERE a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.shopId='85c94b66653b4495bf60fac3f770f7ea' and a.isDelete=0 group by a.regId)  m on m.regId=r.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and  (Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=380 and assistantId='d569c75c5c844718a694cc16c1cd81fa') OR Exists(select 1 from com_his_treat_assistant ast  where r.regId = ast.regId and ast.isDelete=0  and ast.assistantType=381 and assistantId='d569c75c5c844718a694cc16c1cd81fa')) and r.regTime>=20210817000000 and r.regTime <=20210817235959 order by  r.regTime desc  limit 0, 15"
542,4571,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
543,4712,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
544,4379,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
545,4239,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
546,17104,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '64bfe42e44ce4de8bd8c25e85d34cf47' )) 
547,10351,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
548,10144,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
549,22325,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '5cda243c1d154f2a945edc968bc24f36' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '5cda243c1d154f2a945edc968bc24f36' )) 
550,10498,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
551,10363,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'b3bf9f73efc1456eab34abeb2286018f' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'b3bf9f73efc1456eab34abeb2286018f' )) 
552,8861,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'bcded4f7f5fe42bd944527b549a327ef' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'bcded4f7f5fe42bd944527b549a327ef' )) 
553,8930,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
554,9656,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
555,9527,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c98923a69dc645d59e248cd03089772e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c98923a69dc645d59e248cd03089772e' )) 
556,4892,"select count(r.regId) from com_his_treat_register r left join com_his_consult c on r.regId = c.regId where r.comId = '239e97340aa84454b4c4bb36bd7879ee' and r.shopId = '85c94b66653b4495bf60fac3f770f7ea' and r.isDelete = 0 and r.ifConsult = 1 and ifNull(c.consultId, '') = '' and r.treatStatus = 1068 and r.finishType = 361 and r.counselorId = 'ec821e85f6dc43c7ac9529e6456cd1ae' "
557,4614,select count(*) from com_his_treat_register r left join com_his_case c on r.regId = c.regId where r.programming = 0 and  r.comId = '239e97340aa84454b4c4bb36bd7879ee' and r.shopId = '85c94b66653b4495bf60fac3f770f7ea' and r.currNode =400 and c.status <>852
558,6033,select count(*) from com_his_treat_register r left join com_his_case c on r.regId = c.regId left join com_sys_employee e on r.treatDoctorId = e.employeeId where r.comId = '239e97340aa84454b4c4bb36bd7879ee' and r.shopId = '85c94b66653b4495bf60fac3f770f7ea' and r.currNode = 500 and (c.status = 850 or c.status is null)  and (c.caseType != 825 or c.caseType is null)  and (c.caseType != 824 or c.caseType is null)  and r.finishType = 361 and r.treatStatus = 1068 and r.fillInCase=0 
559,4654,select * from com_his_treat_diagnose_teeth where regId='ec6cf029035f49d3a02446a3ce031d4b'
560,4654,select * from com_his_treat_diagnose_teeth where regId='ec6cf029035f49d3a02446a3ce031d4b'
561,4497,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
562,4396,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
563,4396,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
564,4396,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
565,4396,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
566,7487,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
567,6500,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
568,7487,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
569,6500,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
570,7487,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
571,6500,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
572,6500,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
573,6500,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
574,6500,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
575,6500,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
576,6646,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
577,6646,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
578,6428,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
579,6646,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
580,6428,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
581,6646,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
582,6428,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
583,4033,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='85c94b66653b4495bf60fac3f770f7ea'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210817000000 and b.iBookingTime <=20210817235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
584,4033,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='85c94b66653b4495bf60fac3f770f7ea'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210817000000 and b.iBookingTime <=20210817235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
585,13239,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='85c94b66653b4495bf60fac3f770f7ea'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210801000000 and b.iBookingTime <=20210831235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
586,4033,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='85c94b66653b4495bf60fac3f770f7ea'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210817000000 and b.iBookingTime <=20210817235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
587,5902,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
588,5902,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
589,5803,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
590,5902,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
591,5803,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
592,5902,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
593,5803,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
594,5902,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
595,5803,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
596,5902,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
597,5803,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
598,5902,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
599,5803,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
600,5902,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
601,5803,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
602,5902,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
603,5803,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
604,5867,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
605,5870,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
606,5867,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
607,5870,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
608,5867,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
609,5870,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
610,5867,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
611,5870,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
612,5867,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
613,5870,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
614,5867,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
615,5870,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
616,5867,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
617,4504,"select pb.*,b.bookingItem,b.bookingTime,b.bookingId,di.dict as source,case b.treatType when 340 then '首诊' when 341 then '再诊' else '复诊' end treatTypeName,e.employeeName as doctor,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(CURDATE()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end,case when ifnull(pb.birthday,'')='' then year(CURDATE()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age  from com_his_booking b LEFT JOIN com_sys_employee e on b.bookingDoctorId=e.employeeId left join com_his_patient_base pb on pb.patientId=b.patientId left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join sys_dict di on di.did=pb.source left join (select f.patientId,f.regId,f.bookingId as bookingId1 from com_his_treat_form f where f.formCod = 2638 and f.isDelete = 0 and f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'  and f.comId = '239e97340aa84454b4c4bb36bd7879ee' and f.iCreateTime >=20210817000000 and f.iCreateTime <=20210817235959)bb  on  b.patientId = bb.patientId and  (bb.regId=b.registerId or IFNULL(bb.regId,'')='')  where b.treatType<>340 and bb.bookingId1 is null and b.isDelete = 0 and b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='db6ed0b6b043496da39e4ff845acfaab' and  b.status=90 and b.iBookingTime>=20210817000000 and b.iBookingTime<=20210817235959  order by b.bookingTime asc "
618,4504,"select pb.*,b.bookingItem,b.bookingTime,b.bookingId,di.dict as source,case b.treatType when 340 then '首诊' when 341 then '再诊' else '复诊' end treatTypeName,e.employeeName as doctor,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(CURDATE()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end,case when ifnull(pb.birthday,'')='' then year(CURDATE()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age  from com_his_booking b LEFT JOIN com_sys_employee e on b.bookingDoctorId=e.employeeId left join com_his_patient_base pb on pb.patientId=b.patientId left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join sys_dict di on di.did=pb.source left join (select f.patientId,f.regId,f.bookingId as bookingId1 from com_his_treat_form f where f.formCod = 2638 and f.isDelete = 0 and f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'  and f.comId = '239e97340aa84454b4c4bb36bd7879ee' and f.iCreateTime >=20210817000000 and f.iCreateTime <=20210817235959)bb  on  b.patientId = bb.patientId and  (bb.regId=b.registerId or IFNULL(bb.regId,'')='')  where b.treatType<>340 and bb.bookingId1 is null and b.isDelete = 0 and b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='db6ed0b6b043496da39e4ff845acfaab' and  b.status=90 and b.iBookingTime>=20210817000000 and b.iBookingTime<=20210817235959  order by b.bookingTime asc "
619,4504,"select pb.*,b.bookingItem,b.bookingTime,b.bookingId,di.dict as source,case b.treatType when 340 then '首诊' when 341 then '再诊' else '复诊' end treatTypeName,e.employeeName as doctor,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(CURDATE()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end,case when ifnull(pb.birthday,'')='' then year(CURDATE()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age  from com_his_booking b LEFT JOIN com_sys_employee e on b.bookingDoctorId=e.employeeId left join com_his_patient_base pb on pb.patientId=b.patientId left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join sys_dict di on di.did=pb.source left join (select f.patientId,f.regId,f.bookingId as bookingId1 from com_his_treat_form f where f.formCod = 2638 and f.isDelete = 0 and f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'  and f.comId = '239e97340aa84454b4c4bb36bd7879ee' and f.iCreateTime >=20210817000000 and f.iCreateTime <=20210817235959)bb  on  b.patientId = bb.patientId and  (bb.regId=b.registerId or IFNULL(bb.regId,'')='')  where b.treatType<>340 and bb.bookingId1 is null and b.isDelete = 0 and b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='db6ed0b6b043496da39e4ff845acfaab' and  b.status=90 and b.iBookingTime>=20210817000000 and b.iBookingTime<=20210817235959  order by b.bookingTime asc "
620,4504,"select pb.*,b.bookingItem,b.bookingTime,b.bookingId,di.dict as source,case b.treatType when 340 then '首诊' when 341 then '再诊' else '复诊' end treatTypeName,e.employeeName as doctor,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(CURDATE()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end,case when ifnull(pb.birthday,'')='' then year(CURDATE()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age  from com_his_booking b LEFT JOIN com_sys_employee e on b.bookingDoctorId=e.employeeId left join com_his_patient_base pb on pb.patientId=b.patientId left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join sys_dict di on di.did=pb.source left join (select f.patientId,f.regId,f.bookingId as bookingId1 from com_his_treat_form f where f.formCod = 2638 and f.isDelete = 0 and f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'  and f.comId = '239e97340aa84454b4c4bb36bd7879ee' and f.iCreateTime >=20210817000000 and f.iCreateTime <=20210817235959)bb  on  b.patientId = bb.patientId and  (bb.regId=b.registerId or IFNULL(bb.regId,'')='')  where b.treatType<>340 and bb.bookingId1 is null and b.isDelete = 0 and b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='db6ed0b6b043496da39e4ff845acfaab' and  b.status=90 and b.iBookingTime>=20210817000000 and b.iBookingTime<=20210817235959  order by b.bookingTime asc "
621,7624," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='02c8257d6164485eb52b20b1b078696e' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
622,7624," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='02c8257d6164485eb52b20b1b078696e' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
623,7624," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='02c8257d6164485eb52b20b1b078696e' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
624,7624," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='02c8257d6164485eb52b20b1b078696e' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
625,7624," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='02c8257d6164485eb52b20b1b078696e' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
626,5314,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
627,5314,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
628,5314,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
629,6772,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
630,6772,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
631,5941,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
632,6772,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
633,5941,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
634,6291,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
635,6291,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
636,5848,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
637,5848,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
638,5375,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='85c94b66653b4495bf60fac3f770f7ea'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210809000000 and b.iBookingTime <=20210815235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
639,5375,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='85c94b66653b4495bf60fac3f770f7ea'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210809000000 and b.iBookingTime <=20210815235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
640,5375,"select if(ifnull(pb.patientName,'')='',b.patientName,pb.patientName) as patientName2,pb.isSign,(SELECT g.bookingTime from com_his_booking g where  g.STATUS = 90 AND   g.changeBookingId = b.changeBookingId and g.patientId=b.patientId and b.cancelReason='改约' ORDER BY g.bookingTime DESC LIMIT 1 ) as changeBookingTime,b.*,if(b.status = 92, b.bookTmpType, 0) as bookTmpType1, (select nb.bookingTime from com_his_booking nb where nb.patientId=b.patientId and nb.status = 90 order by nb.bookingTime desc limit 0,1) as newBookingTime,IFNULL(di.dict,b.cancelReason) AS cancelReason,di1.dict AS cancelType,(case when b.cancelType=1 then '跟进' when b.cancelType=0 then '流失' end ) as cancelType1,case when b.status = 90 and b.bookingTime < now() then  TIMESTAMPDIFF(MINUTE,b.bookingTime,now())  else '' end as bookingWaitTime, pb.searchCode,ifnull(pb.patientNameRemark,'') patientNameRemark,di4.dict as bookingCycle,di5.dict as flowPath,ro.roomName, case when ifnull((select batchId from com_his_follow_batch fb where b.bookingId=fb.bookingId limit 0,1),'')<>'' then 1 else 0 end as isFollow,ifnull(mem.memberStar,0) as memberStar,pb.fileNo,di3.dict as patientSource,tr.catName as channel,  (date_format(pb.birthday,'%Y-%m-%d')) as birthday, (select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay   from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle e on t.settleId=e.settleId  where e.patientId=b.patientId  and IFNULL(t.systemFlag,'')<>'Plan')  as amount,pb.oldFileNo,pb.birthYear,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(Now()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end, case when ifnull(pb.birthday,'')='' then year(Now()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age,e.employeeName doctorName,e4.employeeName as modifyEmployeeName,e5.employeeName as cancelEmpName,d.dept deptName,ot.black,sdd.place, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=pb.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, a.dict eqpName,case when b.bookingFlag=-1 then null else b.bookingFlag end as bookingFlag1,e2.employeeName as createEmployeeName,e3.employeeName as dutyConsultName,sh.shopName as bookingShopName,b.modifyTime,b.cancelTime,ifnull(r.treatType,b.treatType) as treatTypeName, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2639  and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0   LIMIT 1) as formId, (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.formCod=2638 and date_format(f.createTime,'yyyy-MM-dd')=date_format(b.bookingTime,'yyyy-MM-dd') and f.shopId=b.shopId and f.comId=b.comId and f.isDelete=0  order BY iCreateTime DESC  LIMIT 1) as formId2,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,(SELECT ifnull(SUM(T.balance),0) AS balance FROM com_his_charge_bill T WHERE T.isDelete=0 AND T.`status`<>239 AND T.billType<>202 and T.ifSettle=1  and t.comId='239e97340aa84454b4c4bb36bd7879ee'  and t.patientId=b.patientId) as lack2 ,case b.weekDay when 140 then '周日' when 141 then '周一' when 142 then '周二' when 143 then '周三' when 144 then '周四' when 145 then '周五' when 146 then '周六' when 147 then '当天' else '' end as weekDay,IFNULL(concat(pb.phone1,case when ifnull(pb.phone2,'')='' then '' else concat('/',pb.phone2) end),b.mobilePhone) as phone3    from com_his_booking b left join com_his_treat_register r on r.regId=b.registerId  left join com_sys_dept d on b.bookingDeptId = d.deptId  left join com_sys_employee e on b.bookingDoctorId=e.employeeId  left join sys_dict a on b.eqpId=a.did  left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=b.shopId  left join com_his_patient_base pb on b.patientId=pb.patientId  left join com_his_patient_other ot on b.patientId=ot.patientId  left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join com_his_patient_member mem on mem.patientId=b.patientId  left join com_sys_employee e2 on e2.employeeId=b.createEmployeeId LEFT JOIN com_sys_employee e3 on e3.employeeId=pb.dutyConsultId  left join com_sys_employee e4 on e4.employeeId=b.modifyEmployeeId  left join com_sys_employee e5 on e5.employeeId=b.cancelEmpId  left join sys_dict di on b.cancelReason = di.did  left join sys_dict di1 on di1.did = b.cancelType  left join sys_dict di4 on di4.did = b.bookingCycle  left join sys_dict di5 on di5.did = b.flowPath  left join com_sys_shop sh on sh.shopId=b.shopId  left join sys_dict di3 on pb.source=di3.did  left join sys_treedictcat tr on tr.catId=pb.channel  left join com_sys_shop_function_room ro on ro.roomId = b.specialRoom  left join(select group_concat(distinct concat( css.shopNo,'-',sr.rackName, '-', rs.storeyName ) SEPARATOR ',' ) AS place,sd.patientId  from com_his_patient_storage_detail sd  LEFT JOIN com_his_patient_storage_rack sr ON sr.rackId = sd.rackId LEFT JOIN com_his_patient_storage_rack_storey rs ON rs.storeyId = sd.storeyId  left join com_sys_shop css on css.shopId = sd.shopId  where sd.comId ='239e97340aa84454b4c4bb36bd7879ee' and sd.isDelete = 0 and sd.status = 7000 GROUP BY sd.patientId)sdd on sdd.patientId = b.patientId    where b.isDelete = 0 and b.shopId='85c94b66653b4495bf60fac3f770f7ea'  and b.status in (90,91,92,93,94,95) and ((1=1  and b.iBookingTime>=20210809000000 and b.iBookingTime <=20210815235959) or b.status=92)  order by b.status asc,b.bookingTime asc   limit 0, 15"
641,6061,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
642,6039,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
643,4235,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
644,4456,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
645,4255,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3e4c77141d8f45ddbbd1ebb6641e571a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3e4c77141d8f45ddbbd1ebb6641e571a' )) 
646,4383,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '6ed5e1e627c54951bf55f89da1beabb6' )) 
647,4334,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c13bbf031cc3491ba0051737ae4dcb00' )) 
648,4235,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
649,4456,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
650,4255,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '3e4c77141d8f45ddbbd1ebb6641e571a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '3e4c77141d8f45ddbbd1ebb6641e571a' )) 
651,4383,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '6ed5e1e627c54951bf55f89da1beabb6' )) 
652,4334,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c13bbf031cc3491ba0051737ae4dcb00' )) 
653,6126,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
654,6547,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
655,6547,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
656,6547,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
657,5899,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
658,5891,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
659,5899,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
660,5891,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
661,5489,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
662,5489,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
663,9382,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
664,6452,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
665,5159,select * from com_his_treat_diagnose_teeth where regId='7b1b0d63621d4c78be275004683e24bc'
666,5159,select * from com_his_treat_diagnose_teeth where regId='7b1b0d63621d4c78be275004683e24bc'
667,7341,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
668,7005,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
669,5917,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
670,7005,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
671,5917,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
672,5917,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
673,4482,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' and r.ifConsult = 0 
674,4136,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' and r.ifConsult = 0 
675,4482,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' and r.ifConsult = 0 
676,4136,select count(*) as count FROM com_his_charge_bill b LEFT JOIN com_his_treat_register r ON r.regId = b.currRegId where b. STATUS =220 AND (b.ifSettle=0 or (b.ifSettle=1 and b.currPay<>0)) AND r.isDelete = 0 AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'  AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea' AND b.billType <>202 AND b.currPricingEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' and r.ifConsult = 0 
677,6735,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
678,5886,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
679,5886,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
680,5970,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
681,6770,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
682,5970,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
683,6770,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
684,5970,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
685,5756,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '6ed5e1e627c54951bf55f89da1beabb6' )) 
686,7868,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
687,5775,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
688,5148,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c13bbf031cc3491ba0051737ae4dcb00' )) 
689,5041,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
690,5756,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '6ed5e1e627c54951bf55f89da1beabb6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '6ed5e1e627c54951bf55f89da1beabb6' )) 
691,7868,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
692,5775,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
693,5148,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'c13bbf031cc3491ba0051737ae4dcb00' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'c13bbf031cc3491ba0051737ae4dcb00' )) 
694,5041,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
695,4372,select 1  from com_his_treat_register r  left join sys_dict dt on r.appeal=dt.did  left join com_his_patient_base b on r.patientId=b.patientId  LEFT JOIN com_his_patient_other ot ON ot.patientId=b.patientId left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=r.shopId   left join com_his_case c on r.regId=c.regId    where r.currNode='500' and r.currNode=500 and (c.status=850 or c.status is null)  and r.shopId='02c8257d6164485eb52b20b1b078696e' and r.treatDoctorId='11b8df0e227c4d439a48a5d6700b0d5b'
696,4209,select 1  from com_his_treat_register r  left join sys_dict dt on r.appeal=dt.did  left join com_his_patient_base b on r.patientId=b.patientId  LEFT JOIN com_his_patient_other ot ON ot.patientId=b.patientId left join com_his_patient_shop s on b.patientId=s.patientId and s.shopId=r.shopId   inner join com_his_case c on r.regId=c.regId and c.courseStatus=0 and c.ifMainCase=1 and c.isDelete=0 and c.status<>852   where r.currNode='500' and r.currNode=500 and r.shopId='02c8257d6164485eb52b20b1b078696e' and r.treatDoctorId='11b8df0e227c4d439a48a5d6700b0d5b'
697,8127,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
698,5922,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
699,5922,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
700,5922,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
701,5971,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
702,5971,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
703,5865,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
704,5865,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
705,7421,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
706,4020,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
707,7421,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
708,4020,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
709,7421,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
710,4020,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
711,7421,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
712,4020,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
713,7421,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '02c8257d6164485eb52b20b1b078696e'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
714,4020,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
715,4020,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
716,4020,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
717,4035,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
718,4035,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
719,4654,"select * from sys_file where  find_in_set(fid,'df37e2e99a8141989fa3e42dd7412546,7b29fbb5905e4d27a4ff48a7ef8b0cd6,70a6ccd4fba145029c88b2b9e49ad151,9de92c36b7904e0a908d7039ee4b05ee,bedb131b7677490dab6109217c83677b,6abab91a7e5c487392a9243f9232e061,16255081413248d2b5c696416bc5655a,da67c4e3998b4b88aca8625a7e8122e0,d562eafab01a4e639428c16f8a890593,71e1ec3d8d9e42ffadf5710cd951474b,1c3401ac101646cf8a8464384d6b7749,39d6d5543b3949afa2900939e69f91c9,fa374bb5b8004c0e83ce54125cb3ed67,f6c5c1118c3a420c9b14c84d4c7ee39c,b41b4b1c3b574308aa34b54de2e24fde,4e491f3604a24c56a68a6e75d2095e79,f89d5a71f456439cbe148e2fa148cb95')"
720,4654,"select * from sys_file where  find_in_set(fid,'df37e2e99a8141989fa3e42dd7412546,7b29fbb5905e4d27a4ff48a7ef8b0cd6,70a6ccd4fba145029c88b2b9e49ad151,9de92c36b7904e0a908d7039ee4b05ee,bedb131b7677490dab6109217c83677b,6abab91a7e5c487392a9243f9232e061,16255081413248d2b5c696416bc5655a,da67c4e3998b4b88aca8625a7e8122e0,d562eafab01a4e639428c16f8a890593,71e1ec3d8d9e42ffadf5710cd951474b,1c3401ac101646cf8a8464384d6b7749,39d6d5543b3949afa2900939e69f91c9,fa374bb5b8004c0e83ce54125cb3ed67,f6c5c1118c3a420c9b14c84d4c7ee39c,b41b4b1c3b574308aa34b54de2e24fde,4e491f3604a24c56a68a6e75d2095e79,f89d5a71f456439cbe148e2fa148cb95')"
721,4654,"select * from sys_file where  find_in_set(fid,'df37e2e99a8141989fa3e42dd7412546,7b29fbb5905e4d27a4ff48a7ef8b0cd6,70a6ccd4fba145029c88b2b9e49ad151,9de92c36b7904e0a908d7039ee4b05ee,bedb131b7677490dab6109217c83677b,6abab91a7e5c487392a9243f9232e061,16255081413248d2b5c696416bc5655a,da67c4e3998b4b88aca8625a7e8122e0,d562eafab01a4e639428c16f8a890593,71e1ec3d8d9e42ffadf5710cd951474b,1c3401ac101646cf8a8464384d6b7749,39d6d5543b3949afa2900939e69f91c9,fa374bb5b8004c0e83ce54125cb3ed67,f6c5c1118c3a420c9b14c84d4c7ee39c,b41b4b1c3b574308aa34b54de2e24fde,4e491f3604a24c56a68a6e75d2095e79,f89d5a71f456439cbe148e2fa148cb95')"
722,4654,"select * from sys_file where  find_in_set(fid,'df37e2e99a8141989fa3e42dd7412546,7b29fbb5905e4d27a4ff48a7ef8b0cd6,70a6ccd4fba145029c88b2b9e49ad151,9de92c36b7904e0a908d7039ee4b05ee,bedb131b7677490dab6109217c83677b,6abab91a7e5c487392a9243f9232e061,16255081413248d2b5c696416bc5655a,da67c4e3998b4b88aca8625a7e8122e0,d562eafab01a4e639428c16f8a890593,71e1ec3d8d9e42ffadf5710cd951474b,1c3401ac101646cf8a8464384d6b7749,39d6d5543b3949afa2900939e69f91c9,fa374bb5b8004c0e83ce54125cb3ed67,f6c5c1118c3a420c9b14c84d4c7ee39c,b41b4b1c3b574308aa34b54de2e24fde,4e491f3604a24c56a68a6e75d2095e79,f89d5a71f456439cbe148e2fa148cb95')"
723,4654,"select * from sys_file where  find_in_set(fid,'df37e2e99a8141989fa3e42dd7412546,7b29fbb5905e4d27a4ff48a7ef8b0cd6,70a6ccd4fba145029c88b2b9e49ad151,9de92c36b7904e0a908d7039ee4b05ee,bedb131b7677490dab6109217c83677b,6abab91a7e5c487392a9243f9232e061,16255081413248d2b5c696416bc5655a,da67c4e3998b4b88aca8625a7e8122e0,d562eafab01a4e639428c16f8a890593,71e1ec3d8d9e42ffadf5710cd951474b,1c3401ac101646cf8a8464384d6b7749,39d6d5543b3949afa2900939e69f91c9,fa374bb5b8004c0e83ce54125cb3ed67,f6c5c1118c3a420c9b14c84d4c7ee39c,b41b4b1c3b574308aa34b54de2e24fde,4e491f3604a24c56a68a6e75d2095e79,f89d5a71f456439cbe148e2fa148cb95')"
724,4654,"select * from sys_file where  find_in_set(fid,'df37e2e99a8141989fa3e42dd7412546,7b29fbb5905e4d27a4ff48a7ef8b0cd6,70a6ccd4fba145029c88b2b9e49ad151,9de92c36b7904e0a908d7039ee4b05ee,bedb131b7677490dab6109217c83677b,6abab91a7e5c487392a9243f9232e061,16255081413248d2b5c696416bc5655a,da67c4e3998b4b88aca8625a7e8122e0,d562eafab01a4e639428c16f8a890593,71e1ec3d8d9e42ffadf5710cd951474b,1c3401ac101646cf8a8464384d6b7749,39d6d5543b3949afa2900939e69f91c9,fa374bb5b8004c0e83ce54125cb3ed67,f6c5c1118c3a420c9b14c84d4c7ee39c,b41b4b1c3b574308aa34b54de2e24fde,4e491f3604a24c56a68a6e75d2095e79,f89d5a71f456439cbe148e2fa148cb95')"
725,4111,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
726,7539,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
727,4072,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
728,4072,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
729,7331,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
730,6624,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
731,6624,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
732,7312,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
733,7312,"select   date,  weeks,  sum(num) as num,  sum(amount) as amount,  sum(settle) as settle,   sum(balance) as balance,  sum( fileCreateFee ) AS fileCreateFee, sum( salePrice ) AS salePrice,  sum(actAmount) AS actAmount, sum(regFee) as regFee from (  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,  0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill t   where t.shopId=? and t.comId=? and t.billType in (200,203) and  t.isDelete=0 and t.status<>239  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(s.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,   sum(pw.currPay) as settle, 0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle s   LEFT JOIN (SELECT SUM(if(systemFlag='Plan',0,money))currPay,settleId,operatingReceipt FROM com_his_charge_bill_settle_payway WHERE isDelete=0 GROUP BY settleId) pw ON pw.settleId=s.settleId   where s.shopId=? and s.comId=?  and s.iCreateTime>=20210804000000 and s.iCreateTime<=20210817235959 group by DATE_FORMAT(s.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),s.createTime)>=0 and DATEDIFF(date('2021-08-17'),s.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT   DATE_FORMAT( b.createTime, '%Y-%m-%d' ) AS date,   CASE    when DATEDIFF(date('2021-08-17'),b.createTime)>=0 and DATEDIFF(date('2021-08-17'),b.createTime)<=6 then 1    ELSE 0    END AS weeks,   sum(b.actualAmount) AS amount,   0 AS num,   0 AS settle,    sum(b.balance) as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee  FROM   com_his_charge_bill b   left join com_his_treat_register c on b.regId=c.regId   WHERE    b.shopId=? and b.comId=?  and b.ICreateTime>=20210804000000 and b.ICreateTime<=20210817235959 AND b.isDelete = 0    and b.hidden=0   and b.billType=200 and  b.ifSettle=1   GROUP BY   DATE_FORMAT( b.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date('2021-08-17'), b.createTime )>= 0    AND DATEDIFF( date( '2021-08-17'), b.createTime )<= 6 THEN   1 ELSE 0    END  UNION ALL   SELECT   date,weeks,   0 AS amount,   0 AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  SUM(if(systemFlag='Plan',0,money)) as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.businessIncome=1 group by a.settleId,pw.paywayId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL   SELECT   date,weeks,   0 AS amount,   sum(if(systemFlag='Plan',0,money)) AS num,   0 AS settle,   0 AS balance,   0 AS fileCreateFee,   0 AS salePrice ,  0 as actAmount, 0 as regFee from (select DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END AS weeks, pw.* from com_his_charge_bill_settle_items_payway a LEFT JOIN com_his_charge_bill_settle_payway pw ON pw.settleId=a.settleId  LEFT JOIN com_his_payway y ON y.paywayId = pw.paywayId left join com_his_charge_bill b on a.billId=b.billId WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and y.operatingReceipt=1 group by a.settleId,   DATE_FORMAT( a.createTime, '%Y-%m-%d' ),   CASE   WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0    AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN   1 ELSE 0    END ) a group by date UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_charge_bill_settle_payway b left join com_his_charge_bill_settle t on b.settleId=t.settleId   where b.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.regFee) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice,  0 AS actAmount, sum(t.regFee) as regFee from com_his_treat_register_fee t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee from com_his_prepay t   where t.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end   UNION ALL   SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  SUM( a.money ) AS num,  0 AS settle,  0 AS balance,  SUM( a.money ) AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount,  0 as regFee FROM  com_his_charge_bill_settle_items_payway a  LEFT JOIN com_his_charge_bill_items s ON a.billItemId = s.id  LEFT JOIN com_his_payway y ON y.paywayId = a.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 AND s.itemType = 18    and a.operatingReceipt=1  AND ( SELECT l.hidden FROM com_his_charge_bill l WHERE l.billId = s.billId )= 0   GROUP BY  a.paywayId,  DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  SELECT  DATE_FORMAT( a.createTime, '%Y-%m-%d' ) AS date,  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END AS weeks,  0 AS amount,  sum(a.money) AS num,  0 AS settle,  0 AS balance,  0 AS fileCreateFee,  sum( a.money ) AS salePrice,  0 AS actAmount, 0 as regFee FROM  com_his_preferential_programme_settle_apply a  INNER JOIN com_his_preferential_settle_payway b ON b.settleId = a.settleId  LEFT JOIN com_his_payway c ON c.paywayId = b.paywayId   WHERE   a.comId = '239e97340aa84454b4c4bb36bd7879ee'    AND a.shopId = '85c94b66653b4495bf60fac3f770f7ea'    AND a.isDelete = 0    AND a.iCreateTime >= 20210804000000 AND a.iCreateTime <= 20210817235959 and c.operatingReceipt=1  GROUP BY  b.Id,DATE_FORMAT( a.createTime, '%Y-%m-%d' ),  CASE    WHEN DATEDIFF( date( '2021-08-17' ), a.createTime )>= 0   AND DATEDIFF( date( '2021-08-17' ), a.createTime )<= 6 THEN  1 ELSE 0   END UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  sum(t.money) as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_storedvalue_payments t left join com_his_payway p on t.payway=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  UNION ALL  select DATE_FORMAT(t.createTime,'%Y-%m-%d') as date,  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end as weeks,  0 as amount,  0 as num,  0 as settle,   0 as balance, 0 AS fileCreateFee,  0 AS salePrice ,  0 AS actAmount, 0 as regFee from com_his_preferential_settle_payway t left join com_his_payway p on t.paywayId=p.paywayid  where p.operatingReceipt=1 and t.shopId=? and t.comId=? and t.isDelete=0  and t.ICreateTime>=20210804000000 and t.ICreateTime<=20210817235959 group by DATE_FORMAT(t.createTime,'%Y-%m-%d'),  case     when DATEDIFF(date('2021-08-17'),t.createTime)>=0 and DATEDIFF(date('2021-08-17'),t.createTime)<=6 then 1    else 0  end  ) t   group by date,weeks"
734,6150,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
735,6150,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
736,13434,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
737,11901,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
738,11901,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
739,6570,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
740,6887,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '5cda243c1d154f2a945edc968bc24f36' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '5cda243c1d154f2a945edc968bc24f36' )) 
741,6375,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
742,6169,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
743,6255,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
744,6048,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
745,6400,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
746,5579,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN sys_dict dt ON r.appeal = dt.did
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_employee e4 ON e4.employeeId = b.developerId
	LEFT JOIN sys_dict a ON b.source = a.did
	LEFT JOIN sys_treedictcat tr ON b.channel = tr.catId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_his_booking bo ON bo.registerId = r.regId
	INNER JOIN com_his_case c ON r.regId = c.regId
		AND c.courseStatus = 0
		AND c.isDelete = 0
	LEFT JOIN (SELECT COUNT(1) AS revisit, mainCaseId
		FROM com_his_case
		WHERE caseType <> 852
			AND ifMainCase = 0
			AND mainCaseId IS NOT NULL
			AND comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
		GROUP BY mainCaseId
		) c2 ON c2.mainCaseId = c.caseId
	LEFT JOIN com_his_case_casecat cc ON cc.caseId = c.caseId
	LEFT JOIN sys_treedictcat tr1 ON tr1.catId = cc.caseCat 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND r.treatDoctorId = '8dff5faa0f1e4babb409c0c5b9428b4f'
	AND c.ifMainCase = 1
	AND r.currNode = '500'
	AND (ifnull(c.status, 850) <> 852
		OR r.fillInCase = 1)"
747,6570,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'dba31f28e1904731a8682f38f09ba84e' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'dba31f28e1904731a8682f38f09ba84e' )) 
748,6887,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '5cda243c1d154f2a945edc968bc24f36' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '5cda243c1d154f2a945edc968bc24f36' )) 
749,6375,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'a0079de2b38c4092a43d0791bd0e29b3' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'a0079de2b38c4092a43d0791bd0e29b3' )) 
750,6169,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '4d48ecd4af0444359e4ee8cd5c7286e6' )) 
751,6255,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'e4255bec80b74fcca52b4e7e90e5ce3c' )) 
752,6048,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = '315a99bc26704386a7cfba60df3ea646' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = '315a99bc26704386a7cfba60df3ea646' )) 
753,6400,SELECT COUNT(*) FROM com_his_audit t  WHERE  t.comId = '239e97340aa84454b4c4bb36bd7879ee' AND t.isDelete = 0  AND t. STATUS =191 AND (t.auditEmployeeId = 'de98e97c7c794d5482489d8168ebf83a' OR EXISTS (SELECT 1 FROM com_his_audit_employees s WHERE s.auditId = t.auditId  AND s.employeeId = 'de98e97c7c794d5482489d8168ebf83a' )) 
754,13069,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex ,c2.revisit    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  inner join com_his_case c on r.regId=c.regId and c.courseStatus=0 and c.isDelete=0  left join( select COUNT(1) as revisit,mainCaseId from com_his_case where caseType<>852 and ifMainCase=0 and mainCaseId is not null and comId='239e97340aa84454b4c4bb36bd7879ee' and shopId='85c94b66653b4495bf60fac3f770f7ea'  GROUP BY mainCaseId) c2 on c2.mainCaseId=c.caseId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.treatDoctorId='8dff5faa0f1e4babb409c0c5b9428b4f' and c.ifMainCase=1 and r.currNode = '500'  and (ifnull(c.status,850)<>852 or r.fillInCase = 1) order by r.iRegTime desc  limit 0, 20"
755,6050,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
756,6168,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
757,6050,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
758,6168,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
759,6050,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
760,6168,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
761,6168,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
762,4129,"select * from sys_file where  find_in_set(fid,'449f32d08bad457eb9fd85a03d31c1d8,92759eea056b45ef881034ac681f09f9,dae23b1ca7bf4b6697ac8e7c8cfba3f4,1097d106f64e4259bb0fc7910718fb2a,e8bad10f78dd420c8792980e639142fa,7aab05a0eced49fa9e51d08028d4e301,4bfaeb97b1cf4629a5f7b84fb9406116,13134375512e44d690d59eef8b75a095,4a3eb2d1383d4cb5a80c86b77e426786,b2866fc12360449b8355e5842ea31a75,d93205958e214400986c24f65ea6ca21,e83ca2ecc86c475392885dbaa96bb6d3')"
763,4129,"select * from sys_file where  find_in_set(fid,'449f32d08bad457eb9fd85a03d31c1d8,92759eea056b45ef881034ac681f09f9,dae23b1ca7bf4b6697ac8e7c8cfba3f4,1097d106f64e4259bb0fc7910718fb2a,e8bad10f78dd420c8792980e639142fa,7aab05a0eced49fa9e51d08028d4e301,4bfaeb97b1cf4629a5f7b84fb9406116,13134375512e44d690d59eef8b75a095,4a3eb2d1383d4cb5a80c86b77e426786,b2866fc12360449b8355e5842ea31a75,d93205958e214400986c24f65ea6ca21,e83ca2ecc86c475392885dbaa96bb6d3')"
764,4129,"select * from sys_file where  find_in_set(fid,'449f32d08bad457eb9fd85a03d31c1d8,92759eea056b45ef881034ac681f09f9,dae23b1ca7bf4b6697ac8e7c8cfba3f4,1097d106f64e4259bb0fc7910718fb2a,e8bad10f78dd420c8792980e639142fa,7aab05a0eced49fa9e51d08028d4e301,4bfaeb97b1cf4629a5f7b84fb9406116,13134375512e44d690d59eef8b75a095,4a3eb2d1383d4cb5a80c86b77e426786,b2866fc12360449b8355e5842ea31a75,d93205958e214400986c24f65ea6ca21,e83ca2ecc86c475392885dbaa96bb6d3')"
765,7003,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
766,7003,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
767,5928,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
768,7003,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
769,5928,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
770,5913,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
771,5933,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
772,5913,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
773,5933,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
774,5913,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
775,4155,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210817000000
				AND b.iCreateTime <= 20210817235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210817000000
				AND b.iCreateTime <= 20210817235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210817000000
				AND b.iRegTime <= 20210817235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210817000000
		AND t.iRegTime <= 20210817235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210817000000
		AND t.iBookingTime <= 20210817235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210817000000
			AND s.iCreateTime <= 20210817235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210817000000
				AND b.iRegTime <= 20210817235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
776,4155,"select count(*)  
	from 
	(SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210817000000
				AND b.iCreateTime <= 20210817235959
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.iCreateTime >= 20210817000000
				AND b.iCreateTime <= 20210817235959
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM com_his_treat_register t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210817000000
				AND b.iRegTime <= 20210817235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.iRegTime >= 20210817000000
		AND t.iRegTime <= 20210817235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT t.temporary, t.important, t.bookingCheck, 0 AS ifTriage, 0 AS ifRegFree
		, 0 AS ifBill, 0 AS ifTreat, 0 AS ifConsult, 0 AS ifCharge, 0 AS ifCase
		, 0 AS ifBooking, 0 AS ifFollowUp, 0 AS ifFollow, 0 AS ifPrepay, 0 AS ifImage
		, 0 AS ifPhoto, 0 AS ifRecipe, 0 AS ifProcess, 0 AS ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, t.bookingId, t.bookingTime AS regTime, 0 AS ifAppoint, CASE WHEN t.status = 90 THEN 1063 ELSE t.status END AS treatStatus
		, t.treatType, t.bookingId AS regId, t.patientId, '' AS currNode, '' AS ifConsultAppoint
		, t.patientName, c.fileNo, c.searchCode, t.mobilePhone AS phone1, c.phone2
		, t.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, t.bookingItem AS appealName1, '' AS appealName, f.employeeName AS treatDoctorName
		, '' AS counselorDoctorName, g.dept AS treatDeptName, t.bookingDeptId AS treatDeptId, t.bookingDoctorId AS treatDoctorId, 0 AS finishType
		, 0 AS ifRecession, 0 AS waitingProcessing, '' AS nurse, '' AS nurseId, '' AS assistName
		, '' AS assistantId, 1 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, 0 AS observeTimes, g.deptId, 0 AS consult, c.source AS sourceId
		, 0 AS cureWaitMin, 0 AS regWaitMin, 0 AS recWaitMin
	FROM com_his_booking t
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.treatment = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f ON t.bookingDoctorId = f.employeeId
		LEFT JOIN (SELECT e.employeeName, e.employeeId
			FROM com_his_employee_config cg
				LEFT JOIN com_sys_employee e ON e.employeeId = cg.employeeId
			WHERE cg.consult = 1
				AND cg.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND cg.comId = '239e97340aa84454b4c4bb36bd7879ee'
			) f1 ON t.bookingDoctorId = f1.employeeId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN com_sys_dept g ON t.bookingDeptId = g.deptId
	WHERE t.`status` = 90
		AND t.iBookingTime >= 20210817000000
		AND t.iBookingTime <= 20210817235959
		AND t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
	UNION ALL
	SELECT 0 AS temporary, 0 AS important, 0 AS bookingCheck, 1 AS ifTriage, (
			SELECT IF(t1.regId <> '', 1, 0) AS dd
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType <> 18
				AND t1.itemType <> 17
				AND b.billType <> 202
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			) AS ifBill
		, IFNULL((
			SELECT CASE WHEN t1.itemType = 17 THEN 1 ELSE 0 END AS ifRegFree
			FROM com_his_charge_bill_items t1
				LEFT JOIN com_his_charge_bill b ON b.billId = t1.billId
			WHERE t1.regId = t.regId
				AND t1.isDelete = 0
				AND t1.itemType = 17
				AND t1.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t1.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			GROUP BY t1.regId
			), 0) AS ifRegFree, t.ifTreat, t.ifConsult, t.ifCharge, t.ifCase
		, t.ifBooking, t.ifFollowUp, (
			SELECT COUNT(batchId)
			FROM com_his_follow_batch
			WHERE correlationId = t.regId
			) AS ifFollow, t.ifPrepay, t.ifImage
		, t.ifPhoto, t.ifRecipe, t.ifProcess, t.ifAdvice, (
			SELECT COUNT(0)
			FROM com_his_charge_bill
			WHERE shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND STATUS <> 239
				AND (STATUS = 221
					OR currSettle <> 0
					OR currWorkload <> 0)
				AND isDelete = 0
				AND billType <> 202
				AND patientId = t.patientId
				AND STATUS = 221
			) AS ifArrearageBill
		, (
			SELECT COUNT(0)
			FROM com_his_prepay_apply
			WHERE settleStatus = 2340
				AND isDelete = 0
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND patientId = t.patientId
			) AS ifArrearagePrepay, '' AS bookingId, t.regTime, t.ifAppoint, CASE WHEN t.treatStatus = 1068
		AND t.finishType = 379 THEN 1069 WHEN t.treatStatus = 1068
		AND t.finishType = 362 THEN 1070 ELSE t.treatStatus END AS treatStatus
		, t.treatType, t.regId, t.patientId, t.currNode, t.ifConsultAppoint
		, c.patientName, c.fileNo, c.searchCode, c.phone1, c.phone2
		, c.sex, CASE WHEN ifnull(c.birthday, '') = '' THEN year(CURDATE()) - c.birthYear ELSE floor(DATEDIFF(CURDATE(), c.birthday) / 365) END AS age, hb.bookingItem AS appealName1, tr1.catName AS appealName, f.employeeName AS treatDoctorName
		, counse.employeeName AS counselorDoctorName, IFNULL(g.dept, g1.dept) AS treatDeptName, t.treatDeptId, t.treatDoctorId, t.finishType
		, if(t.finishType = 379, 1, 0) AS ifRecession, (
			SELECT COUNT(1)
			FROM com_his_processing
			WHERE regId = t.regId
				AND shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND status = 1080
			) AS waitingProcessing, f1.nurse, f1.nurseId, (
			SELECT GROUP_CONCAT(bb.employeename) AS assistName
			FROM com_his_treat_assistant aa
				LEFT JOIN com_sys_employee bb ON aa.assistantId = bb.employeeId
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistName
		, (
			SELECT GROUP_CONCAT(aa.assistantId) AS assistName
			FROM com_his_treat_assistant aa
			WHERE aa.regId = t.regId
				AND aa.assistantType = 380
				AND aa.isDelete = 0
			) AS assistantId, 0 AS type, o.black, (
			SELECT CASE WHEN SUM(cb.balance) > 0
				AND SUM(cb.balanceWorkload) > 0 THEN 1 WHEN SUM(cb.balance) > 0 THEN 2 WHEN SUM(cb.balanceWorkload) > 0 THEN 3 ELSE 0 END
			FROM com_his_charge_bill cb
			WHERE cb.billType <> 202
				AND cb.status <> 239
				AND cb.patientId = c.patientId
				AND cb.billType <> 202
				AND (cb.balance > 0
					OR cb.balanceWorkload > 0)
				AND cb.isDelete = 0
			) AS lack, ifnull(mem.memberStar, 0) AS memberStar
		, IFNULL(di.dict, sd.dict) AS source, t.observeTimes, g.deptId, (
			SELECT if(ISNULL(f.content), 0, 1)
			FROM com_his_consult c
				LEFT JOIN com_his_consult_items f ON c.consultId = f.consultId
					AND itemCod = 120
			WHERE c.regId = t.regId
			LIMIT 1
			) AS consult, c.source AS sourceId
		, CASE WHEN t.currNode = 400
		AND t.treatStatus = 1061 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 400
		AND t.treatStatus = 1062 THEN TIMESTAMPDIFF(MINUTE, t.consultBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1064 THEN TIMESTAMPDIFF(MINUTE, ifnull(t.consultEndTime, t.regTime), now()) WHEN t.currNode = 500
		AND t.treatStatus = 1065 THEN TIMESTAMPDIFF(MINUTE, t.treatBeginTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1067 THEN TIMESTAMPDIFF(MINUTE, t.treatEndTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType != 362 THEN t.treatDuration ELSE '' END AS cureWaitMin, CASE WHEN t.currNode = 500
		AND t.treatStatus = 1064
		AND t.consultEndTime IS NULL THEN TIMESTAMPDIFF(MINUTE, t.createTime, now()) ELSE 0 END AS regWaitMin, CASE WHEN t.currNode = 600
		AND t.treatStatus = 1060 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 600
		AND t.treatStatus = 1068 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) WHEN t.currNode = 500
		AND t.treatStatus = 1068
		AND t.finishType = 362 THEN TIMESTAMPDIFF(MINUTE, t.regTime, now()) ELSE 0 END AS recWaitMin
	FROM (SELECT s.currRegId
		FROM com_his_charge_bill_settle_items s
		WHERE s.comId = '239e97340aa84454b4c4bb36bd7879ee'
			AND s.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			AND s.isDelete = 0
			AND s.iCreateTime >= 20210817000000
			AND s.iCreateTime <= 20210817235959
			AND s.isReturn = 0
		GROUP BY s.currRegId
		) a
		LEFT JOIN com_his_treat_register t ON t.regId = a.currRegId
		LEFT JOIN com_his_patient_base c ON t.patientId = c.patientId
		LEFT JOIN com_his_patient_other o ON o.patientId = c.patientId
		LEFT JOIN com_his_patient_member mem ON t.patientId = mem.patientId
		LEFT JOIN com_his_patient_shop d ON t.patientId = d.patientId
			AND d.shopId = t.shopId
		LEFT JOIN com_sys_employee f ON t.treatDoctorId = f.employeeId
		LEFT JOIN com_sys_employee counse ON t.counselorId = counse.employeeId
			AND t.ifConsult = 1
		LEFT JOIN com_sys_dept g ON t.treatDeptId = g.deptId
		LEFT JOIN com_sys_dept g1 ON t.consultDeptId = g1.deptId
		LEFT JOIN com_his_booking hb ON hb.registerId = t.regId
		LEFT JOIN sys_treedictcat tr1 ON t.appeal = tr1.catId
		LEFT JOIN sys_dict di ON di.did = c.source
		LEFT JOIN com_his_temporary_patient p ON p.patientId = t.patientId
		LEFT JOIN sys_dict sd ON sd.did = p.source
		LEFT JOIN (SELECT t.regId, GROUP_CONCAT(d.employeeName) AS nurse, GROUP_CONCAT(d.employeeId) AS nurseId
			FROM com_his_treat_assistant t
				LEFT JOIN com_his_treat_register b ON t.regId = b.regId
				LEFT JOIN com_sys_employee d ON t.assistantId = d.employeeId
			WHERE b.iRegTime >= 20210817000000
				AND b.iRegTime <= 20210817235959
				AND b.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND b.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.isDelete = 0
				AND t.assistantType = 381
			GROUP BY t.regId
			) f1 ON t.regId = f1.regId
	WHERE t.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND t.comId = '239e97340aa84454b4c4bb36bd7879ee'
		AND TO_DAYS(t.regTime) != TO_DAYS(NOW())
	) t 
	where 
	1 = 1"
777,4617,"select count(*)  
	from 
	com_his_treat_register r
	LEFT JOIN com_his_booking book ON r.regId = book.registerId
	LEFT JOIN com_his_patient_base b ON r.patientId = b.patientId
	LEFT JOIN com_his_patient_member mem ON r.patientId = mem.patientId
	LEFT JOIN com_his_patient_shop s ON s.patientId = r.patientId
		AND s.shopId = r.shopId
	LEFT JOIN com_his_patient_other ot ON ot.patientId = r.patientId
	LEFT JOIN com_sys_employee e1 ON e1.employeeId = r.regEmployeeId
	LEFT JOIN com_sys_employee e2 ON e2.employeeId = r.counselorId
	LEFT JOIN com_sys_dept d2 ON d2.deptId = r.consultDeptId
	LEFT JOIN com_sys_employee e3 ON e3.employeeId = r.treatDoctorId
	LEFT JOIN com_sys_dept d3 ON d3.deptId = r.treatDeptId
	LEFT JOIN com_sys_employee e6 ON e6.employeeId = b.dutyDoctorId
	LEFT JOIN sys_dict di ON di.did = r.appeal
	LEFT JOIN sys_treedictcat tr1 ON r.appeal = tr1.catId
	LEFT JOIN sys_dict di2 ON di2.did = ot.category1
	LEFT JOIN sys_dict di3 ON di3.did = ot.category2
	LEFT JOIN sys_dict di5 ON di5.did = mem.memberLevel
	LEFT JOIN sys_dict di6 ON b.source = di6.did
	LEFT JOIN sys_dict d7 ON d7.did = r.AttendRelationship
	LEFT JOIN sys_treedictcat tree ON b.channel = tree.catId
	LEFT JOIN sys_dict di8 ON di8.did = r.noDealReason
	LEFT JOIN com_his_treat_transfer sf ON r.regId = sf.regId
		AND sf.status = 1001 
	where 
	r.comId = '239e97340aa84454b4c4bb36bd7879ee'
	AND r.shopId = '85c94b66653b4495bf60fac3f770f7ea'
	AND (b.patientName LIKE '%张璇%'
		OR b.searchCode LIKE '%张璇%'
		OR b.phone1 LIKE '%张璇%'
		OR e1.employeeName LIKE '%张璇%'
		OR e2.employeeName LIKE '%张璇%'
		OR e3.employeeName LIKE '%张璇%'
		OR d2.dept LIKE '%张璇%'
		OR d3.dept LIKE '%张璇%')
	AND r.iRegTime >= 20210101000000
	AND r.iRegTime <= 20211231235959"
778,19468,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
779,19468,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
780,18505,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
781,19468,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
782,18505,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
783,19468,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
784,18505,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
785,19468,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
786,18505,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
787,6273,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
788,4898," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='db6ed0b6b043496da39e4ff845acfaab' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
789,4898," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='db6ed0b6b043496da39e4ff845acfaab' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
790,4898," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='db6ed0b6b043496da39e4ff845acfaab' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
791,13108,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817172856 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817172856 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817172856 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210401000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
792,12465,"select r.*,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '1bec2b8488c14f33ad90cf25e39520d9' limit 1) as followUp,IF(IFNULL(r.cancelType,'')='',0,1) as cantype,case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,r.treatStatus as treatStatus2,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=500 and t.regId=r.regId and t.ifCurr=1 limit 1),999) as nodeStatus,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,e6.employeeName as dutyDoctorName,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1 ) as batch,b.fileNo, concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName, tr1.catName as appealName1, (SELECT foll.ifAbnormal  FROM com_his_follow_up foll where foll.patientId=r.patientId and foll.regId = (SELECT regId FROM com_his_treat_register rc  WHERE rc.patientId = r.patientId AND rc.iRegTime <r.iRegTime ORDER BY rc.iRegTime DESC  LIMIT 1 ) ORDER BY foll.iLastFollowUpTime desc LIMIT 1 ) AS ifAbnormal,  (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, ( SELECT GROUP_CONCAT(b1.employeeName SEPARATOR '/') AS assistName FROM com_his_treat_assistant a1  LEFT JOIN com_sys_employee b1 ON a1.assistantId = b1.employeeId WHERE a1.regId=r.regId  AND a1.isDelete = 0  AND a1.assistantType = 380 )  as helperDoctor, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName FROM  com_his_treat_assistant a LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 AND a.assistantType = 381 )  as helperNurse, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName FROM  com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 ) as staffName, di1.dict as memberLevelName, (select count(*) from com_his_patient_storage_detail sde where b.patientId= sde.patientId and sde.`status` <>7002 and sde.isDelete=0 )as goods,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,(select count(*) from com_his_charge_bill_settle_items x left join com_his_charge_bill_items y on x.billItemId=y.id  left join com_his_charge_bill z on x.billId=z.billId where   x.currRegId=r.regId and z.billType=200 and y.billItemType=260) as dealSettle,b.remark,case when tf.transferId is null then 0 else 1 end transfer,case when tto.transferId is null then 0 else 1 end transferTo,(SELECT sum(t.currPay) AS pay FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as pay,(SELECT SUM(t.currWorkload) workload  FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE  t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as workload,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.sex,ot.black, (select  ifnull(GROUP_CONCAT(booking.remark),'') from com_his_booking booking  where booking.isDelete=0 and booking.`status`=91  and DATE_FORMAT(booking.bookingTime,'%Y-%m-%d')=DATE_FORMAT(r.regTime,'%Y-%m-%d') and booking.patientId=r.patientId) as bookingRemark,(select ifnull(bk.extraBooking,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as  extraBooking,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,di.dict AS ificatione,di2.dict AS ificationt, (SELECT if(IFNULL(s.bypassId,'')<>'',1,0) from  com_his_treat_bypass s where s.regId=r.regId GROUP BY s.regId ) as isbypass    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId  left join com_his_booking book on r.regId=book.registerId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  LEFT JOIN sys_dict di ON di.did = ot.category1  LEFT JOIN sys_dict di2 ON di2.did = ot.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left outer join sys_dict a on b.source = a.did  left join sys_dict di1 on di1.did = mem.memberLevel  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=r.regId  left outer join (select * from com_his_treat_transfer_to_other GROUP BY regId) tto on tto.isDelete = 0 and tto.regId = r.regId left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and r.treatDoctorId='1bec2b8488c14f33ad90cf25e39520d9'  and ((1=1  and r.iRegTime>=20200331000000 and r.iRegTime <=20210817235959) or r.treatStatus=1064 or r.treatStatus=1065 or r.treatStatus=1061 or r.treatStatus=1062)  order by IF(IFNULL(r.cancelType,'')='',0,1) asc,r.currNode desc,r.treatStatus asc,r.iRegTime asc  limit 0, 100"
793,12465,"select r.*,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '1bec2b8488c14f33ad90cf25e39520d9' limit 1) as followUp,IF(IFNULL(r.cancelType,'')='',0,1) as cantype,case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,r.treatStatus as treatStatus2,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=500 and t.regId=r.regId and t.ifCurr=1 limit 1),999) as nodeStatus,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,e6.employeeName as dutyDoctorName,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1 ) as batch,b.fileNo, concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName, tr1.catName as appealName1, (SELECT foll.ifAbnormal  FROM com_his_follow_up foll where foll.patientId=r.patientId and foll.regId = (SELECT regId FROM com_his_treat_register rc  WHERE rc.patientId = r.patientId AND rc.iRegTime <r.iRegTime ORDER BY rc.iRegTime DESC  LIMIT 1 ) ORDER BY foll.iLastFollowUpTime desc LIMIT 1 ) AS ifAbnormal,  (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, ( SELECT GROUP_CONCAT(b1.employeeName SEPARATOR '/') AS assistName FROM com_his_treat_assistant a1  LEFT JOIN com_sys_employee b1 ON a1.assistantId = b1.employeeId WHERE a1.regId=r.regId  AND a1.isDelete = 0  AND a1.assistantType = 380 )  as helperDoctor, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName FROM  com_his_treat_assistant a LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 AND a.assistantType = 381 )  as helperNurse, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName FROM  com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 ) as staffName, di1.dict as memberLevelName, (select count(*) from com_his_patient_storage_detail sde where b.patientId= sde.patientId and sde.`status` <>7002 and sde.isDelete=0 )as goods,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,(select count(*) from com_his_charge_bill_settle_items x left join com_his_charge_bill_items y on x.billItemId=y.id  left join com_his_charge_bill z on x.billId=z.billId where   x.currRegId=r.regId and z.billType=200 and y.billItemType=260) as dealSettle,b.remark,case when tf.transferId is null then 0 else 1 end transfer,case when tto.transferId is null then 0 else 1 end transferTo,(SELECT sum(t.currPay) AS pay FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as pay,(SELECT SUM(t.currWorkload) workload  FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE  t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as workload,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.sex,ot.black, (select  ifnull(GROUP_CONCAT(booking.remark),'') from com_his_booking booking  where booking.isDelete=0 and booking.`status`=91  and DATE_FORMAT(booking.bookingTime,'%Y-%m-%d')=DATE_FORMAT(r.regTime,'%Y-%m-%d') and booking.patientId=r.patientId) as bookingRemark,(select ifnull(bk.extraBooking,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as  extraBooking,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,di.dict AS ificatione,di2.dict AS ificationt, (SELECT if(IFNULL(s.bypassId,'')<>'',1,0) from  com_his_treat_bypass s where s.regId=r.regId GROUP BY s.regId ) as isbypass    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId  left join com_his_booking book on r.regId=book.registerId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  LEFT JOIN sys_dict di ON di.did = ot.category1  LEFT JOIN sys_dict di2 ON di2.did = ot.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left outer join sys_dict a on b.source = a.did  left join sys_dict di1 on di1.did = mem.memberLevel  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=r.regId  left outer join (select * from com_his_treat_transfer_to_other GROUP BY regId) tto on tto.isDelete = 0 and tto.regId = r.regId left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and r.treatDoctorId='1bec2b8488c14f33ad90cf25e39520d9'  and ((1=1  and r.iRegTime>=20200331000000 and r.iRegTime <=20210817235959) or r.treatStatus=1064 or r.treatStatus=1065 or r.treatStatus=1061 or r.treatStatus=1062)  order by IF(IFNULL(r.cancelType,'')='',0,1) asc,r.currNode desc,r.treatStatus asc,r.iRegTime asc  limit 0, 100"
794,16432,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817173207 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817173207 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817173207 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='85c94b66653b4495bf60fac3f770f7ea'   and r.iRegTime>=20210304000000 and r.iRegTime <=20210817235959  AND ((r.counselorId = 'a0d30ac6a9ec4d35bb27adaaaa5a66a0'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210304000000 and r.iRegTime <=20210817235959 )))  or (b.dutyConsultId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210304000000 and r.iRegTime <=20210817235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='a0d30ac6a9ec4d35bb27adaaaa5a66a0' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 50"
795,4749,select * from com_his_treat_diagnose_teeth where regId='1c560f0965c446de9967a484b6be30f8'
796,4749,select * from com_his_treat_diagnose_teeth where regId='1c560f0965c446de9967a484b6be30f8'
797,11267,"select r.*,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '1bec2b8488c14f33ad90cf25e39520d9' limit 1) as followUp,IF(IFNULL(r.cancelType,'')='',0,1) as cantype,case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,r.treatStatus as treatStatus2,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=500 and t.regId=r.regId and t.ifCurr=1 limit 1),999) as nodeStatus,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,e6.employeeName as dutyDoctorName,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1 ) as batch,b.fileNo, concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName, tr1.catName as appealName1, (SELECT foll.ifAbnormal  FROM com_his_follow_up foll where foll.patientId=r.patientId and foll.regId = (SELECT regId FROM com_his_treat_register rc  WHERE rc.patientId = r.patientId AND rc.iRegTime <r.iRegTime ORDER BY rc.iRegTime DESC  LIMIT 1 ) ORDER BY foll.iLastFollowUpTime desc LIMIT 1 ) AS ifAbnormal,  (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, ( SELECT GROUP_CONCAT(b1.employeeName SEPARATOR '/') AS assistName FROM com_his_treat_assistant a1  LEFT JOIN com_sys_employee b1 ON a1.assistantId = b1.employeeId WHERE a1.regId=r.regId  AND a1.isDelete = 0  AND a1.assistantType = 380 )  as helperDoctor, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName FROM  com_his_treat_assistant a LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 AND a.assistantType = 381 )  as helperNurse, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName FROM  com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 ) as staffName, di1.dict as memberLevelName, (select count(*) from com_his_patient_storage_detail sde where b.patientId= sde.patientId and sde.`status` <>7002 and sde.isDelete=0 )as goods,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,(select count(*) from com_his_charge_bill_settle_items x left join com_his_charge_bill_items y on x.billItemId=y.id  left join com_his_charge_bill z on x.billId=z.billId where   x.currRegId=r.regId and z.billType=200 and y.billItemType=260) as dealSettle,b.remark,case when tf.transferId is null then 0 else 1 end transfer,case when tto.transferId is null then 0 else 1 end transferTo,(SELECT sum(t.currPay) AS pay FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as pay,(SELECT SUM(t.currWorkload) workload  FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE  t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as workload,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.sex,ot.black, (select  ifnull(GROUP_CONCAT(booking.remark),'') from com_his_booking booking  where booking.isDelete=0 and booking.`status`=91  and DATE_FORMAT(booking.bookingTime,'%Y-%m-%d')=DATE_FORMAT(r.regTime,'%Y-%m-%d') and booking.patientId=r.patientId) as bookingRemark,(select ifnull(bk.extraBooking,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as  extraBooking,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,di.dict AS ificatione,di2.dict AS ificationt, (SELECT if(IFNULL(s.bypassId,'')<>'',1,0) from  com_his_treat_bypass s where s.regId=r.regId GROUP BY s.regId ) as isbypass    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId  left join com_his_booking book on r.regId=book.registerId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  LEFT JOIN sys_dict di ON di.did = ot.category1  LEFT JOIN sys_dict di2 ON di2.did = ot.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left outer join sys_dict a on b.source = a.did  left join sys_dict di1 on di1.did = mem.memberLevel  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=r.regId  left outer join (select * from com_his_treat_transfer_to_other GROUP BY regId) tto on tto.isDelete = 0 and tto.regId = r.regId left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and r.treatDoctorId='1bec2b8488c14f33ad90cf25e39520d9'  and ((1=1  and r.iRegTime>=20200331000000 and r.iRegTime <=20210817235959) or r.treatStatus=1064 or r.treatStatus=1065 or r.treatStatus=1061 or r.treatStatus=1062)  order by IF(IFNULL(r.cancelType,'')='',0,1) asc,r.currNode desc,r.treatStatus asc,r.iRegTime asc  limit 0, 100"
798,7756,"select r.*,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '1bec2b8488c14f33ad90cf25e39520d9' limit 1) as followUp,IF(IFNULL(r.cancelType,'')='',0,1) as cantype,case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,r.treatStatus as treatStatus2,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=500 and t.regId=r.regId and t.ifCurr=1 limit 1),999) as nodeStatus,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,e6.employeeName as dutyDoctorName,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1 ) as batch,b.fileNo, concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName, tr1.catName as appealName1, (SELECT foll.ifAbnormal  FROM com_his_follow_up foll where foll.patientId=r.patientId and foll.regId = (SELECT regId FROM com_his_treat_register rc  WHERE rc.patientId = r.patientId AND rc.iRegTime <r.iRegTime ORDER BY rc.iRegTime DESC  LIMIT 1 ) ORDER BY foll.iLastFollowUpTime desc LIMIT 1 ) AS ifAbnormal,  (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, ( SELECT GROUP_CONCAT(b1.employeeName SEPARATOR '/') AS assistName FROM com_his_treat_assistant a1  LEFT JOIN com_sys_employee b1 ON a1.assistantId = b1.employeeId WHERE a1.regId=r.regId  AND a1.isDelete = 0  AND a1.assistantType = 380 )  as helperDoctor, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName FROM  com_his_treat_assistant a LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 AND a.assistantType = 381 )  as helperNurse, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName FROM  com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 ) as staffName, di1.dict as memberLevelName, (select count(*) from com_his_patient_storage_detail sde where b.patientId= sde.patientId and sde.`status` <>7002 and sde.isDelete=0 )as goods,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,(select count(*) from com_his_charge_bill_settle_items x left join com_his_charge_bill_items y on x.billItemId=y.id  left join com_his_charge_bill z on x.billId=z.billId where   x.currRegId=r.regId and z.billType=200 and y.billItemType=260) as dealSettle,b.remark,case when tf.transferId is null then 0 else 1 end transfer,case when tto.transferId is null then 0 else 1 end transferTo,(SELECT sum(t.currPay) AS pay FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as pay,(SELECT SUM(t.currWorkload) workload  FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE  t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as workload,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.sex,ot.black, (select  ifnull(GROUP_CONCAT(booking.remark),'') from com_his_booking booking  where booking.isDelete=0 and booking.`status`=91  and DATE_FORMAT(booking.bookingTime,'%Y-%m-%d')=DATE_FORMAT(r.regTime,'%Y-%m-%d') and booking.patientId=r.patientId) as bookingRemark,(select ifnull(bk.extraBooking,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as  extraBooking,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,di.dict AS ificatione,di2.dict AS ificationt, (SELECT if(IFNULL(s.bypassId,'')<>'',1,0) from  com_his_treat_bypass s where s.regId=r.regId GROUP BY s.regId ) as isbypass    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId  left join com_his_booking book on r.regId=book.registerId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  LEFT JOIN sys_dict di ON di.did = ot.category1  LEFT JOIN sys_dict di2 ON di2.did = ot.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left outer join sys_dict a on b.source = a.did  left join sys_dict di1 on di1.did = mem.memberLevel  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=r.regId  left outer join (select * from com_his_treat_transfer_to_other GROUP BY regId) tto on tto.isDelete = 0 and tto.regId = r.regId left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and r.treatDoctorId='1bec2b8488c14f33ad90cf25e39520d9'  and ((1=1  and r.iRegTime>=20200331000000 and r.iRegTime <=20210817235959) or r.treatStatus=1064 or r.treatStatus=1065 or r.treatStatus=1061 or r.treatStatus=1062)  order by IF(IFNULL(r.cancelType,'')='',0,1) asc,r.currNode desc,r.treatStatus asc,r.iRegTime asc  limit 0, 100"
799,7631,"select r.*,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '1bec2b8488c14f33ad90cf25e39520d9' limit 1) as followUp,IF(IFNULL(r.cancelType,'')='',0,1) as cantype,case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,r.treatStatus as treatStatus2,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=500 and t.regId=r.regId and t.ifCurr=1 limit 1),999) as nodeStatus,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,e6.employeeName as dutyDoctorName,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1 ) as batch,b.fileNo, concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName, tr1.catName as appealName1, (SELECT foll.ifAbnormal  FROM com_his_follow_up foll where foll.patientId=r.patientId and foll.regId = (SELECT regId FROM com_his_treat_register rc  WHERE rc.patientId = r.patientId AND rc.iRegTime <r.iRegTime ORDER BY rc.iRegTime DESC  LIMIT 1 ) ORDER BY foll.iLastFollowUpTime desc LIMIT 1 ) AS ifAbnormal,  (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, ( SELECT GROUP_CONCAT(b1.employeeName SEPARATOR '/') AS assistName FROM com_his_treat_assistant a1  LEFT JOIN com_sys_employee b1 ON a1.assistantId = b1.employeeId WHERE a1.regId=r.regId  AND a1.isDelete = 0  AND a1.assistantType = 380 )  as helperDoctor, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName FROM  com_his_treat_assistant a LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 AND a.assistantType = 381 )  as helperNurse, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName FROM  com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 ) as staffName, di1.dict as memberLevelName, (select count(*) from com_his_patient_storage_detail sde where b.patientId= sde.patientId and sde.`status` <>7002 and sde.isDelete=0 )as goods,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,(select count(*) from com_his_charge_bill_settle_items x left join com_his_charge_bill_items y on x.billItemId=y.id  left join com_his_charge_bill z on x.billId=z.billId where   x.currRegId=r.regId and z.billType=200 and y.billItemType=260) as dealSettle,b.remark,case when tf.transferId is null then 0 else 1 end transfer,case when tto.transferId is null then 0 else 1 end transferTo,(SELECT sum(t.currPay) AS pay FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as pay,(SELECT SUM(t.currWorkload) workload  FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE  t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as workload,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.sex,ot.black, (select  ifnull(GROUP_CONCAT(booking.remark),'') from com_his_booking booking  where booking.isDelete=0 and booking.`status`=91  and DATE_FORMAT(booking.bookingTime,'%Y-%m-%d')=DATE_FORMAT(r.regTime,'%Y-%m-%d') and booking.patientId=r.patientId) as bookingRemark,(select ifnull(bk.extraBooking,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as  extraBooking,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,di.dict AS ificatione,di2.dict AS ificationt, (SELECT if(IFNULL(s.bypassId,'')<>'',1,0) from  com_his_treat_bypass s where s.regId=r.regId GROUP BY s.regId ) as isbypass    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId  left join com_his_booking book on r.regId=book.registerId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  LEFT JOIN sys_dict di ON di.did = ot.category1  LEFT JOIN sys_dict di2 ON di2.did = ot.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left outer join sys_dict a on b.source = a.did  left join sys_dict di1 on di1.did = mem.memberLevel  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=r.regId  left outer join (select * from com_his_treat_transfer_to_other GROUP BY regId) tto on tto.isDelete = 0 and tto.regId = r.regId left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and r.treatDoctorId='1bec2b8488c14f33ad90cf25e39520d9'  and ((1=1  and r.iRegTime>=20200331000000 and r.iRegTime <=20210817235959) or r.treatStatus=1064 or r.treatStatus=1065 or r.treatStatus=1061 or r.treatStatus=1062)  order by IF(IFNULL(r.cancelType,'')='',0,1) asc,r.currNode desc,r.treatStatus asc,r.iRegTime asc  limit 0, 100"
800,7631,"select r.*,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '1bec2b8488c14f33ad90cf25e39520d9' limit 1) as followUp,IF(IFNULL(r.cancelType,'')='',0,1) as cantype,case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,r.treatStatus as treatStatus2,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=500 and t.regId=r.regId and t.ifCurr=1 limit 1),999) as nodeStatus,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,e6.employeeName as dutyDoctorName,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1 ) as batch,b.fileNo, concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName, tr1.catName as appealName1, (SELECT foll.ifAbnormal  FROM com_his_follow_up foll where foll.patientId=r.patientId and foll.regId = (SELECT regId FROM com_his_treat_register rc  WHERE rc.patientId = r.patientId AND rc.iRegTime <r.iRegTime ORDER BY rc.iRegTime DESC  LIMIT 1 ) ORDER BY foll.iLastFollowUpTime desc LIMIT 1 ) AS ifAbnormal,  (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, ( SELECT GROUP_CONCAT(b1.employeeName SEPARATOR '/') AS assistName FROM com_his_treat_assistant a1  LEFT JOIN com_sys_employee b1 ON a1.assistantId = b1.employeeId WHERE a1.regId=r.regId  AND a1.isDelete = 0  AND a1.assistantType = 380 )  as helperDoctor, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName FROM  com_his_treat_assistant a LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 AND a.assistantType = 381 )  as helperNurse, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName FROM  com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 ) as staffName, di1.dict as memberLevelName, (select count(*) from com_his_patient_storage_detail sde where b.patientId= sde.patientId and sde.`status` <>7002 and sde.isDelete=0 )as goods,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,(select count(*) from com_his_charge_bill_settle_items x left join com_his_charge_bill_items y on x.billItemId=y.id  left join com_his_charge_bill z on x.billId=z.billId where   x.currRegId=r.regId and z.billType=200 and y.billItemType=260) as dealSettle,b.remark,case when tf.transferId is null then 0 else 1 end transfer,case when tto.transferId is null then 0 else 1 end transferTo,(SELECT sum(t.currPay) AS pay FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as pay,(SELECT SUM(t.currWorkload) workload  FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE  t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as workload,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.sex,ot.black, (select  ifnull(GROUP_CONCAT(booking.remark),'') from com_his_booking booking  where booking.isDelete=0 and booking.`status`=91  and DATE_FORMAT(booking.bookingTime,'%Y-%m-%d')=DATE_FORMAT(r.regTime,'%Y-%m-%d') and booking.patientId=r.patientId) as bookingRemark,(select ifnull(bk.extraBooking,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as  extraBooking,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,di.dict AS ificatione,di2.dict AS ificationt, (SELECT if(IFNULL(s.bypassId,'')<>'',1,0) from  com_his_treat_bypass s where s.regId=r.regId GROUP BY s.regId ) as isbypass    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId  left join com_his_booking book on r.regId=book.registerId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  LEFT JOIN sys_dict di ON di.did = ot.category1  LEFT JOIN sys_dict di2 ON di2.did = ot.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left outer join sys_dict a on b.source = a.did  left join sys_dict di1 on di1.did = mem.memberLevel  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=r.regId  left outer join (select * from com_his_treat_transfer_to_other GROUP BY regId) tto on tto.isDelete = 0 and tto.regId = r.regId left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and r.treatDoctorId='1bec2b8488c14f33ad90cf25e39520d9'  and ((1=1  and r.iRegTime>=20200331000000 and r.iRegTime <=20210817235959) or r.treatStatus=1064 or r.treatStatus=1065 or r.treatStatus=1061 or r.treatStatus=1062)  order by IF(IFNULL(r.cancelType,'')='',0,1) asc,r.currNode desc,r.treatStatus asc,r.iRegTime asc  limit 0, 100"
801,7631,"select r.*,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '1bec2b8488c14f33ad90cf25e39520d9' limit 1) as followUp,IF(IFNULL(r.cancelType,'')='',0,1) as cantype,case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,r.treatStatus as treatStatus2,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=500 and t.regId=r.regId and t.ifCurr=1 limit 1),999) as nodeStatus,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,e6.employeeName as dutyDoctorName,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1 ) as batch,b.fileNo, concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName, tr1.catName as appealName1, (SELECT foll.ifAbnormal  FROM com_his_follow_up foll where foll.patientId=r.patientId and foll.regId = (SELECT regId FROM com_his_treat_register rc  WHERE rc.patientId = r.patientId AND rc.iRegTime <r.iRegTime ORDER BY rc.iRegTime DESC  LIMIT 1 ) ORDER BY foll.iLastFollowUpTime desc LIMIT 1 ) AS ifAbnormal,  (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, ( SELECT GROUP_CONCAT(b1.employeeName SEPARATOR '/') AS assistName FROM com_his_treat_assistant a1  LEFT JOIN com_sys_employee b1 ON a1.assistantId = b1.employeeId WHERE a1.regId=r.regId  AND a1.isDelete = 0  AND a1.assistantType = 380 )  as helperDoctor, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName FROM  com_his_treat_assistant a LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 AND a.assistantType = 381 )  as helperNurse, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName FROM  com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 ) as staffName, di1.dict as memberLevelName, (select count(*) from com_his_patient_storage_detail sde where b.patientId= sde.patientId and sde.`status` <>7002 and sde.isDelete=0 )as goods,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,(select count(*) from com_his_charge_bill_settle_items x left join com_his_charge_bill_items y on x.billItemId=y.id  left join com_his_charge_bill z on x.billId=z.billId where   x.currRegId=r.regId and z.billType=200 and y.billItemType=260) as dealSettle,b.remark,case when tf.transferId is null then 0 else 1 end transfer,case when tto.transferId is null then 0 else 1 end transferTo,(SELECT sum(t.currPay) AS pay FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as pay,(SELECT SUM(t.currWorkload) workload  FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE  t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as workload,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.sex,ot.black, (select  ifnull(GROUP_CONCAT(booking.remark),'') from com_his_booking booking  where booking.isDelete=0 and booking.`status`=91  and DATE_FORMAT(booking.bookingTime,'%Y-%m-%d')=DATE_FORMAT(r.regTime,'%Y-%m-%d') and booking.patientId=r.patientId) as bookingRemark,(select ifnull(bk.extraBooking,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as  extraBooking,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,di.dict AS ificatione,di2.dict AS ificationt, (SELECT if(IFNULL(s.bypassId,'')<>'',1,0) from  com_his_treat_bypass s where s.regId=r.regId GROUP BY s.regId ) as isbypass    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId  left join com_his_booking book on r.regId=book.registerId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  LEFT JOIN sys_dict di ON di.did = ot.category1  LEFT JOIN sys_dict di2 ON di2.did = ot.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left outer join sys_dict a on b.source = a.did  left join sys_dict di1 on di1.did = mem.memberLevel  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=r.regId  left outer join (select * from com_his_treat_transfer_to_other GROUP BY regId) tto on tto.isDelete = 0 and tto.regId = r.regId left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and r.treatDoctorId='1bec2b8488c14f33ad90cf25e39520d9'  and ((1=1  and r.iRegTime>=20200331000000 and r.iRegTime <=20210817235959) or r.treatStatus=1064 or r.treatStatus=1065 or r.treatStatus=1061 or r.treatStatus=1062)  order by IF(IFNULL(r.cancelType,'')='',0,1) asc,r.currNode desc,r.treatStatus asc,r.iRegTime asc  limit 0, 100"
802,7631,"select r.*,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '1bec2b8488c14f33ad90cf25e39520d9' limit 1) as followUp,IF(IFNULL(r.cancelType,'')='',0,1) as cantype,case when r.treatStatus=1068 and r.finishType=379 then 1069 
     when r.treatStatus=1068 and r.finishType=362 then 1070 
else r.treatStatus end as treatStatus1,r.treatStatus as treatStatus2,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=500 and t.regId=r.regId and t.ifCurr=1 limit 1),999) as nodeStatus,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,e6.employeeName as dutyDoctorName,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1 ) as batch,b.fileNo, concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName, tr1.catName as appealName1, (SELECT foll.ifAbnormal  FROM com_his_follow_up foll where foll.patientId=r.patientId and foll.regId = (SELECT regId FROM com_his_treat_register rc  WHERE rc.patientId = r.patientId AND rc.iRegTime <r.iRegTime ORDER BY rc.iRegTime DESC  LIMIT 1 ) ORDER BY foll.iLastFollowUpTime desc LIMIT 1 ) AS ifAbnormal,  (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2, d3.dept treatDeptName,e2.employeeName counselorName,e4.employeeName developerName,e5.employeeName as upperDoctorName, ( SELECT GROUP_CONCAT(b1.employeeName SEPARATOR '/') AS assistName FROM com_his_treat_assistant a1  LEFT JOIN com_sys_employee b1 ON a1.assistantId = b1.employeeId WHERE a1.regId=r.regId  AND a1.isDelete = 0  AND a1.assistantType = 380 )  as helperDoctor, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS nurseName FROM  com_his_treat_assistant a LEFT JOIN com_sys_employee b ON a.assistantId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 AND a.assistantType = 381 )  as helperNurse, (SELECT GROUP_CONCAT(b.employeeName SEPARATOR '/') AS consultaName FROM  com_his_treat_consultation_doctor a LEFT JOIN com_sys_employee b ON a.doctorId = b.employeeId  WHERE a.regId=r.regId AND a.isDelete = 0 ) as staffName, di1.dict as memberLevelName, (select count(*) from com_his_patient_storage_detail sde where b.patientId= sde.patientId and sde.`status` <>7002 and sde.isDelete=0 )as goods,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and  cb.regId=r.regId and cb.billType=200 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,(select count(*) from com_his_charge_bill_settle_items x left join com_his_charge_bill_items y on x.billItemId=y.id  left join com_his_charge_bill z on x.billId=z.billId where   x.currRegId=r.regId and z.billType=200 and y.billItemType=260) as dealSettle,b.remark,case when tf.transferId is null then 0 else 1 end transfer,case when tto.transferId is null then 0 else 1 end transferTo,(SELECT sum(t.currPay) AS pay FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as pay,(SELECT SUM(t.currWorkload) workload  FROM com_his_charge_settle_bill t LEFT OUTER JOIN com_his_charge_bill b ON t.billId = b.billId  WHERE  t.currRegId=r.regId and FIND_IN_SET(b.billType, '200,203') )  as workload,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin,book.bookingTime,book.bookingItem,TIMESTAMPDIFF(MINUTE,DATE_FORMAT(r.regTime , '%Y-%m-%d %H:%i'),book.endTime) as useTime,b.sex,ot.black, (select  ifnull(GROUP_CONCAT(booking.remark),'') from com_his_booking booking  where booking.isDelete=0 and booking.`status`=91  and DATE_FORMAT(booking.bookingTime,'%Y-%m-%d')=DATE_FORMAT(r.regTime,'%Y-%m-%d') and booking.patientId=r.patientId) as bookingRemark,(select ifnull(bk.extraBooking,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as  extraBooking,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,di.dict AS ificatione,di2.dict AS ificationt, (SELECT if(IFNULL(s.bypassId,'')<>'',1,0) from  com_his_treat_bypass s where s.regId=r.regId GROUP BY s.regId ) as isbypass    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId  left join com_his_booking book on r.regId=book.registerId left join com_his_patient_member mem on r.patientId=mem.patientId left join com_his_patient_shop s on s.patientId=r.patientId and s.shopId=r.shopId  left join com_his_patient_other ot on ot.patientId = r.patientId  LEFT JOIN sys_dict di ON di.did = ot.category1  LEFT JOIN sys_dict di2 ON di2.did = ot.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId=r.counselorId and r.ifConsult = 1  left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left join com_sys_employee e5 on e5.employeeId=r.upperDoctorId left join com_sys_employee e6 on e6.employeeId=b.dutyDoctorId left outer join sys_dict a on b.source = a.did  left join sys_dict di1 on di1.did = mem.memberLevel  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=r.regId  left outer join (select * from com_his_treat_transfer_to_other GROUP BY regId) tto on tto.isDelete = 0 and tto.regId = r.regId left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='85c94b66653b4495bf60fac3f770f7ea' and r.treatDoctorId='1bec2b8488c14f33ad90cf25e39520d9'  and ((1=1  and r.iRegTime>=20200331000000 and r.iRegTime <=20210817235959) or r.treatStatus=1064 or r.treatStatus=1065 or r.treatStatus=1061 or r.treatStatus=1062)  order by IF(IFNULL(r.cancelType,'')='',0,1) asc,r.currNode desc,r.treatStatus asc,r.iRegTime asc  limit 0, 100"
803,4344," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='85c94b66653b4495bf60fac3f770f7ea' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
804,5971,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
805,6081,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
806,6175,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
807,6175,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
808,6120,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 50"
809,5921,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
810,5921,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
811,5854,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
812,5921,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
813,5854,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
814,4185,"select r.*,bo.bookingTime,e2.employeeName counselorName,b.patientName, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,b.fileNo,c.caseId,ot.black,c.caseType,tr1.catNameFull as caseCat ,e3.employeeName treatDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,dt.dict as appealName,d3.dept treatDeptName,bo.bookingItem,bo.remark as bookingRemark,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and cb.balance>0 and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,b.lastDiagTime,case when r.treatStatus=1060 or r.treatStatus=1064 then (case when r.consultEndTime is null then  TIMESTAMPDIFF(MINUTE,r.regTime,now())  else  TIMESTAMPDIFF(MINUTE,r.consultEndTime,now())  end) else r.treatWaitDuration end as cureWaitMin,b.sex    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_patient_member mem on r.patientId=mem.patientId left join sys_dict dt on r.appeal=dt.did  left join com_sys_employee e2 on e2.employeeId=r.counselorId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId left outer join sys_dict a on b.source = a.did left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  LEFT JOIN com_his_patient_other ot ON ot.patientId=r.patientId left join com_his_booking bo on bo.registerId = r.regId  left join com_his_case c on r.regId=c.regId  LEFT JOIN com_his_case_casecat cc on cc.caseId = c.caseId  LEFT JOIN sys_treedictcat tr1 on tr1.catId = cc.caseCat    where r.comId='239e97340aa84454b4c4bb36bd7879ee' and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.treatDoctorId='11b8df0e227c4d439a48a5d6700b0d5b' and r.currNode=500 AND r.fillInCase = 0  and (c.status = 850 or c.status is null)  and not ifnull(c.caseType,0) in (824,825) and r.finishType ='361' and r.treatStatus ='1068'  order by r.iRegTime desc  limit 0, 100"
815,6016,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
816,6016,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
817,5853,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
818,6016,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
819,5853,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
820,6016,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
821,5853,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 100"
822,5929,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
823,6032,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='85c94b66653b4495bf60fac3f770f7ea'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='85c94b66653b4495bf60fac3f770f7ea' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
824,5929,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
825,7344,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '8b96940509c740fc8e06bd83c7f35d6d' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='8b96940509c740fc8e06bd83c7f35d6d' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817180012 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817180012 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817180012 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.iRegTime>=20210801000000 and r.iRegTime <=20210831235959  AND ((r.counselorId = '8b96940509c740fc8e06bd83c7f35d6d'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210801000000 and r.iRegTime <=20210831235959 )))  or (b.dutyConsultId='8b96940509c740fc8e06bd83c7f35d6d' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210801000000 and r.iRegTime <=20210831235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='8b96940509c740fc8e06bd83c7f35d6d' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 15"
826,7344,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '8b96940509c740fc8e06bd83c7f35d6d' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='8b96940509c740fc8e06bd83c7f35d6d' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817180012 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817180012 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817180012 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.iRegTime>=20210801000000 and r.iRegTime <=20210831235959  AND ((r.counselorId = '8b96940509c740fc8e06bd83c7f35d6d'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210801000000 and r.iRegTime <=20210831235959 )))  or (b.dutyConsultId='8b96940509c740fc8e06bd83c7f35d6d' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210801000000 and r.iRegTime <=20210831235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='8b96940509c740fc8e06bd83c7f35d6d' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 15"
827,7344,"select r.*, tr1.catName as appealName1,(select  sum( money ) from com_his_prepay where  patientId = r.patientId AND createTime >= str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ) AND createTime <= DATE_ADD( DATE_ADD( str_to_date( DATE_FORMAT( r.createTime, '%Y-%m-%d' ), '%Y-%m-%d %H:%i:%s' ), INTERVAL 1 DAY ), INTERVAL - 1 SECOND ) AND business IN (950 , 951)  ) AS moneyOf,(select 1 from com_his_follow_up fu where fu.regId = r.regId and fu.createEmployeeId = '8b96940509c740fc8e06bd83c7f35d6d' limit 1) as followUp,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else if(ifnull((SELECT preNode FROM com_his_treat_flow t WHERE t.currNode = 400 AND t.regId = r.regId ORDER BY t.flowTime DESC LIMIT 1),999)=999,999,r.treatStatus) end as treatStatus1,case when r.treatStatus=1068 and r.finishType=379 then 1069      when r.treatStatus=1068 and r.finishType=362 then 1070 else r.treatStatus end as treatStatus2,if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId WHERE t.currNode = 400 AND t.regId = r.regId and tr.counselorId='8b96940509c740fc8e06bd83c7f35d6d' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus) as treatStatus3,e2.employeeName counselorName,ifnull((select nodeStatus from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as nodeStatus,ifnull((select preNode from com_his_treat_flow t where t.currNode=400 and t.regId=r.regId order by t.flowTime desc limit 1),999) as preNode,b.patientName,ifnull(b.patientNameRemark,'') patientNameRemark,  case when ifnull(b.birthday,'')='' then year(r.regTime) -b.birthYear else floor(DATEDIFF(r.regTime,b.birthday)/365) end  as age,b.fileNo,cu.black,(select fb.batchId from com_his_follow_batch fb where fb.correlationId = r.regId limit 1) as batch,d2.dept consultDeptName,e3.employeeName treatDoctorName,e5.employeeName lastDiagDoctorName,case when LOCATE('正畸', dt.dict)=0 then '' else '畸' end as orthodontic,case when LOCATE('修复', dt.dict)=0 then '' else '修' end as repair,case when LOCATE('种植', dt.dict)=0 then '' else '植' end as plant,case when LOCATE('正畸', tr1.catName)=0 then '' else '畸' end as orthodontic1,case when LOCATE('修复', tr1.catName)=0 then '' else '修' end as repair1,case when LOCATE('种植', tr1.catName)=0 then '' else '植' end as plant1,dt.dict as appealName,d3.dept treatDeptName,di1.dict as memberLevelName,di2.dict as noDealType,ifNull(di3.dict,r.noDealReason)noDealReason,e4.employeeName developerName,(select count(*) from com_his_charge_bill cb where  cb.patientId=r.patientId and  cb.regId=r.regId and cb.ifSettle=1 and cb.billType<>203 ) as noCheckBillCounts,(select count(*) from com_his_charge_bill cb where cb.ifSettle=1 and cb.patientId=r.patientId and cb.regId=r.regId and cb.billType=201 ) as deal,(select case when sum(cb.balance)>0 and sum(cb.balanceWorkload)>0 then 1   when sum(cb.balance)>0 then 2   when sum(cb.balanceWorkload)>0 then 3   else 0 end from com_his_charge_bill cb where cb.ifSettle=1 and  cb.billType<>202 and cb.status<>239 and cb.patientId=b.patientId and cb.billType<>202 and (cb.balance>0 or cb.balanceWorkload>0) and cb.isDelete=0) as lack,ifnull(mem.memberStar,0) as memberStar,a.dict as sourceName,tr.catNameFull as channelName,b.remark,cu.black,case when r.currNode=400 and r.treatStatus=1061 then  TIMESTAMPDIFF(MINUTE,r.regTime,now())      when r.currNode=400 and r.treatStatus=1062 then  TIMESTAMPDIFF(MINUTE,r.consultBeginTime,now())      when r.currNode=400 and r.treatStatus=1068 then r.consultDuration      when r.currNode=500 and r.treatStatus=1064 then  TIMESTAMPDIFF(MINUTE,ifnull(r.consultEndTime,r.regTime),now())      when r.currNode=500 and r.treatStatus=1065 then  TIMESTAMPDIFF(MINUTE,r.treatBeginTime,now())      when r.currNode=500 and r.treatStatus=1067 then  TIMESTAMPDIFF(MINUTE,r.treatEndTime,now())      when r.currNode=500 and r.treatStatus=1068 then r.treatDuration      else '' end as cureWaitMin, ifnull( (SELECT  sum( b.currPay - b.currPayed ) AS pay FROM com_his_charge_settle_bill b  WHERE isDelete = 0 and b.currRegId=r.regId), 0 ) AS pay,b.sex,book.bookingItem,e6.employeeName as toDoctorName,e7.employeeName as dutyConsultName,de1.dept as toDeptName,case when tf.transferId is null then 0 else 1 end transfer,sh.shopName, (select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a2 LEFT JOIN sys_dict b on b.did=a2.dictId where a2.patientId=r.patientId  and  a2.isDelete='0' and a2.InfoType=9) as PATIENT_TAG2,cy.dict AS ificatione,cg.dict AS ificationt,(SELECT GROUP_CONCAT( coi.content ) from com_his_consult_items coi LEFT JOIN com_his_consult co ON coi.consultId = co.consultId where co.regId = r.regId  AND coi.itemCod = 120 ) as content,(select ifnull(bk.important,0) from com_his_booking bk where bk.registerId=r.regId GROUP BY bk.registerId) as important,(select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=10 and c.regId=r.regId ) as chiefComplaint, (select ci.content from com_his_consult c   left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=110 and c.regId=r.regId ) as potentialDemand,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=130 and c.regId=r.regId ) as serviceSuggestions,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=0 and c.regId=r.regId ) as consultationNotes,(select ci.content from com_his_consult c  left join com_his_consult_items ci on ci.consultId=c.consultId where c.isDelete=0 and ci.isDelete=0 and ci.itemCod=2200 and c.regId=r.regId ) as consultationResults,(select if(ifnull(c.selectedScheme,'')='',c.notSchemeReason,c.selectedScheme) from com_his_case c where  c.regId=r.regId and c.isDelete=0 and c.status<>852 ) as options, (select  bk.bookingTime from com_his_booking bk where bk.patientId=r.patientId and bk.iBookingTime>=20210817180012 and bk.isDelete=0 order by bk.iBookingTime asc limit 1 ) as bookingTime, (select fu.schemeTime from com_his_follow_up fu where fu.patientId=r.patientId and fu.iSchemeTime>=20210817180012 and fu.isDelete=0 order by fu.iSchemeTime asc limit 1 ) as schemeTime, (select fb.nextFollowTime from com_his_follow_batch fb LEFT JOIN com_his_case c ON fb.correlationId = c.caseId LEFT JOIN com_his_treat_register rd ON rd.regId = c.regId LEFT JOIN com_his_consult d ON fb.correlationId = d.consultId AND fb.followType = 1020 LEFT JOIN com_his_treat_register r2 ON r2.regId = d.regId LEFT JOIN com_his_treat_register re ON re.regId = fb.correlationId AND fb.followType = 1022 where (rd.patientId=r.patientId or re.patientId=r.patientId or r2.patientId=r.patientId ) and  fb.iNextFollowTime>=20210817180012 and fb.isDelete=0 order by fb.iNextFollowTime asc limit 1 ) as nextFollowTime    from com_his_treat_register r left join com_his_patient_base b on r.patientId=b.patientId left join com_his_booking book on r.regId=book.registerId  left join com_his_patient_member mem on r.patientId=mem.patientId  left join com_his_patient_other cu on r.patientId=cu.patientId  LEFT JOIN sys_dict cy ON cy.did = cu.category1  LEFT JOIN sys_dict cg ON cg.did = cu.category2  left join sys_dict dt on r.appeal=dt.did  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di2 on r.noDealType=di2.did  left join sys_dict di3 on r.noDealReason=di3.did  left join sys_treedictcat tr1 on r.appeal=tr1.catId  left join com_sys_employee e2 on e2.employeeId = IF(IFNULL(r.counselorId,'')='',b.dutyConsultId,r.counselorId) left join com_sys_dept d2 on d2.deptId=r.consultDeptId left join com_sys_employee e3 on e3.employeeId=r.treatDoctorId  left join com_sys_employee e4 on e4.employeeId=b.developerId  left join com_sys_employee e5 on e5.employeeId=b.lastDiagDoctorId  left join com_sys_employee e7 on e7.employeeId = b.dutyConsultId  left outer join sys_dict a on b.source = a.did  left outer join sys_treedictcat tr on b.channel=tr.catId  left join com_sys_shop sh on r.shopId=sh.shopId  left join com_sys_dept d3 on d3.deptId=r.treatDeptId  left join com_his_treat_transfer tran on tran.regId = r.regId  left join com_sys_employee e6 on e6.employeeId=tran.toDoctorId  left join com_sys_dept de1 on de1.deptId=tran.toDeptId  left outer join (SELECT * from com_his_treat_transfer GROUP BY regId) tf on tf.isDelete=0 and tf.regId=tran.regId    where r.comId='239e97340aa84454b4c4bb36bd7879ee'  and r.shopId='02c8257d6164485eb52b20b1b078696e'   and r.iRegTime>=20210801000000 and r.iRegTime <=20210831235959  AND ((r.counselorId = '8b96940509c740fc8e06bd83c7f35d6d'  AND (r.treatStatus = 1061 OR r.treatStatus = 1062 OR (1 = 1  and r.iRegTime>=20210801000000 and r.iRegTime <=20210831235959 )))  or (b.dutyConsultId='8b96940509c740fc8e06bd83c7f35d6d' and r.treatStatus in (1061,1062,1064,1065,1067,1068,1069,1070)  and r.iRegTime>=20210801000000 and r.iRegTime <=20210831235959))  order by (if(ifnull((SELECT t.preNode FROM com_his_treat_flow t LEFT JOIN com_his_treat_register tr on tr.regId=t.regId  WHERE t.currNode = 400 AND t.regId = r.regId and  tr.counselorId='8b96940509c740fc8e06bd83c7f35d6d' ORDER BY t.flowTime DESC LIMIT 1),9999)=9999,9999,r.treatStatus))  ASC,r.iRegTime asc,d2.dept DESC  limit 0, 15"
828,9714,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
829,4117,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
830,9714,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
831,4117,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
832,9714,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
833,4117,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
834,4117,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
835,4858,"select * from sys_file where  find_in_set(fid,'9a12442d08354729a37e0222ddef5922,4b48c3cfc9f844d898684c6e4cbd2ead,c3ee4ab08305459d8d6ee4f82fe37e76,9a6794bfca9746a4a0f4d7e8fccca5d9,0a1b5435a0ae43928634be898d69e67d,271fbe0c3eae451a8ddba35ec2645a9b,ddd85e4e920f40f99a9bf7859d0ae456,7580673868e045a69be2989530549f5e,7d45c1804a7b4a6b8161bef9ffa88982,105c9fc6ad834bf7b0a942e29045785b,5638521165ab4111be3082c5273c4d1b,b19093fec77d40aa870e6c3ec515c32c,928a939998ee41f5824dd38187e903be,5a67396611154b91b6a50d167a4bb23c,59662893e2a64be2b1a66bf7deca89c2,1bcd12e0ee3e4ace94300b19d64f0597,4c468c7f4a6f4a318673664549514776,9f0a62783f7a4cef8e02c46f1da50d59,991f0665d51e49109dfc1de63f17c858,e082865990f347e284157e51e248d3a9,f3deb0d99d9e415698c385a42bab4a7e,9766f6f4156641859ed38fcdbcffd3c1,bf642b3e263d46328d740f9f415ebbba,492aca99a7fa4804995644249574c1b6,4fa3b22b10b94f2cbc075f8ab81561b1,b400a7cb12ac4f9cb47a1819f5f7a5d2,b81acc8bd9574af28cd00dfcb1917a05')"
836,4858,"select * from sys_file where  find_in_set(fid,'9a12442d08354729a37e0222ddef5922,4b48c3cfc9f844d898684c6e4cbd2ead,c3ee4ab08305459d8d6ee4f82fe37e76,9a6794bfca9746a4a0f4d7e8fccca5d9,0a1b5435a0ae43928634be898d69e67d,271fbe0c3eae451a8ddba35ec2645a9b,ddd85e4e920f40f99a9bf7859d0ae456,7580673868e045a69be2989530549f5e,7d45c1804a7b4a6b8161bef9ffa88982,105c9fc6ad834bf7b0a942e29045785b,5638521165ab4111be3082c5273c4d1b,b19093fec77d40aa870e6c3ec515c32c,928a939998ee41f5824dd38187e903be,5a67396611154b91b6a50d167a4bb23c,59662893e2a64be2b1a66bf7deca89c2,1bcd12e0ee3e4ace94300b19d64f0597,4c468c7f4a6f4a318673664549514776,9f0a62783f7a4cef8e02c46f1da50d59,991f0665d51e49109dfc1de63f17c858,e082865990f347e284157e51e248d3a9,f3deb0d99d9e415698c385a42bab4a7e,9766f6f4156641859ed38fcdbcffd3c1,bf642b3e263d46328d740f9f415ebbba,492aca99a7fa4804995644249574c1b6,4fa3b22b10b94f2cbc075f8ab81561b1,b400a7cb12ac4f9cb47a1819f5f7a5d2,b81acc8bd9574af28cd00dfcb1917a05')"
837,4858,"select * from sys_file where  find_in_set(fid,'9a12442d08354729a37e0222ddef5922,4b48c3cfc9f844d898684c6e4cbd2ead,c3ee4ab08305459d8d6ee4f82fe37e76,9a6794bfca9746a4a0f4d7e8fccca5d9,0a1b5435a0ae43928634be898d69e67d,271fbe0c3eae451a8ddba35ec2645a9b,ddd85e4e920f40f99a9bf7859d0ae456,7580673868e045a69be2989530549f5e,7d45c1804a7b4a6b8161bef9ffa88982,105c9fc6ad834bf7b0a942e29045785b,5638521165ab4111be3082c5273c4d1b,b19093fec77d40aa870e6c3ec515c32c,928a939998ee41f5824dd38187e903be,5a67396611154b91b6a50d167a4bb23c,59662893e2a64be2b1a66bf7deca89c2,1bcd12e0ee3e4ace94300b19d64f0597,4c468c7f4a6f4a318673664549514776,9f0a62783f7a4cef8e02c46f1da50d59,991f0665d51e49109dfc1de63f17c858,e082865990f347e284157e51e248d3a9,f3deb0d99d9e415698c385a42bab4a7e,9766f6f4156641859ed38fcdbcffd3c1,bf642b3e263d46328d740f9f415ebbba,492aca99a7fa4804995644249574c1b6,4fa3b22b10b94f2cbc075f8ab81561b1,b400a7cb12ac4f9cb47a1819f5f7a5d2,b81acc8bd9574af28cd00dfcb1917a05')"
838,4858,"select * from sys_file where  find_in_set(fid,'9a12442d08354729a37e0222ddef5922,4b48c3cfc9f844d898684c6e4cbd2ead,c3ee4ab08305459d8d6ee4f82fe37e76,9a6794bfca9746a4a0f4d7e8fccca5d9,0a1b5435a0ae43928634be898d69e67d,271fbe0c3eae451a8ddba35ec2645a9b,ddd85e4e920f40f99a9bf7859d0ae456,7580673868e045a69be2989530549f5e,7d45c1804a7b4a6b8161bef9ffa88982,105c9fc6ad834bf7b0a942e29045785b,5638521165ab4111be3082c5273c4d1b,b19093fec77d40aa870e6c3ec515c32c,928a939998ee41f5824dd38187e903be,5a67396611154b91b6a50d167a4bb23c,59662893e2a64be2b1a66bf7deca89c2,1bcd12e0ee3e4ace94300b19d64f0597,4c468c7f4a6f4a318673664549514776,9f0a62783f7a4cef8e02c46f1da50d59,991f0665d51e49109dfc1de63f17c858,e082865990f347e284157e51e248d3a9,f3deb0d99d9e415698c385a42bab4a7e,9766f6f4156641859ed38fcdbcffd3c1,bf642b3e263d46328d740f9f415ebbba,492aca99a7fa4804995644249574c1b6,4fa3b22b10b94f2cbc075f8ab81561b1,b400a7cb12ac4f9cb47a1819f5f7a5d2,b81acc8bd9574af28cd00dfcb1917a05')"
839,4858,"select * from sys_file where  find_in_set(fid,'9a12442d08354729a37e0222ddef5922,4b48c3cfc9f844d898684c6e4cbd2ead,c3ee4ab08305459d8d6ee4f82fe37e76,9a6794bfca9746a4a0f4d7e8fccca5d9,0a1b5435a0ae43928634be898d69e67d,271fbe0c3eae451a8ddba35ec2645a9b,ddd85e4e920f40f99a9bf7859d0ae456,7580673868e045a69be2989530549f5e,7d45c1804a7b4a6b8161bef9ffa88982,105c9fc6ad834bf7b0a942e29045785b,5638521165ab4111be3082c5273c4d1b,b19093fec77d40aa870e6c3ec515c32c,928a939998ee41f5824dd38187e903be,5a67396611154b91b6a50d167a4bb23c,59662893e2a64be2b1a66bf7deca89c2,1bcd12e0ee3e4ace94300b19d64f0597,4c468c7f4a6f4a318673664549514776,9f0a62783f7a4cef8e02c46f1da50d59,991f0665d51e49109dfc1de63f17c858,e082865990f347e284157e51e248d3a9,f3deb0d99d9e415698c385a42bab4a7e,9766f6f4156641859ed38fcdbcffd3c1,bf642b3e263d46328d740f9f415ebbba,492aca99a7fa4804995644249574c1b6,4fa3b22b10b94f2cbc075f8ab81561b1,b400a7cb12ac4f9cb47a1819f5f7a5d2,b81acc8bd9574af28cd00dfcb1917a05')"
840,9047,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
841,9047,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
842,4303,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
843,4303,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
844,4303,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
845,4303,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
846,4458,"select pb.*,b.bookingItem,b.bookingTime,b.bookingId,di.dict as source,case b.treatType when 340 then '首诊' when 341 then '再诊' else '复诊' end treatTypeName,e.employeeName as doctor,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(CURDATE()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end,case when ifnull(pb.birthday,'')='' then year(CURDATE()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age  from com_his_booking b LEFT JOIN com_sys_employee e on b.bookingDoctorId=e.employeeId left join com_his_patient_base pb on pb.patientId=b.patientId left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join sys_dict di on di.did=pb.source left join (select f.patientId,f.regId,f.bookingId as bookingId1 from com_his_treat_form f where f.formCod = 2638 and f.isDelete = 0 and f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'  and f.comId = '239e97340aa84454b4c4bb36bd7879ee' and f.iCreateTime >=20210817000000 and f.iCreateTime <=20210817235959)bb  on  b.patientId = bb.patientId and  (bb.regId=b.registerId or IFNULL(bb.regId,'')='')  where b.treatType<>340 and bb.bookingId1 is null and b.isDelete = 0 and b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='db6ed0b6b043496da39e4ff845acfaab' and  b.status=90 and b.iBookingTime>=20210817000000 and b.iBookingTime<=20210817235959  order by b.bookingTime asc "
847,4019," select count(*) from com_his_temporary_patient tp left join (select GROUP_CONCAT(bookingItem) as bookingItem ,patientId from com_his_booking where shopId='db6ed0b6b043496da39e4ff845acfaab' and isDelete=0   and iBookingTime>=20210817000000 and  iBookingTime <=20210817235959 GROUP BY patientId  ) b on b.patientId=tp.patientId   left join com_his_patient_shop s on tp.patientId=s.patientId and s.shopId=tp.shopId  left join com_his_patient_base pb on tp.patientId=pb.patientId  left join com_his_patient_info_gather ga on ga.patientId=tp.patientId  where tp.isDelete = 0  and tp.comId='239e97340aa84454b4c4bb36bd7879ee' and pb.patientId is null and ga.gatherId is null "
848,4458,"select pb.*,b.bookingItem,b.bookingTime,b.bookingId,di.dict as source,case b.treatType when 340 then '首诊' when 341 then '再诊' else '复诊' end treatTypeName,e.employeeName as doctor,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(CURDATE()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end,case when ifnull(pb.birthday,'')='' then year(CURDATE()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age  from com_his_booking b LEFT JOIN com_sys_employee e on b.bookingDoctorId=e.employeeId left join com_his_patient_base pb on pb.patientId=b.patientId left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join sys_dict di on di.did=pb.source left join (select f.patientId,f.regId,f.bookingId as bookingId1 from com_his_treat_form f where f.formCod = 2638 and f.isDelete = 0 and f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'  and f.comId = '239e97340aa84454b4c4bb36bd7879ee' and f.iCreateTime >=20210817000000 and f.iCreateTime <=20210817235959)bb  on  b.patientId = bb.patientId and  (bb.regId=b.registerId or IFNULL(bb.regId,'')='')  where b.treatType<>340 and bb.bookingId1 is null and b.isDelete = 0 and b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='db6ed0b6b043496da39e4ff845acfaab' and  b.status=90 and b.iBookingTime>=20210817000000 and b.iBookingTime<=20210817235959  order by b.bookingTime asc "
849,4458,"select pb.*,b.bookingItem,b.bookingTime,b.bookingId,di.dict as source,case b.treatType when 340 then '首诊' when 341 then '再诊' else '复诊' end treatTypeName,e.employeeName as doctor,if(IFNULL(pb.birthYear,1)=1,case when ifnull(tp.birthday,'')='' then year(CURDATE()) -tp.birthYear else floor(DATEDIFF(CURDATE(),tp.birthday)/365) end,case when ifnull(pb.birthday,'')='' then year(CURDATE()) -pb.birthYear else floor(DATEDIFF(CURDATE(),pb.birthday)/365) end) as age  from com_his_booking b LEFT JOIN com_sys_employee e on b.bookingDoctorId=e.employeeId left join com_his_patient_base pb on pb.patientId=b.patientId left join com_his_temporary_patient tp on tp.patientId=b.patientId  left join sys_dict di on di.did=pb.source left join (select f.patientId,f.regId,f.bookingId as bookingId1 from com_his_treat_form f where f.formCod = 2638 and f.isDelete = 0 and f.shopId = 'db6ed0b6b043496da39e4ff845acfaab'  and f.comId = '239e97340aa84454b4c4bb36bd7879ee' and f.iCreateTime >=20210817000000 and f.iCreateTime <=20210817235959)bb  on  b.patientId = bb.patientId and  (bb.regId=b.registerId or IFNULL(bb.regId,'')='')  where b.treatType<>340 and bb.bookingId1 is null and b.isDelete = 0 and b.comId='239e97340aa84454b4c4bb36bd7879ee' and b.shopId='db6ed0b6b043496da39e4ff845acfaab' and  b.status=90 and b.iBookingTime>=20210817000000 and b.iBookingTime<=20210817235959  order by b.bookingTime asc "
850,4771,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
851,4771,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
852,4040,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
853,4771,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
854,4040,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
855,4771,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
856,4040,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
857,4771,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
858,4040,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
859,4771,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '02c8257d6164485eb52b20b1b078696e'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '02c8257d6164485eb52b20b1b078696e'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
860,4040,"select *   from (select b.patientName,b.fileNo,b.oldFileNo,b.birthday,b.remark,b.searchCode,b.patientId,b.phone1,b.phone2,el.employeeName AS developerId, case when ifnull(b.birthday,'')='' then year(NOW()) -b.birthYear else floor(DATEDIFF(now(),b.birthday)/365) end  as age,ifnull(mem.memberStar,0)  as memberStar, sh.shopName,case when e.employeeName is null then b1.patientName else e.employeeName end as introducerName,ot.black,(select (if(isnull(t.money),0,ROUND( sum( t.money ),2)) +  if(ISNULL(mem.oldAmountSpent),0,mem.oldAmountSpent)) AS currPay from com_his_charge_bill_settle_payway t  left join com_his_charge_bill_settle se on t.settleId=se.settleId where t.systemFlag<>'Plan'  and se.patientId = b.patientId  ) as amount,if(f.treatTimes=0,'',f.treatTimes) as regCount,di.dict as ificatione, di2.dict as ificationt,di1.dict as memberLevelName,(select GROUP_CONCAT(b.dict) as PATIENT_TAG2 from com_his_patient_extend a LEFT JOIN sys_dict b on b.did=a.dictId where a.comId='239e97340aa84454b4c4bb36bd7879ee' and a.isDelete='0' and a.InfoType=9 and a.patientId=b.patientId )as PATIENT_TAG2,(select count( 1 ) AS introduceTimes from com_his_patient_base where isDelete = 0 and introducerId = b.patientId) as introduceTimes,if(PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))=0,'',PERIOD_DIFF(DATE_FORMAT( f.lastDiagTime, '%Y%m' ),DATE_FORMAT( f.firstDiagTime, '%Y%m' ))) AS howLong,cast((select IFNULL(sum(t.balance),0) as balance from com_his_charge_bill t where t.isDelete = 0 and t.`status` <>239 and t.ifSettle = 1 and comId= '239e97340aa84454b4c4bb36bd7879ee' and t.patientId = b.patientId) as DECIMAL(18,2)) as patientDept,se.employeeName as firstDiagDoctorName,sse.employeeName as lastDiagDoctorName,ssse.employeeName as dutyDoctorIdName,sssse.employeeName as dutyConsultName, b.dutyDoctorId, b.dutyConsultId,IFNULL(IF(IFNULL(b.address,'')<>'',CONCAT((select catNameFull from sys_treedictcat  where catId=b.addressArea),b.address),(SELECT catNameFull FROM sys_treedictcat WHERE catId = b.addressArea)),b.address) as addre, (select  f.formId from com_his_treat_form f where f.patientId=b.patientId and f.formCod=2639 and f.isDelete=0  and f.shopId='02c8257d6164485eb52b20b1b078696e'order by createTime desc LIMIT 1 ) as formId,  (SELECT f.formId from com_his_treat_form f where f.patientId=b.patientId  and f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0  and f.comId='239e97340aa84454b4c4bb36bd7879ee' and f.formCod=2638 order by createTime desc LIMIT 1 ) as formId2,concat(b.phone1,case when ifnull(b.phone2,'')='' then '' else concat('/',b.phone2) end) as phone3 ,case b.sex when 0 then '女' when 1 then '男' when 2 then '其他' else '数据有误' end as sex,alias1.dict nation,case b.marry when 40 then '未知' when 41 then '未婚' when 42 then '已婚' when 43 then '离异' when 44 then '再婚' when 45 then '复婚' else '' end as marry,case b.bloodType when 50 then 'A型血' when 51 then 'B型血' when 52 then 'AB型血' when 53 then 'O型血' when 54 then 'RH阴型血' when 69 then '其他血型' else '' end as bloodType,alias4.dict identityCardType,alias5.dict nationality,alias6.catNameFull workingCircle,alias7.catNameFull livingArea,alias8.dict profession,alias9.dict source,alias10.catNameFull channel,alias11.dict relationship,case b.introducerType when 30 then '' when 31 then '患者' when 32 then '内部员工' when 33 then '外部介绍' else '' end as introducerType from com_his_patient_base b left outer join com_his_patient_member mem on b.patientId=mem.patientId  inner join com_his_patient_shop f on b.patientId=f.patientId   left join com_sys_employee e on e.employeeId=b.introducerId left join com_his_patient_base b1 on b1.patientId=b.introducerId LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId left join com_his_patient_other ot on ot.patientId=b.patientId  left join sys_dict di on di.did=ot.category1  left join sys_dict di2 on di2.did=ot.category2  left join sys_dict di1 on di1.did = mem.memberLevel  left join sys_dict di3 on di3.did = b.source  left join com_sys_employee se on se.employeeId=b.firstDiagDoctorId  left join com_sys_employee sse on sse.employeeId=b.lastDiagDoctorId  left join com_sys_employee ssse on ssse.employeeId=b.dutyDoctorId  left join com_sys_employee sssse on sssse.employeeId=b.dutyConsultId  left join com_sys_shop sh on sh.shopId = b.shopId   left join sys_dict alias1 on b.nation=alias1.did left join sys_dict alias4 on b.identityCardType=alias4.did left join sys_dict alias5 on b.nationality=alias5.did left join sys_treedictcat alias6 on b.workingCircle=alias6.catId left join sys_treedictcat alias7 on b.livingArea=alias7.catId left join sys_dict alias8 on b.profession=alias8.did left join sys_dict alias9 on b.source=alias9.did left join sys_treedictcat alias10 on b.channel=alias10.catId left join sys_dict alias11 on b.relationship=alias11.did where  f.shopId='02c8257d6164485eb52b20b1b078696e' and f.isDelete=0 and b.isDelete=0 ) a   where 1=1   limit 0, 15"
861,8595,"select count(*)  
	from 
	(SELECT b.patientName, b.fileNo, b.oldFileNo, b.birthday, b.remark
		, b.searchCode, b.patientId, b.phone1, b.phone2, el.employeeName AS developerId
		, CASE WHEN ifnull(b.birthday, '') = '' THEN year(NOW()) - b.birthYear ELSE floor(DATEDIFF(now(), b.birthday) / 365) END AS age, ifnull(mem.memberStar, 0) AS memberStar, sh.shopName, CASE WHEN e.employeeName IS NULL THEN b1.patientName ELSE e.employeeName END AS introducerName, ot.black
		, (
			SELECT if(isnull(t.money), 0, ROUND(SUM(t.money), 2)) + if(ISNULL(mem.oldAmountSpent), 0, mem.oldAmountSpent) AS currPay
			FROM com_his_charge_bill_settle_payway t
				LEFT JOIN com_his_charge_bill_settle se ON t.settleId = se.settleId
			WHERE t.systemFlag <> 'Plan'
				AND se.patientId = b.patientId
			) AS amount, if(f.treatTimes = 0, '', f.treatTimes) AS regCount, di.dict AS ificatione, di2.dict AS ificationt, di1.dict AS memberLevelName
		, (
			SELECT GROUP_CONCAT(b.dict) AS PATIENT_TAG2
			FROM com_his_patient_extend a
				LEFT JOIN sys_dict b ON b.did = a.dictId
			WHERE a.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND a.isDelete = '0'
				AND a.InfoType = 9
				AND a.patientId = b.patientId
			) AS PATIENT_TAG2, (
			SELECT COUNT(1) AS introduceTimes
			FROM com_his_patient_base
			WHERE isDelete = 0
				AND introducerId = b.patientId
			) AS introduceTimes, if(PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m')) = 0, '', PERIOD_DIFF(DATE_FORMAT(f.lastDiagTime, '%Y%m'), DATE_FORMAT(f.firstDiagTime, '%Y%m'))) AS howLong, CAST((
			SELECT IFNULL(SUM(t.balance), 0) AS balance
			FROM com_his_charge_bill t
			WHERE t.isDelete = 0
				AND t.`status` <> 239
				AND t.ifSettle = 1
				AND comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND t.patientId = b.patientId
			) AS DECIMAL(18, 2)) AS patientDept, se.employeeName AS firstDiagDoctorName
		, sse.employeeName AS lastDiagDoctorName, ssse.employeeName AS dutyDoctorIdName, sssse.employeeName AS dutyConsultName, b.dutyDoctorId, b.dutyConsultId
		, IFNULL(IF(IFNULL(b.address, '') <> '', CONCAT((
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			), b.address), (
			SELECT catNameFull
			FROM sys_treedictcat
			WHERE catId = b.addressArea
			)), b.address) AS addre, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.formCod = 2639
				AND f.isDelete = 0
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId, (
			SELECT f.formId
			FROM com_his_treat_form f
			WHERE f.patientId = b.patientId
				AND f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
				AND f.isDelete = 0
				AND f.comId = '239e97340aa84454b4c4bb36bd7879ee'
				AND f.formCod = 2638
			ORDER BY createTime DESC
			LIMIT 1
			) AS formId2, concat(b.phone1, CASE WHEN ifnull(b.phone2, '') = '' THEN '' ELSE concat('/', b.phone2) END) AS phone3, CASE b.sex WHEN 0 THEN '女' WHEN 1 THEN '男' WHEN 2 THEN '其他' ELSE '数据有误' END AS sex
		, alias1.dict AS nation, CASE b.marry WHEN 40 THEN '未知' WHEN 41 THEN '未婚' WHEN 42 THEN '已婚' WHEN 43 THEN '离异' WHEN 44 THEN '再婚' WHEN 45 THEN '复婚' ELSE '' END AS marry, CASE b.bloodType WHEN 50 THEN 'A型血' WHEN 51 THEN 'B型血' WHEN 52 THEN 'AB型血' WHEN 53 THEN 'O型血' WHEN 54 THEN 'RH阴型血' WHEN 69 THEN '其他血型' ELSE '' END AS bloodType, alias4.dict AS identityCardType, alias5.dict AS nationality
		, alias6.catNameFull AS workingCircle, alias7.catNameFull AS livingArea, alias8.dict AS profession, alias9.dict AS source, alias10.catNameFull AS channel
		, alias11.dict AS relationship, CASE b.introducerType WHEN 30 THEN '' WHEN 31 THEN '患者' WHEN 32 THEN '内部员工' WHEN 33 THEN '外部介绍' ELSE '' END AS introducerType
	FROM com_his_patient_base b
		LEFT JOIN com_his_patient_member mem ON b.patientId = mem.patientId
		INNER JOIN com_his_patient_shop f ON b.patientId = f.patientId
		LEFT JOIN com_sys_employee e ON e.employeeId = b.introducerId
		LEFT JOIN com_his_patient_base b1 ON b1.patientId = b.introducerId
		LEFT JOIN com_sys_employee el ON el.employeeId = b.developerId
		LEFT JOIN com_his_patient_other ot ON ot.patientId = b.patientId
		LEFT JOIN sys_dict di ON di.did = ot.category1
		LEFT JOIN sys_dict di2 ON di2.did = ot.category2
		LEFT JOIN sys_dict di1 ON di1.did = mem.memberLevel
		LEFT JOIN sys_dict di3 ON di3.did = b.source
		LEFT JOIN com_sys_employee se ON se.employeeId = b.firstDiagDoctorId
		LEFT JOIN com_sys_employee sse ON sse.employeeId = b.lastDiagDoctorId
		LEFT JOIN com_sys_employee ssse ON ssse.employeeId = b.dutyDoctorId
		LEFT JOIN com_sys_employee sssse ON sssse.employeeId = b.dutyConsultId
		LEFT JOIN com_sys_shop sh ON sh.shopId = b.shopId
		LEFT JOIN sys_dict alias1 ON b.nation = alias1.did
		LEFT JOIN sys_dict alias4 ON b.identityCardType = alias4.did
		LEFT JOIN sys_dict alias5 ON b.nationality = alias5.did
		LEFT JOIN sys_treedictcat alias6 ON b.workingCircle = alias6.catId
		LEFT JOIN sys_treedictcat alias7 ON b.livingArea = alias7.catId
		LEFT JOIN sys_dict alias8 ON b.profession = alias8.did
		LEFT JOIN sys_dict alias9 ON b.source = alias9.did
		LEFT JOIN sys_treedictcat alias10 ON b.channel = alias10.catId
		LEFT JOIN sys_dict alias11 ON b.relationship = alias11.did
	WHERE f.shopId = '85c94b66653b4495bf60fac3f770f7ea'
		AND f.isDelete = 0
		AND b.isDelete = 0
	) a 
	where 
	1 = 1"
